///////////////////////////////////////////////////////////////////////////////

    Copyright (c) 2022, 2023 Oracle and/or its affiliates. All rights reserved.

    This program and the accompanying materials are made available under the
    terms of the Eclipse Public License v. 2.0, which is available at
    http://www.eclipse.org/legal/epl-2.0.

    This Source Code may also be made available under the following Secondary
    Licenses when the conditions for such availability set forth in the
    Eclipse Public License v. 2.0 are satisfied: GNU General Public License,
    version 2 with the GNU Classpath Exception, which is available at
    https://www.gnu.org/software/classpath/license.html.

    SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0

///////////////////////////////////////////////////////////////////////////////

:description: EclipseLink
:keywords: eclipselink, java, jpa, persistence, annotation

== Annotation Extensions Reference

[[TLJPA54053]]

This chapter includes information on the EclipseLink extensions to the
Jakarta Persistence API (JPA) annotations. EclipseLink supports the
Jakarta Persistence API (JPA) 2.0 specification. It also includes many
enhancements and extensions.

This chapter includes the following sections:

* link:#CACGDIBI[Functional Listing of Annotation Extensions]
* link:#CACBGBJG[Alphabetical Listing of Annotation Extensions]

[[CACGDIBI]][[TLJPA307]]

=== Functional Listing of Annotation Extensions

The following lists the EclipseLink annotation extensions, categorized
by function:

* link:#CACFGAIC[Mapping Annotations]
* link:#CACGCEIJ[Entity Annotations]
* link:#CACDIEID[Converter Annotations]
* link:#CACGIACB[Caching Annotations]
* link:#CACJHFEC[Customization and Optimization Annotations]
* link:#CACDCCEG[Copy Policy Annotations]
* link:#CACGFGED[Returning Policy Annotations]
* link:#CACCBFFE[Stored Procedure and Function Annotations]
* link:#CACHIHIB[Partitioning Annotations]
* link:#CACDIHJI[Non-relational (NoSQL) Annotations]

[[CACFGAIC]][[TLJPA308]]

==== Mapping Annotations

EclipseLink includes the following annotation extensions for mappings:

* link:#CHDDDDAI[@PrivateOwned]
* link:#CEGFFHHA[@JoinFetch]
* link:#CHDIFIJF[@Mutable]
* link:#BGBCHEDG[@Property]
* link:#BABCJGIG[@Transformation]
* link:#CHDGHHBA[@ReadTransformer]
* link:#BGBGGAEA[@WriteTransformer]
* link:#BCFCCEJF[@WriteTransformers]

[[CACGCEIJ]][[TLJPA309]]

==== Entity Annotations

EclipseLink includes the following annotation extensions for entities:

* link:#additionalcriteria[@AdditionalCriteria]
* link:#BEICFBDD[@ExcludeDefaultMappings]
* link:#BABIEJGD[@Multitenant]
* link:#BCGIACHD[@OptimisticLocking]
* link:#BGBGEFBD[@ReadOnly]
* link:#ANNOTATION_SERIALIZEDCONVERTER[@SerializedConverter]
* link:#ANNOTATION_SERIALIZEDCONVERTERS[@SerializedConverters]
* link:#CACDCCIA[@SerializedObject]
* link:#CECBEBEA[@TenantDiscriminatorColumns]
* link:#CHECIDGH[@TenantDiscriminatorColumn]
* link:#CHDFJJEC[@TenantTableDiscriminator]
* link:#CBBDCAHG[@Struct]

[[CACDIEID]][[TLJPA310]]

==== Converter Annotations

EclipseLink includes the following annotation extensions for converting
data:

* link:#BEHGJHCD[@Convert]
* link:#CHDEHJEB[@Converter]
* link:#CIHEBAFB[@Converters]
* link:#CHDHCCJF[@TypeConverter]
* link:#BCFBEIAE[@TypeConverters]
* link:#BGBBDGAI[@ObjectTypeConverter]
* link:#CHDCHJHF[@ObjectTypeConverters]
* link:#BGBJEBBB[@StructConverter]
* link:#CHDCJCDE[@StructConverters]

[[CACGIACB]][[TLJPA311]]

==== Caching Annotations

EclipseLink includes the following annotation extensions for caching:

* link:#CHDBBIHE[@Cache]
* link:#CEGFEJCH[@CacheIndex]
* link:#BABIJDDB[@CacheIndexes]
* link:#BABJGDGB[@CacheInterceptor]
* link:#BGBGACHC[@TimeOfDay]
* link:#BABICJEJ[@ExistenceChecking]

[[CACJHFEC]][[TLJPA312]]

==== Customization and Optimization Annotations

EclipseLink includes the following annotation extensions for
customization and optimization.

* link:#CHDCCDGC[@Customizer]
* link:#CEGCCCCJ[@ChangeTracking]

[[CACDCCEG]][[TLJPA313]]

==== Copy Policy Annotations

EclipseLink includes the following annotation extensions for copy
policies:

* link:#CDDJGFHA[@CloneCopyPolicy]
* link:#BGBDGCDJ[@CopyPolicy]
* link:#CHDCJEIG[@InstantiationCopyPolicy]

[[CACGFGED]][[TLJPA314]]

==== Returning Policy Annotations

EclipseLink includes the following annotation extensions for returning
policies:

* link:#CIHHEGJE[@ReturnInsert]
* link:#CACHDFCF[@ReturnUpdate]

[[CACCBFFE]][[TLJPA315]]

==== Stored Procedure and Function Annotations

EclipseLink includes the following annotation extensions for stored
procedures and stored functions:

* link:#BGBDHGJE[@NamedPLSQLStoredFunctionQueries]
* link:#CHDIAEFF[@NamedPLSQLStoredFunctionQuery]
* link:#BABJCEJH3[@NamedPLSQLStoredProcedureQueries]
* link:#BGBDHGJE2[@NamedPLSQLStoredProcedureQuery]
* link:#CIHJFFDI[@NamedStoredFunctionQueries]
* link:#BABFBIFE[@NamedStoredFunctionQuery]
* link:#BABJCEJH[@NamedStoredProcedureQueries]
* link:#BGBGAEFF[@NamedStoredProcedureQuery]
* link:#CACGHFJB[@OracleArray]
* link:#CACCIBAB[@OracleArrays]
* link:#CACEBEGE[@OracleObject]
* link:#CACFFCEE[@OracleObjects]
* link:#CHDDEBEC[@PLSQLParameter]
* link:#CHDBGAED[@PLSQLRecord]
* link:#CHDBGAED4[@PLSQLRecords]
* link:#CACJBHHF[@PLSQLTable]
* link:#CACCBFBC[@PLSQLTables]
* link:#CHDDEBEC6[@StoredProcedureParameter]

[[CACHIHIB]][[TLJPA316]]

==== Partitioning Annotations

EclipseLink includes the following annotation extensions for using
partitions:

* link:#CEGBDBEG[@HashPartitioning]
* link:#CHDDAHEB[@Partitioned]
* link:#CEGDCFDA[@Partitioning]
* link:#BCGIIAFB[@PinnedPartitioning]
* link:#BABCFDAJ[@RangePartition]
* link:#BCGCGEIH[@RangePartitioning]
* link:#BABJEFJH[@ReplicationPartitioning]
* link:#BCGBJGFF[@RoundRobinPartitioning]
* link:#BCGEJFAH[@UnionPartitioning]
* link:#CEGHFJDJ[@ValuePartitioning]

[[CACDIHJI]][[TLJPA54001]]

==== Non-relational (NoSQL) Annotations

EclipseLink includes the following annotation extensions for
non-relational datasources:

* link:#CBHHCHAC[@Field]
* link:#CIHCAFEI[@JoinField]
* link:#BEIFHJJE[@JoinFields]
* link:#BJEIEBHC[@NoSql]

[[CACBGBJG]][[TLJPA317]]

=== Alphabetical Listing of Annotation Extensions

The following lists the EclipseLink annotation extensions:

* link:#additionalcriteria[@AdditionalCriteria]
* link:#CHDDDFDA[@Array]
* link:#CHDCCIDA[@BatchFetch]
* link:#CHDBBIHE[@Cache]
* link:#CEGFEJCH[@CacheIndex]
* link:#BABIJDDB[@CacheIndexes]
* link:#BABJGDGB[@CacheInterceptor]
* link:#CIABIIEB[@CascadeOnDelete]
* link:#CEGCCCCJ[@ChangeTracking]
* link:#BGBHAADB[@ClassExtractor]
* link:#CDDJGFHA[@CloneCopyPolicy]
* link:#BGBHHCJH[@CompositeMember]
* link:#CBBJAJCH[@ConversionValue]
* link:#BEHGJHCD[@Convert]
* link:#CHDEHJEB[@Converter]
* link:#CIHEBAFB[@Converters]
* link:#BGBDGCDJ[@CopyPolicy]
* link:#CHDCCDGC[@Customizer]
* link:#BABDDGFG[@DeleteAll]
* link:#CIHGDDED[@DiscriminatorClass]
* link:#BEICFBDD[@ExcludeDefaultMappings]
* link:#BABICJEJ[@ExistenceChecking]
* link:#BABCHIGE[@FetchAttribute]
* link:#BABJBDEG[@FetchGroup]
* link:#CHDIEBGG[@FetchGroups]
* link:#CBHHCHAC[@Field]
* link:#CEGBDBEG[@HashPartitioning]
* link:#BABGIFEC[@Index]
* link:#CHDHGAIE[@Indexes]
* link:#CHDCJEIG[@InstantiationCopyPolicy]
* link:#CEGFFHHA[@JoinFetch]
* link:#CIHCAFEI[@JoinField]
* link:#BEIFHJJE[@JoinFields]
* link:#BEHBBCDB[@MapKeyConvert]
* link:#BABIEJGD[@Multitenant]
* link:#CHDIFIJF[@Mutable]
* link:#BGBDHGJE[@NamedPLSQLStoredFunctionQueries]
* link:#BGBDHGJE2[@NamedPLSQLStoredProcedureQuery]
* link:#CIHJFFDI[@NamedStoredFunctionQueries]
* link:#BABFBIFE[@NamedStoredFunctionQuery]
* link:#BABJCEJH[@NamedStoredProcedureQueries]
* link:#BGBGAEFF[@NamedStoredProcedureQuery]
* link:#CHDGEFGD[@Noncacheable]
* link:#BJEIEBHC[@NoSql]
* link:#BGBBDGAI[@ObjectTypeConverter]
* link:#CHDCHJHF[@ObjectTypeConverters]
* link:#BCGIACHD[@OptimisticLocking]
* link:#CACGHFJB[@OracleArray]
* link:#CACCIBAB[@OracleArrays]
* link:#CACEBEGE[@OracleObject]
* link:#CACFFCEE[@OracleObjects]
* link:#CHDDIBJF[@OrderCorrection]
* link:#CHDDAHEB[@Partitioned]
* link:#CEGDCFDA[@Partitioning]
* link:#BCGIIAFB[@PinnedPartitioning]
* link:#CHDDEBEC[@PLSQLParameter]
* link:#CHDBGAED[@PLSQLRecord]
* link:#CHDBGAED4[@PLSQLRecords]
* link:#CACJBHHF[@PLSQLTable]
* link:#CACCBFBC[@PLSQLTables]
* link:#BGEBBFJE[@PrimaryKey]
* link:#CHDDDDAI[@PrivateOwned]
* link:#BABJHAFD[@Properties]
* link:#BGBCHEDG[@Property]
* link:#CIHCGHGA[@QueryRedirectors]
* link:#BABCFDAJ[@RangePartition]
* link:#BCGCGEIH[@RangePartitioning]
* link:#BGBGEFBD[@ReadOnly]
* link:#CHDGHHBA[@ReadTransformer]
* link:#BABJEFJH[@ReplicationPartitioning]
* link:#CIHHEGJE[@ReturnInsert]
* link:#CACHDFCF[@ReturnUpdate]
* link:#BCGBJGFF[@RoundRobinPartitioning]
* link:#ANNOTATION_SERIALIZEDCONVERTER[@SerializedConverter]
* link:#ANNOTATION_SERIALIZEDCONVERTERS[@SerializedConverters]
* link:#CACDCCIA[@SerializedObject]
* link:#CHDDEBEC6[@StoredProcedureParameter]
* link:#CBBDCAHG[@Struct]
* link:#BGBJEBBB[@StructConverter]
* link:#CHDCJCDE[@StructConverters]
* link:#CACIJAFA[@Structure]
* link:#CECBEBEA[@TenantDiscriminatorColumns]
* link:#CHECIDGH[@TenantDiscriminatorColumn]
* link:#CHDFJJEC[@TenantTableDiscriminator]
* link:#BGBGACHC[@TimeOfDay]
* link:#BABCJGIG[@Transformation]
* link:#CHDHCCJF[@TypeConverter]
* link:#BCFBEIAE[@TypeConverters]
* link:#CFAFIIFC[@UuidGenerator]
* link:#ANNOTATION_UUIDGENERATORS[@UuidGenerators]
* link:#BCGEJFAH[@UnionPartitioning]
* link:#TLJPA54063[@ValuePartition]
* link:#CEGHFJDJ[@ValuePartitioning]
* link:#CHDDFDGF[@VariableOneToOne]
* link:#CIHFBCFI[@VirtualAccessMethods]
* link:#BGBGGAEA[@WriteTransformer]
* link:#BCFCCEJF[@WriteTransformers]

[[additionalcriteria]][[TLJPA318]]

'''''

=== @AdditionalCriteria

Use `@AdditionalCriteria` to define parameterized views on data.

You can define additional criteria on entities or mapped superclass.
When specified at the mapped superclass level, the additional criteria
definition applies to all inheriting entities, unless those entities
define their own additional criteria, in which case those defined for
the mapped superclass are ignored.

[[sthref9]]

*Annotation Elements*

link:#CHDGJGDCxx[Table 2-1] describes this annotation's elements.
[[TLJPA319]][[sthref10]][[CHDGJGDCxx]]

*_Table 2-1 @AdditionalCriteria Annotation Elements_*
|=======================================================================
|*Attribute* |*Description* |*Default*
|`value` |(Required) The JPQL fragment to use as the additional criteria
|
|=======================================================================

[[sthref11]]

*Usage*

Additional criteria can provide an additional filtering mechanism for
queries. This filtering option, for example, allows you to use an
existing additional `JOIN` expression defined for the entity or mapped
superclass and allows you to pass parameters to it.

Set additional criteria parameters through properties on the entity
manager factory or on the entity manager. Properties set on the entity
manager override identically named properties set on the entity manager
factory. Properties must be set on an entity manager before executing a
query. Do not change the properties for the lifespan of the entity
manager.

NOTE: Additional criteria are not supported with native SQL queries.

[[sthref12]]

*Examples*

Specify additional criteria using the `@AdditionalCriteria` annotation
or the `<additional-criteria>` element. The additional criteria
definition supports any valid JPQL string and must use `this` as an
alias to form the additional criteria. For example:

[source,oac_no_warn]
----
@AdditionalCriteria("this.address.city IS NOT NULL")
----

link:#CFHFACAI[Example 2-1] shows additional criteria defined for the
entity `Employee` and then shows the parameters for the additional
criteria set on the entity manager.

[[CFHFACAI]][[TLJPA320]]

*_Example 2-1 Using @AdditionalCriteria Annotation_*

Define additional criteria on `Employee`, as follows:

[source,oac_no_warn]
----
package model;
 
@AdditionalCriteria("this.company=:COMPANY")
public class Employee {

  ...
}
----

Set the property on the `EntityManager`. This example returns all
employees of `MyCompany`.

[source,oac_no_warn]
----
entityManager.setProperty("COMPANY", "MyCompany");
----

link:#CFHHBDFE[Example 2-2] illustrates the same example as before, but
uses the `<additional-criteria>` element in the `eclipselink-orm.xml`
mapping file.

[[CFHHBDFE]][[TLJPA321]]

*_Example 2-2 Using <additional-criteria> XML_*

[source,oac_no_warn]
----
<additional-criteria>
  <criteria>this.address.city IS NOT NULL</criteria>
</additional-criteria>
----

[[TLJPA322]]

*Uses for Additional Criteria*

Uses for additional criteria include:

* link:#CHDIFCDI[Multitenancy]
* link:#CHDJGCJG[Soft Delete]
* link:#CHDFJFFA[Data History]
* link:#CHDEGFBA[Temporal Filtering]
* link:#CHDBGJHD[Shared Table]

[[CHDIFCDI]]

*Multitenancy*

In a multitenancy environment, tenants (users, clients, organizations,
applications) can share database tables, but the views on the data are
restricted so that tenants have access only to their own data. You can
use additional criteria to configure such restrictions.

NOTE: In most cases, you use the `@Multitenant` annotation in multitenancy
environments instead, as shown.

[[TLJPA54054]]

*_Example 2-3 Multitenancy Example 1_*

The following example restricts the data for a *Billing* client, such as
a billing application or billing organization:

[source,oac_no_warn]
----
@AdditionalCriteria("this.tenant = 'Billing'")
----

[[TLJPA54055]]

*_Example 2-4 Multitenancy Example 2_*

The following example could be used in an application used by multiple
tenants at the same time. The additional criteria is defined as:

[source,oac_no_warn]
----
@AdditionalCriteria("this.tenant = :tenant")
----

When the tenant acquires its `EntityManagerFactory` or `EntityManager`,
the persistence/entity manager property tenant is set to the name of the
tenant acquiring it. For example,

[source,oac_no_warn]
----
Map properties = new HashMap();
properties.put("tenant", "ACME");
EntityManagerFactory emf = Persistence.createEntityManagerFactory(properties);
----

Or

[source,oac_no_warn]
----
Map properties = new HashMap();
properties.put("tenant", "ACME");
EntityManager em = factory.createEntityManager(properties);
----

[[CHDJGCJG]]

*Soft Delete*

The following example filters data that is marked as deleted (but which
still exists in the table) from a query:

[source,oac_no_warn]
----
@AdditionalCriteria("this.isDeleted = false")
----

[[CHDFJFFA]]

*Data History*

The following example returns the current data from a query, thus
filtering out any out-of-date data, for example data stored in a history
table.

[source,oac_no_warn]
----
@AdditionalCriteria("this.endDate is null")
----

NOTE: EclipseLink also provides specific history support, via `HistoryPolicy`
. See Tracking Changes Using History Policy at
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/History`.

[[CHDEGFBA]]

*Temporal Filtering*

The following example filters on a specific date:

[source,oac_no_warn]
----
@AdditionalCriteria("this.startDate <= :viewDate and this.endDate >= :viewDate")
----

[[CHDBGJHD]]

*Shared Table*

For a shared table, there may be inheritance in the table but not in the
object model. For example, a `SavingsAccount` class may be mapped to an
`ACCOUNT` table, but the `ACCOUNT` table contains both savings account
data (`SAVINGS`) and checking account (`CHECKING`) data. You can use
additional criteria to filter out the checking account data.

[[sthref15]]

*See Also*

For more information, see:

* xref:jpql.adoc#column["COLUMN"]
* link:#BABIEJGD["@Multitenant"]

[[CHDDDFDA]][[TLJPA325]]

'''''

=== @Array

Use `@Array` to define object-relational data types supported by
specific databases, such as Oracle `VARRAY` types or PostgreSQL JDBC
`Array` types.

[[sthref16]]

*Annotation Elements*

link:#CBABBAJF[Table 2-2] describes this annotation's elements.

[[TLJPA326]][[sthref17]][[CBABBAJF]]

*_Table 2-2 @Array Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`databaseType` |(Required) The name of the database array structure
type |

|`targetClass` |(Optional only if the collection field or property is
defined using Java generics; otherwise Required) The class (basic or
embeddable) that is the element type of the collection |Parameterized
type of the collection.
|=======================================================================


[[sthref18]]

*Usage*

Use `@Array` on a collection attribute that is persisted to an `Array`
type. The collection can be of basic types or embeddable class mapped
using a `Struct`.

[[sthref19]]

*Examples*

link:#CBABHEHD[Example 2-5] shows how to use this annotation with an
Oracle `VARRAY` type.

[[CBABHEHD]][[TLJPA327]]

*_Example 2-5 Using @Array with Oracle VARRAY_*

[source,oac_no_warn]
----
VARRAY DDL:
CREATE TYPE TASKS_TYPE AS VARRAY(10) OF VARCHAR(100)
----

[source,oac_no_warn]
----
@Struct
@Entity
public class Employee {
    @Id
    private long id;
    @Array(databaseType="TASKS_TYPE")
    private List<String> tasks;
}
----

link:#CBACGBDA[Example 2-6] shows how to use this annotation with an
PostgreSQL `Struct` type.

[[CBACGBDA]][[TLJPA328]]

*_Example 2-6 Using @Array with PostgreSQL Struct_*

[source,oac_no_warn]
----
DDL:
CREATE TABLE EMPLOYEE (ID BIGINT, TASKS TEXT[])
----

[source,oac_no_warn]
----
@Struct
@Entity
public class Employee {
    @Id
    private long id;
    @Array(databaseType="TEXT")
    private List<String> tasks;
}
----

[[sthref20]]

*See Also*

For more information, see the following:

* link:#CBBDCAHG["@Struct"]
* _Understanding EclipseLink_
* _Solutions Guide for EclispeLink_

[[CHDCCIDA]][[TLJPA329]]

'''''

=== @BatchFetch

Use `@BatchFetch` to read objects related to a relationship mapping
(such as `@OneToOne`, `@OneToMany`, `@ManyToMany`, and
`@ElementCollection`) to be read in a single query.

[[sthref21]]

*Annotation Elements*

link:#CHDJBJBC[Table 2-3] describes this annotation's elements.

[[TLJPA330]][[sthref22]][[CHDJBJBC]]

*_Table 2-3 @BatchFetch Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|size |Default size of the batch fetch, used only when
`BatchFetchType`=`IN` to define the number of keys in each `IN` clause
|`256` or the query's `pageSize` (for cursor queries)

|BatchFetchType a|
(Optional) The type of batch fetch to use:

* `JOIN` – The original query's selection criteria is joined with the
batch query
* `EXISTS` – Uses an SQL `EXISTS` clause and a sub-select in the batch
query instead of a `JOIN`
* `IN` – Uses an SQL `IN` clause in the batch query, passing in the
source object IDs.

 |`JOIN`
|=======================================================================

[[sthref23]]

*Usage*

Batch fetching allows for the optimal loading of a tree. Setting the
`@BatchFetch` annotation on a _child_ relationship of a tree structure
causes EclipseLink to use a _single_ SQL statement for each level. For
example, consider an object with an `EMPLOYEE` and `PHONE` table in
which `PHONE` has a foreign key to `EMPLOYEE`. By default, reading a
list of employees' addresses by default requires _n_ queries, for each
employee's address. With batch fetching, you use _one query_ for all the
addresses.

Using `BatchFetchType=EXISTS` does not require an SQL `DISTINCT`
statement (which may cause issues with LOBs) and may be more efficient
for some types of queries or on specific databases.

When using `BatchFetchType=IN`, EclipseLink selects only objects not
already in the cache. This method may work better with cursors or
pagination, or in situations in which you cannot use a `JOIN`. On some
databases, this may only work for singleton IDs.

[[sthref24]]

*Examples*

The following examples show how to use this annotation (and XML) with
different batch fetch types.

[[TLJPA331]]

*_Example 2-7 Using JOIN BatchFetch Type_*

[source,oac_no_warn]
----
@OneToOne
@BatchFetch(BatchFetchType.JOIN)
private Address address;
----

[source,oac_no_warn]
----
<one-to-one name="address">
    <batch-fetch type="JOIN" />
</one-to-one>

 
----

[[TLJPA332]]

*_Example 2-8 Using EXISTS BatchFetch Type_*

[source,oac_no_warn]
----
@BatchFetch(BatchFetchType.EXISTS)
@OneToOne
public Map<String, String> getStringMap() {
return stringMap;
}
----

[source,oac_no_warn]
----
<one-to-one name="StringMap">
    <batch-fetch type="EXISTS"/>
</one-to-one>
----

[[TLJPA333]]

*_Example 2-9 Using IN BatchFetch Type_*

[source,oac_no_warn]
----
@BatchFetch(BatchFetchType.IN, size=50)
@OneToOne
public Map<String, String> getStringMap() {
return stringMap;
}
 
----

[source,oac_no_warn]
----
<one-to-one name="StringMap">
    <batch-fetch type="IN" size="50" />
</one-to-one>
----

[[sthref28]]

*See Also*

For more information, see:

* link:#CEGFFHHA["@JoinFetch"]
* _Understanding EclipseLink_
* _Solutions Guide for EclispeLink_

[[CHDBBIHE]][[TLJPA334]]

'''''

=== @Cache

Use `@Cache` (in place of the JPA `@Cachable` annotation) to configure
the EclipseLink object cache. By default, EclipseLink uses a shared
object cache to cache all objects. You can configure the caching type
and options on a per class basis to allow optimal caching.

[[sthref29]]

*Annotation Elements*

link:#CDEJJHDG[Table 2-4] describes this annotation's elements.

[[TLJPA335]][[sthref30]][[CDEJJHDG]]

*_Table 2-4 @Cache Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`type` a|
(Optional) Set this attribute to the type
(`org.eclipse.persistence.annotations.CacheType` enumerated type) of the
cache that you will be using:

* `FULL`
* `WEAK`
* `SOFT`
* `SOFT_WEAK`
* `HARD_WEAK`
* `CACHE` (not recommended)
* `NONE` (not recommended, use `isolation=ISOLATED` instead)

You can override this attribute with these persistence unit properties:

* `eclipselink.cache.type.<`__`ENTITY`__`>`
* `eclipselink.cache.type.default`

 |`CacheType.SOFT_WEAK`

|`size` |(Optional) Set this attribute to an int value to define the
size of cache to use (number of objects). |`100`

|`isolation` a|
(Optional) The caching level of the Entity:

* `shared` – Entity instances will be cached within the
EntityManagerFactory/ServerSession level
* `isolated` – The Entity and its data is not stored in the shared
cache, but is isolated to the Persistence Context/UnitOfWork or
IsolatedClientSession
* `protected` – Entity state information will be cached in the shared
cache, but Entity instances will not be shared

 |`shared`

|`expiry` |(Optional) The `int` value to enable the expiration of the
cached instance after a fixed period of time (milliseconds). Queries
executed against the cache after this will be forced back to the
database for a refreshed copy. |no expiry

|`expiryTimeOfDay` |(Optional) Specific time of day
(`org.eclipse.persistence.annotations.TimeOfDay`) when the cached
instance will expire. Queries executed against the cache after this will
be forced back to the database for a refreshed copy. |no expiry

|`alwaysRefresh` |(Optional) Set to a boolean value of true to force all
queries that go to the database to always refresh the cache |`false`

|`refreshOnlyIfNewer` a|
(Optional) Set to a boolean value of `true` to force all queries that go
to the database to refresh the cache only if the data received from the
database by a query is newer than the data in the cache (as determined
by the optimistic locking field)

*Note:*

* This option only applies if one of the other refreshing options, such
as `alwaysRefresh`, is already enabled.
* A version field is necessary to apply this feature.

 |`false`

|`disableHits` |(Optional) Set to a boolean value of true to force all
queries to bypass the cache for hits, but still resolve against the
cache for identity. This forces all queries to hit the database.
|`false`

|`coordinationType` a|
(Optional) Set this attribute to the cache coordination mode
(`org.eclipse.persistence.annotations.CacheCoordinationType` enumerated
type).

* `SEND_OBJECT_CHANGES` – Sends a list of changed objects, including
data about the changes. This data is merged into the receiving cache.
* I`NVALIDATE_CHANGED_OBJECTS` – Sends a list of the identities of the
objects that have changed. The receiving cache invalidates the objects
(rather than changing any of the data).
* `SEND_NEW_OBJECTS_WITH_CHANGES` – Same as `SEND_OBJECT_CHANGES`
excepts it also includes any newly-created objects from the transaction
* `NONE` – Does not cache coordination

You must also configure cache coordination in your persistence unit
properties. See xref:{relativedir}/persistenceproperties_ref.adoc#CACDCCEG2["Caching"].

 |`SEND_OBJECT_CHANGES`

|`databaseChangeNotificationType` a|
(Optional) The database change notification mode:

* Invalidate – Invalidates the EclipseLink cache when a database change
event is received for an object.
* None – No database change events will be processed. The database event
listener must also be configured for the persistence unit/session.

 |`INVALIDATE`
|=======================================================================


[[sthref31]]

*Usage*

Use the `@Cache` annotation instead of the JPA `@Cachable` annotation to
provide additional caching configuration.

You can define the `@Cache` annotation on the following:

* `@Entity`
* `@MappedSuperclass`
* the root of the inheritance hierarchy (if applicable)

If you define the `@Cache` annotation on an inheritance subclass, the
annotation will be ignored. If you define the `@Cache` annotation on
`@Embeddable` EclipseLink will throw an exception.

[[TLJPA336]]

*Caching in EclipseLink*

The EclipseLink cache is an in-memory repository that stores recently
read or written objects based on class and primary key values.
EclipseLink uses the cache to do the following:

* Improve performance by holding recently read or written objects and
accessing them in-memory to minimize database access.
* Manage locking and isolation level.
* Manage object identity.

For more information about the EclipseLink cache and its default
behavior, see:

* Caching examples:
+
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/Caching`

EclipseLink defines the following entity caching annotations:

* `@Cache`
* `@TimeOfDay`
* `@ExistenceChecking`

EclipseLink also provides a number of persistence unit properties that
you can specify to configure the cache. These properties may compliment
or provide an alternative to the usage of annotations.

For more information, see
xref:{relativedir}/persistenceproperties_ref.adoc#CACDCCEG2["Caching"].

[[sthref32]]

*Examples*

link:#CHDEEGCI[Example 2-10] illustrates an `@Cache` annotation.

[[CHDEEGCI]][[TLJPA337]]

*_Example 2-10 Using @Cache Annotation_*

[source,oac_no_warn]
----
...
@Entity
@Cache(
  type=CacheType.SOFT, // Cache everything until the JVM decides memory is low.
  size=64000  // Use 64,000 as the initial cache size.
  expiry=36000000,  // 10 minutes
  coordinationType=CacheCoordinationType.INVALIDATE_CHANGED_OBJECTS  // if cache coordination is used, only send invalidation messages.
)
public class Employee {
  ...
} 
----

link:#CDEJDBFJ[Example 2-11] shows how to use this annotation in the
`eclipselink-orm.xml` file.

[[CDEJDBFJ]][[TLJPA338]]

*_Example 2-11 Using <cache> XML_*

[source,oac_no_warn]
----
<entity-mappings
  xmlns="http://www.eclipse.org/eclipselink/xsds/persistence/orm"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.eclipse.org/eclipselink/xsds/persistence/orm 
  http://www.eclipse.org/eclipselink/xsds/eclipselink_orm_2_4.xsd"
  version="2.4">
    <entity name="Employee" class="org.acme.Employee" access="FIELD">
      <cache type="SOFT" size="64000" expiry="36000000" coordination-type="INVALIDATE_CHANGED_OBJECTS"/>
    </entity>
</entity-mappings>
----

You can also specify caching properties at the persistence unit level
(in the `persistence.xml` file) as shown here:

[[CACHFEFD]][[TLJPA339]]

*_Example 2-12 Specifying Caching in persistence.xml_*

[source,oac_no_warn]
----
<persistence xmlns="http://java.sun.com/xml/ns/persistence"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence persistence_2_0.xsd"
  version="2.0">
    <persistence-unit name="acme" transaction-type="RESOURCE_LOCAL">
      <provider>org.eclipse.persistence.jpa.PersistenceProvider</provider>
        <exclude-unlisted-classes>false</exclude-unlisted-classes>
        <properties>
          <property name="eclipselink.cache.shared.default" value="false"/>
          <property name="eclipselink.cache.shared.Employee" value="true"/>
          <property name="eclipselink.cache.type.Employee" value="SOFT"/>
          <property name="eclipselink.cache.size.Employee" value="64000"/>
        </properties>
    </persistence-unit>
</persistence>
----

[[sthref33]]

* +
See Also*

For more information, see:

* link:#BABICJEJ["@ExistenceChecking"]
* link:#BGBGACHC["@TimeOfDay"]
* link:#BABJGDGB["@CacheInterceptor"]
* "Understanding Caching" in the _Understanding EclipseLink_
* "Object Caching" in _Solutions Guide for EclispeLink_
* EclipseLink Caching examples:
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/Caching`

[[CEGFEJCH]][[TLJPA340]]

'''''

=== @CacheIndex

Use `@CacheIndex` to define a cached index. Cache indexes are used only
when caching is enabled.

[[sthref34]]

*Annotation Elements*

link:#BABFJHIC[Table 2-5] describes this annotation's elements.

[[TLJPA341]][[sthref35]][[BABFJHIC]]

*_Table 2-5 @CacheIndex Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`columnNames` |(Optional) The set of columns on which to define the
index. Not required when annotated on a field/method. | +

|`updateable` a|
(Optional) Specify if the indexed field is updateable.

If `true`, the object will be re-indexed on each update or refresh.

 |true
|=======================================================================


[[sthref36]]

*Usage*

A cache index allows `singleResult` queries to obtain a cache hit when
querying on the indexed fields. A `resultList` query cannot obtain cache
hits, as it is unknown if all of the objects are in memory, (unless the
cache usage query hint is used).

The index should be unique. If it is not, the first indexed object will
be returned.

You can use `@CacheIndex` on an Entity class or on an attribute. The
column is defaulted when defined on a attribute.

[[sthref37]]

*Examples*

link:#BABEECHH[Example 2-13] shows an example of using the `@CacheIndex`
annotation.

[[BABEECHH]][[TLJPA342]]

*_Example 2-13 Using @CacheIndex Annotation_*

[source,oac_no_warn]
----
@Entity
@CacheIndex(columnNames={"F_NAME", "L_NAME"}, updateable=true)
public class Employee {
  @Id
  private long id;
  @CacheIndex
  private String ssn;
  @Column(name="F_NAME")
  private String firstName;
  @Column(name="L_NAME")
  private String lastName;
}
----

link:#BABIHBCC[Example 2-14] shows an example of using the
`<cache-index>` XML element in the `eclipselink-orm.xml` file.

[[BABIHBCC]][[TLJPA343]]

*_Example 2-14 Using <cache-index> XML_*

[source,oac_no_warn]
----
<?xml version="1.0"?>
<entity-mappings
  xmlns="http://www.eclipse.org/eclipselink/xsds/persistence/orm"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.eclipse.org/eclipselink/xsds/persistence/orm http://www.eclipse.org/eclipselink/xsds/eclipselink_orm_2_4.xsd"
  version="2.4">
    <entity name="Employee" class="org.acme.Employee" access="FIELD">
        <cache-index updateable="true">
            <column-name>F_NAME</column-name>
            <column-name>L_NAME</column-name>
        </cache-index>
        <attributes>
            <id name="id"/>
            <basic name="ssn">
                <cache-index/>
            </basic>
            <basic name="firstName">
                <column name="F_NAME"/>
            </basic>
            <basic name="lastName">
                <column name="L_NAME"/>
            </basic>
        </attributes>
    </entity>
</entity-mappings>
----

link:#BABBIAGH[Example 2-15] shows an example query using a cache index.

[[BABBIAGH]][[TLJPA344]]

*_Example 2-15 Caching an Index Query_*

[source,oac_no_warn]
----
Query query = em.createQuery("Select e from Employee e where e.firstName = :firstName and e.lastName = :lastName");
query.setParameter("firstName", "Bob");
query.setParameter("lastName", "Smith");
Employee employee = (Employee)query.getSingleResult();
----

[[sthref38]]

*See Also*

For more information, see:

* link:#CHDBBIHE["@Cache"]
* "About Cache Indexes" in _Understanding EclipseLink_

[[BABIJDDB]][[TLJPA345]]

'''''

=== @CacheIndexes

Use `@CacheIndexes` to define a set of `@CacheIndex` on an entity.

[[sthref39]]

*Annotation Elements*

link:#CIHJDAHF[Table 2-6] describes this annotation's elements.

[[TLJPA346]][[sthref40]][[CIHJDAHF]]

*_Table 2-6 @CacheIndexes Annotation Elements_*

|==============================================
|*Annotation Element* |*Description* |*Default*
|`CacheIndex[]` |An array of cache indexes |
|==============================================


[[sthref41]]

*Examples*

See link:#CEGFEJCH["@CacheIndex"] for examples of using the
`@CacheIndexes` annotation.

[[sthref42]]

*See Also*

For more information, see:

* link:#CEGFEJCH["@CacheIndex"]
* "About Cache Indexes" in _Understanding EclipseLink_

[[BABJGDGB]][[TLJPA347]]

'''''

=== @CacheInterceptor

Use `@CacheInterceptor` on an entity to intercept all EclipseLink cache
access to the entity instead of responding to cache operations through
an event.

[[sthref43]]

*Annotation Elements*

link:#BGBBHFBF[Table 2-7] describes this annotation's elements.

[[TLJPA348]][[sthref44]][[BGBBHFBF]]

*_Table 2-7 @CacheInterceptor Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|value |The class to be used to intercept EclipseLink's cache access | +
|=======================================================================

[[sthref45]]

*Usage*

Once set, the specified class will receive all caching calls. Existing
EclipseLink cache settings will continue to be used, any calls allowed
to continue to the EclipseLink cache will execute against the configured
cache.

When using with an entity in inheritance, you should define the
`@CacheInterceptor` on the _root_ of the inheritance hierarchy.

[[sthref46]]

*Examples*

link:#BGBGHHFI[Example 2-16] shows how to integrate an external cache
with EclipseLink.

[[BGBGHHFI]][[TLJPA349]]

*_Example 2-16 Using @CacheInterceptor Annotation_*

In this example, the `Employee` class intercepts all EclipseLink calls
to the internal EclipseLink cache and redirects them to the Oracle
Coherence Grid cache (`CoherenceInterceptor`).

[source,oac_no_warn]
----
import oracle.eclipselink.coherence.integrated.cache.CoherenceInterceptor;
import org.eclipse.persistence.annotations.Customizer;
 
@Entity
@CacheInterceptor(value = CoherenceInterceptor.class)
public class Employee {
...
}
----

link:#BGBEBHDH[Example 2-17] shows an example of using the
`<cache-interceptor>` XML element in the `eclipselink-orm.xml` file.

[[BGBEBHDH]][[TLJPA350]]

*_Example 2-17 Using <cache-interceptor> XML_*

[source,oac_no_warn]
----
<entity class="Employee">
    <cache-interceptor class="CoherenceInterceptor"/>
...
</entity>
----

[[sthref47]]

*See Also*

For more information, see:

* _Understanding EclipseLink_
* _Oracle Coherence Integration Guide for EclipseLink with Coherence
Grid_
* link:#CHDBBIHE["@Cache"]

[[CIABIIEB]][[TLJPA351]]

'''''

=== @CascadeOnDelete

Use the `@CascadeOnDelete` annotation to specify that a delete operation
performed on a database object is cascaded on secondary or related
tables.

`ON DELETE CASCADE` is a database foreign key constraint option that
automatically removes the dependent rows.

[[sthref48]]

*Annotation Elements*

There are no elements for this annotation.

[[sthref49]]

*Usage*

You can place `@CascadeOnDelete` on any relationship in which the target
is defined as foreign key to the source Entity.

Add the annotation on the source relationship: `@OneToOne`,
`@OneToMany`, `@ManyToMany`, and `@ElementCollection` You can also add
`@CascadeOnDelete` to an Entity with a `@SecondaryTable` or `JOINED`
inheritance. link:#CHDECJGE[Table 2-8] describes the affect of placing
`@CascadeOnDelete` on these different elements

[[TLJPA353]][[sthref50]][[CHDECJGE]]

*_Table 2-8 Using @Cascade on Different Elements_*

|=======================================================================
|*Element* |*Effect of @CascadeOnDelete*
|Entity |Defines that secondary or joined inheritance tables should
cascade the delete on the database

|OneToOne mapping a|
The deletion of the related object is cascaded on the database.

This is only allowed for mappedBy/target-foreign key OneToOne mappings
(because of constraint direction).

|OneToMany mapping a|
For a OneToMany using a `mappedBy` or `JoinColumn`, the deletion of the
related objects is cascaded on the database.

For a OneToMany using a `JoinTable`, the deletion of the join table is
cascaded on the database (target objects cannot be cascaded even if
private because of constraint direction).

|ManyToMany mapping |The deletion of the join table is cascaded on the
database (target objects cannot be cascaded even if private because of
constraint direction).

|ElementCollection mapping |The deletion of the collection table is
cascaded on the database.
|=======================================================================


`@CascadeOnDelete` has the following behavior:

* DDL generation: If DDL generation is used, the generated constraint
will include the cascade deletion option.
* Entity: Remove will not execute SQL for deletion from secondary or
joined inheritance tables (as constraint will handle deletion).
* OneToOne: If the mapping uses cascading or orphanRemoval, SQL will not
be executed to delete target object.
* OneToMany: If the mapping uses cascading or orphanRemoval, SQL will
not be executed to delete target objects.
* ManyToMany: SQL will not be executed to delete from the join table.
* ElementCollection: SQL will not be executed to delete from the
collection table.
* Cache: Cascaded objects will still be removed from the cache and
persistence context.
* Version locking: Version will not be verified on deletion of cascaded
object.
* Events: Deletion events may not be executed on the cascaded objects if
the objects are not loaded.
* Cascading: The remove operation should still be configured to cascade
in the mapping if using CascadeOnDelete.

[[sthref51]]

*Examples*

link:#CHDHCIGF[Example 2-18] shows the cascading deletion of the
Employee secondary table and all of its owned relationships.

[[CHDHCIGF]][[TLJPA354]]

*_Example 2-18 Using @CascadeOnDelete Annotation_*

[source,oac_no_warn]
----
@Entity
@SecondaryTable(name="EMP_SALARY")
@CascadeOnDelete
public class Employee{
    @Id
    private long id;
    private String firstName;
    private String lastName;
    @Column(table="EMP_SALARY")
    private String salary;
    @OneToOne(mappedBy="owner", orphanRemoval=true, cascade={CascadeType.ALL})
    @CascadeOnDelete
    private Address address;
    @OneToMany(mappedBy="owner", orphanRemoval=true, cascade={CascadeType.ALL})
    @CascadeOnDelete
    private List<Phone> phones;
    @ManyToMany
    @JoinTable(name="EMP_PROJ")
    @CascadeOnDelete
    private List<Project> projects;
    ...
}
----

In the `eclipselink-orm.xml` descriptor file, specify cascade on delete
as shown in link:#CHDJIBAJ[Example 2-19]

[[CHDJIBAJ]][[TLJPA355]]

*_Example 2-19 Using <cascade-on-delete> XML_*

[source,oac_no_warn]
----
...
<cascade-on-delete>true</cascade-on-delete>
...
----

[[sthref52]]

*See Also*

For more information, see:

* EclipseLink example:
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/DeleteCascade`
* "@CascadeOnDelete"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Schema_Generation/CascadeOnDelete`
* "Enhancing Performance" in _Solutions Guide for EclispeLink_

[[CEGCCCCJ]][[TLJPA356]]

'''''

=== @ChangeTracking

Use `@ChangeTracking` to specify the
`org.eclipse.persistence.descriptors.changetracking.ObjectChangePolicy`.
This policy computes change sets for the EclipseLink commit process and
optimizes the transaction by including objects in the change set
calculation that have at least one changed attribute.

[[sthref53]]

*Annotation Elements*

link:#BCGCIDCD[Table 2-9] describes this annotation's elements.

[[TLJPA357]][[sthref54]][[BCGCIDCD]]

*_Table 2-9 @ChangeTracking Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`ChangeTrackingType` a|
(Optional) The change tracking policy to use:

* `ATTRIBUTE` – The object's `set` method is weaved to raise change
events to collect changes as they are made.
+
Requires usage of weaving, and LAZY collection relationships, or eager
weaving.
* `OBJECT` – The object's set method is weaved to mark the object as
_dirty_. Any dirty objects are compared against a copy of their original
state for changes on commit or flush operations.
+
Requires usage of weaving, and LAZY collection relationships, or eager
weaving.
* `DEFERRED` – All managed objects are compared against a copy of their
original state for changes on commit or flush.
+
Does not require weaving.
* `AUTO` – Does not set any change tracking policy; change tracking will
be determined at runtime.

 |`AUTO`
|=======================================================================


[[sthref55]]

*Usage*

Use this annotation to configure an alternative change policy, if the
automatic policy is having issues with your application. Using
`@ChangeTracking` may improve commit performance for objects with few
attributes or objects with many changed attributes.


NOTE: When using change tracking with `ATTRIBUTE` or `OBJECT`, if you modify
an object's field through reflection, EclipseLink _will not_ detect the
change. However, if you use `DEFERRED`, EclipseLink _will_ detect the
change.

[[sthref56]]

*Examples*

link:#BCGCHJHG[Example 2-20] shows how to use `@ChangeTracking` to set
the unit of work's change policy.

[[BCGCHJHG]][[TLJPA358]]

*_Example 2-20 Using @ChangeTracking Annotation_*

[source,oac_no_warn]
----
@ChangeTracking(DEFERRED)
@Entity
public class Employee {
    ...
}
----

link:#BCGHFGBB[Example 2-21] shows how to use the `<change-tracking>`
element in the `eclipselink-orm.xml` file.

[[BCGHFGBB]][[TLJPA359]]

*_Example 2-21 Using <change-tracking> XML_*

[source,oac_no_warn]
----
<entity class="Employee"
    <change-tracking type="DEFERRED"/>
...
</entity>
----

link:#BCGICDII[Example 2-22] shows how to configure change tracking in
the persistence unit `persistence.xml` file or by importing a `property`
map.

[[BCGICDII]][[TLJPA360]]

*_Example 2-22 Specifying Change Tracking in persistence.xml_*

Using `persistence.xml` file:

[source,oac_no_warn]
----
<property name="eclipselink.weaving.changetracking" value="false"/>
----

Using `property` map:

[source,oac_no_warn]
----
import org.eclipse.persistence.config.PersistenceUnitProperties;
propertiesMap.put(PersistenceUnitProperties.WEAVING_CHANGE_TRACKING, "false");
----

[[sthref57]]

* +
See Also*

For more information, see:

* xref:{relativedir}/persistenceproperties_ref.adoc#weaving["weaving"]
* "Enhancing Performance" in _Solutions Guide for EclispeLink_

[[BGBHAADB]][[TLJPA361]]

'''''

=== @ClassExtractor

Use `@ClassExtractor` to define a custom class indicator in place of
providing a discriminator column.

[[sthref58]]

*Annotation Elements*

link:#BABGCAFI[Table 2-10] describes this annotation's elements.

[[TLJPA362]][[sthref59]][[BABGCAFI]]

*_Table 2-10 @ClassExtractor Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`java.lang.Class` |(Required) The name of the class extractor to apply
to the entity's descriptor | +
|=======================================================================


[[sthref60]]

*Usage*

If you are mapping to an existing database, and the tables do not have a
discriminator column you can still define inheritance using the
`@ClassExtractor` annotation or `<class-extractor>` element. The class
extractor takes a class that implements the `ClassExtractor` interface.
An instance of this class is used to determine the class type to use for
a database row. The class extractor must define a `extractClassFromRow`
method that takes the database `Record` and `Session`.

If a class extractor is used with `SINGLE_TABLE` inheritance, the rows
of the class type must be able to be filtered in queries. This can be
accomplished by setting an `onlyInstancesExpression` or
`withAllSubclassesExpression` for branch classes. These can be set to
`Expression` objects using a `DescriptorCustomizer`.

[[sthref61]]

*Examples*

link:#BGBEDADF[Example 2-23] shows an example of using `ClassExtractor`
to define inheritance.

[[BGBEDADF]][[TLJPA363]]

*_Example 2-23 Using @ClassExtractor Annotation_*

[source,oac_no_warn]
----
@Entity
@Table(name="MILES_ACCOUNT")
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
@ClassExtractor(AirMilesClassExtractor.class)
@Customizer(AirMilesCustomizer.class)
public class AirMilesAccount implements Serializable {
    @Id
    private Long id;
    @Basic
    private String totalMiles;
    @Basic
    private String milesBalance;
    ...
}
 
@Entity
@Customizer(PreferredCustomizer.class)
public class PreferredAccount extends AirMilesAccount {
    ...
}
 
public class AirMilesClassExtractor implements ClassExtractor {
    public void extractClassFromRow(Record row, Session session) {
        if (row.get("TOTALMILES").lessThan(100000)) {
            return AirMilesAccount.class;
        } else {
            return PreferredAccount.class;
        }
    }
}
 
public class AirMilesCustomizer implements DescriptorCustomizer {
    public void customize(ClassDescriptor descriptor) {
        ExpressionBuilder account = new ExpressionBuilder();
        Expression expression = account.getField("TOTALMILES").lessThan(100000);
        descriptor.getInheritancePolicy().setOnlyInstancesExpression(expression);
    }
}
 
public class PreferredCustomizer implements DescriptorCustomizer {
    public void customize(ClassDescriptor descriptor) {
        ExpressionBuilder account = new ExpressionBuilder();
        Expression expression = account.getField("TOTALMILES").greaterThanEqual(100000);
        descriptor.getInheritancePolicy().setOnlyInstancesExpression(expression);
    }
}
----

link:#BABDIJEG[Example 2-24] shows how to use the `<class-extractor>`
element in the `eclipselink-orm.xml` file.

[[BABDIJEG]][[TLJPA364]]

*_Example 2-24 Using <class-extractor> XML_*

[source,oac_no_warn]
----
<entity class="AirMilesAccount">
    <table name="MILES_ACCOUNT"/>
    <inheritance strategy="SINGLE_TABLE"/>
    <class-extractor class="AirMilesClassExtractor"/>
...
</entity>
 
<entity class="PreferredAccount">
    <customizer class="PreferredCustomizer"/>
...
</entity>
----

[[sthref62]]

*See Also*

For more information, see:

* "Entities" in _Understanding EclipseLink_
* link:#CHDCCDGC["@Customizer"]

[[CDDJGFHA]][[TLJPA365]]

'''''

=== @CloneCopyPolicy

Use `@CloneCopyPolicy` to specify an
`org.eclipse.persistence.descriptors.copying.CloneCopyPolicy` on an
Entity.

[[sthref63]]

*Annotation Elements*

link:#BABFHGIH[Table 2-11] describes this annotation's elements.

[[TLJPA366]][[sthref64]][[BABFHGIH]]

*_Table 2-11 @CloneCopyPolicy Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`method` |(Optional) The method that will be used to create a clone for
comparison with EclispeLink's `DeferredChangeDetectionPolicy` | +

|`workingCopyMethod` |(Optional) The `workingCopyoMethod` that will be
used to create a clone that will be used when registering an object in
an EclipseLink `UnitOfWork` | +
|=======================================================================

NOTE: You must specify either a `method` or `workingCopyMenthod`.

[[sthref65]]

*Usage*

The clone `method` should perform a shallow clone of the object. This
can be used to clone non-persistent fields from a instance in the shared
cache.

You can specify `@CloneCopyPolicy` on an Entity, MappedSuperclass, or
Embeddable class.

[[sthref66]]

*Examples*

link:#BABEIGHC[Example 2-25] and link:#BABJAHCB[Example 2-26] show
several examples of the `@CloneCopyPolicy` annotation and
`<clone-copy-policy>` XML element, respectively.

[[BABEIGHC]][[TLJPA367]]

*_Example 2-25 Using @CloneCopyPolicy Annotation_*

[source,oac_no_warn]
----
@CloneCopyPolicy(method="myClone")
----

[source,oac_no_warn]
----
@CloneCopyPolicy(method="myClone", workingCopyMethod="myWorkingCopyClone")
----

[source,oac_no_warn]
----
@CloneCopyPolicy(workingCopyMethod="myWorkingCopyClone")
----

[[BABJAHCB]][[TLJPA368]]

*_Example 2-26 Using <clone-copy-policy> XML_*

[source,oac_no_warn]
----
<clone-copy-policy type="copy" method="myClone" workingCopyMethod="myWorkingCopyClone"/>
----

[source,oac_no_warn]
----
<clone-copy-policy type="copy" workingCopyMethod="myWorkingCopyClone"/>
----

[source,oac_no_warn]
----
<clone-copy-policy type="copy" method="myClone"/>
 
----

[[sthref67]]

*See Also*

For more information, see:

* _Understanding EclipseLink_
* link:#BGBDGCDJ["@CopyPolicy"]
* link:#CHDCJEIG["@InstantiationCopyPolicy"]

[[BGBHHCJH]][[TLJPA369]]

'''''

=== @CompositeMember

Use `@CompositeMember` to indicate that a class belongs to a composite
persistence unit.

It should be used if target type is a primitive type and
`@CollectionTable` designates the table that belongs to composite member
persistence unit other than the source composite member persistence
unit. This allows the source and target to be mapped to different
databases.

[[sthref68]]

*Annotation Elements*

link:#BABBCHAA[Table 2-12] describes this annotation's elements.

[[TLJPA370]][[sthref69]][[BABBCHAA]]

*_Table 2-12 @CompositeMember Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`value` |The name of a target composite member persistence unit to
which element table belongs (if differs from source composite member
persistence unit | +
|=======================================================================

[[sthref70]]

*Usage*

The `@CompositeMember` annotation is ignored unless it is in a composite
member persistence unit. It may be used in conjunction with
`@ElementCollection` and `@CollectionTable` annotations.

[[sthref71]]

*Examples*

You can configure the `CompositeMember` using annotations or the
`eclipselink-orm.xml` file, as shown in these examples.

[[TLJPA371]]

*_Example 2-27 Using @CompositeMember Annotation_*

[source,oac_no_warn]
----
@ElementCollection()
@CollectionTable(name = "MBR1_RESPONS", joinColumns=@JoinColumn(name="EMP_ID"))
@CompositeMember("branch-database")
@Column(name = "DESCRIPTION")
public Collection<String> getResponsibilities() {
    return responsibilities;
}
----

[[TLJPA372]]

*_Example 2-28 Using <composite-member> XML_*

[source,oac_no_warn]
----
<element-collection name="responsibilities" composite-member="branch-database">
  <column name="DESCRIPTION"/>
  <collection-table name="XML_MBR3_RESPONS">
    <join-column name="EMP_ID"/>
  </collection-table>
</element-collection>
----

[[sthref74]]

*See Also*

For more information, see:

* "Using Multiple Databases with a Composite Persistence Unit" in
_Solutions Guide for EclispeLink_
* xref:{relativedir}/persistenceproperties_ref.adoc#composite-unit["composite-unit"]
* xref:{relativedir}/persistenceproperties_ref.adoc#compositeunitmember["composite-unit.member"]
* "Composite Persistence Units"
`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Composite_Persistence_Units`

[[CBBJAJCH]][[TLJPA373]]

'''''

=== @ConversionValue

Use `@ConversionValue` to specify the database and object values for an
`ObjectTypeConverter`.

[[sthref75]]

*Annotation Elements*

link:#BABBEGIB[Table 2-13] describes this annotation's elements.

[[TLJPA374]][[sthref76]][[BABBEGIB]]

*_Table 2-13 @ConversionValue Annotation Elements_*

|==============================================
|*Annotation Element* |*Description* |*Default*
|`dataValue` |(Required) The database value | +
|`objectValue` |(Required) The object value | +
|==============================================

[[sthref77]]

*Usage*

The JPA specification allows you to map an `Enum` to database columns
using the `@Enumerated` annotation, when the database value is either
the name of the `Enum` or its ordinal value. With EclipseLink, you can
also map an `Enum` to a coded value, using a converter.

[[sthref78]]

*Examples*

In link:#BABFEJHJ[Example 2-29], the `enum` `Gender(MALE, FEMALE)` is
mapped to a single character in the database where M=MALE and F=FEMALE.

[[BABFEJHJ]][[TLJPA375]]

*_Example 2-29 Using @ConversionValue Annotation_*

[source,oac_no_warn]
----
@ObjectTypeConverter(name = "gender", objectType = Gender.class, dataType = String.class, conversionValues = {
  @ConversionValue(objectValue = "Male", dataValue = "M"),
  @ConversionValue(objectValue = "Female", dataValue = "F") })

...

@Basic
@Convert("gender")
private Gender gender = Gender.Male;
----

link:#BABIHAFA[Example 2-30] illustrates the same function using XML.

[[BABIHAFA]][[TLJPA376]]

*_Example 2-30 Using <conversion-value> XML_*

[source,oac_no_warn]
----
<object-type-converter name="gender" object-type="model.Gender   "data-type="java.lang.String">
  <conversion-value object-value="Male" data-value="M" />
  <conversion-value object-value="Female" data-value="F" />
</object-type-converter>

...

<basic name="gender">
  <column name="GENDER" />
  <convert>gender</convert>
</basic>
----

[[sthref79]]

*See Also*

For more information, see:

* link:#BGBBDGAI["@ObjectTypeConverter"]
* _Understanding EclipseLink_

[[BEHGJHCD]][[TLJPA377]]

'''''

=== @Convert

Use `@Convert` to specify that a named converter should be used with the
corresponding mapped attribute.

[[sthref80]]

*Annotation Elements*

link:#BEHICGDB[Table 2-14] describes this annotation's elements.

[[TLJPA378]][[sthref81]][[BEHICGDB]]

*_Table 2-14 @Convert Annotation Elements_*

|================================================================
|*Annotation Element* |*Description* |*Default*
|`value` |(Optional) The `String` name for your converter |`none`
|================================================================

[[sthref82]]

*Usage*

The `@Convert` has the following reserved names:

* *serialized* – Places the
`org.eclipse.persistence.mappings.converters.SerializedObjectConverter`
on the associated mapping.
* *class-instance* – Uses an `ClassInstanceConverter` on the associated
mapping. When using a `ClassInstanceConverter`, the database
representation is a `String` representing the Class name and the
object-model representation is an instance of that class built with a
no-args constructor
* *none* – Does not place a converter on the associated mapping.

[[sthref83]]

*Examples*

link:#BEHFAGHF[Example 2-31] shows how to use the `@Convert` annotation
to define the `gender` field.

[[BEHFAGHF]][[TLJPA379]]

*_Example 2-31 Using the `@Convert` Annotation_*

[source,oac_no_warn]
----
@Entity
 @Table(name="EMPLOYEE")
 @Converter(
     name="genderConverter",
         converterClass=org.myorg.converters.GenderConverter.class
 )
 public class Employee implements Serializable{
     ...
     @Basic
     @Convert("genderConverter")
     public String getGender() {
         return gender;
     }
     ...
 }
----

[[sthref84]]

*See Also*

For more information, see:

* link:#CHDEHJEB["@Converter"]
* link:#BGBBDGAI["@ObjectTypeConverter"]
* link:#CHDHCCJF["@TypeConverter"]
* _Understanding EclipseLink_

[[CHDEHJEB]][[TLJPA380]]

'''''

=== @Converter

Use the `@Converter` annotation to specify a custom converter for
modification of the data value(s) during the reading and writing of a
mapped attribute.

[[sthref85]]

*Annotation Elements*

link:#BGBJIHHG[Table 2-15] describes this annotation's elements.

[[TLJPA381]][[sthref86]][[BGBJIHHG]]

*_Table 2-15 @Converter Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |The `String` name for your converter, must be unique across the
persistence unit |none

|`converterClass` |The class of your converter. This class must
implement the `org.eclipse.persistence.mappings.converters.Converter`
interface. |none
|=======================================================================

 +

[[sthref87]]

*Usage*

Use `@Converter` to define a named converter that can be used with
mappings. A converter can be defined on an entity class, method, or
field. Specify a converter with the link:#BEHGJHCD[@Convert] annotation
on a Basic or ElementCollection mapping.

[[TLJPA382]]

*Using non-JPA Converter Annotations*

EclipseLink provides a set of non-JPA converter annotations (in addition
to the JPA default type mappings):

* @Converter
* link:#CHDHCCJF[@TypeConverter]
* link:#BGBBDGAI[@ObjectTypeConverter]
* link:#BGBJEBBB[@StructConverter]
* link:#BEHGJHCD[@Convert]

The persistence provider searches the converter annotations in the
following order:

1.  `@Convert`
2.  `@Enumerated`
3.  `@Lob`
4.  `@Temporal`
5.  Serialized (automatic)

Specify the converters on the following classes:

* `@Entity`
* `@MappedSuperclass`
* `@Embeddable`

Use the converters with the following mappings:

* `@Basic`
* `@Id`
* `@Version`
* `@ElementCollection`

An exception is thrown if a converter is specified with any other type
of mapping annotation.

[[sthref88]]

*Examples*

link:#CHDFGEFJ[Example 2-32] shows how to use the `@Converter`
annotation to specify a converter class for the `gender` field.

[[CHDFGEFJ]][[TLJPA383]]

*_Example 2-32 Using the @Converter Annotation_*

[source,oac_no_warn]
----
@Entity
 public class Employee implements Serializable{
    ...
     @Basic
     @Converter (
         name="genderConverter",
         converterClass=org.myorg.converters.GenderConverter.class
     )
     @Convert("genderConverter")
     public String getGender() {
         return gender;
     }
     ...
 }
----

link:#BGBBDAAJ[Example 2-33] shows how to use the `<converter>` element
in the `eclipselink-orm.xml` file.

[[BGBBDAAJ]][[TLJPA384]]

*_Example 2-33 Using <converter> XML_*

[source,oac_no_warn]
----
<entity class="Employee">
...
    <attributes>
    ...
      <basic name="gender">
        <convert>genderConverter</convert>
        <converter name="genderConverter" class="org.myorg.converters.GenderConverter"/>
      </basic>
    ...
    </attributes>
</entity>
----

[[sthref89]]

*See Also*

For more information, see:

* link:#CIHEBAFB["@Converters"]
* link:#BEHGJHCD["@Convert"]
* link:#BEHBBCDB["@MapKeyConvert"]
* _Understanding EclipseLink_

[[CIHEBAFB]][[TLJPA385]]

'''''

=== @Converters

Use `@Converters` annotation to define multiple `@Converter` elements.

[[sthref90]]

*Annotation Elements*

link:#BCFIJFIB[Table 2-16] describes this annotation's elements.

[[TLJPA386]][[sthref91]][[BCFIJFIB]]

*_Table 2-16 @Converters Annotation Elements_*

|====================================================
|*Annotation Element* |*Description* |*Default*
|`Converter[]` |(Required) An array of converters | +
|====================================================

[[sthref92]]

*Examples*

See link:#CHDEHJEB["@Converter"] for an example of this annotation.

[[sthref93]]

*See Also*

For more information, see:

* link:#CHDEHJEB["@Converter"]
* _Understanding EclipseLink_

[[BGBDGCDJ]][[TLJPA387]]

'''''

=== @CopyPolicy

Use `@CopyPolicy` to set an
`org.eclipse.persistence.descriptors.copying.CopyPolicy` on an entity to
produce a copy of the persistent element.

[[sthref94]]

*Annotation Elements*

link:#BABFHFGC[Table 2-17] describes this annotation's elements.

[[TLJPA388]][[sthref95]][[BABFHFGC]]

*_Table 2-17 @CopyPolicy Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`java.lang.Class` |(Required) The class of the copy policy. The class
must implement `org.eclipse.persistence.descriptors.copying.CopyPolicy`.
|
|=======================================================================

[[sthref96]]

*Usage*

You can specify `@CopyPolicy` on an Entity, MappedSuperclass, or
Embeddable class.

[[sthref97]]

*Examples*

link:#BABCIIIJ[Example 2-34] shows how to use this annotation.

[[BABCIIIJ]][[TLJPA389]]

*_Example 2-34 Using @CopyPolicy Annotation_*

[source,oac_no_warn]
----
@Entity
  @Table(name="EMPLOYEE")
  @CopyPolicy(mypackage.MyCopyPolicy.class)
  public class Employee implements Serializable {
    ...
  }
----

link:#BABECEEG[Example 2-35] shows how to use the `<copy-policy>`
element in the `eclipselink-orm.xml` file.

[[BABECEEG]][[TLJPA390]]

*_Example 2-35 Using <copy-policy> XML_*

[source,oac_no_warn]
----
<entity class="Employee">
  <table name="EMPLOYEE"/>
  <copy-policy class="mypackage.MyCopyPolicy"/>
...
</entity>
----

[[sthref98]]

*See Also*

For more information, see:

* link:#CDDJGFHA["@CloneCopyPolicy"]
* link:#CHDCJEIG["@InstantiationCopyPolicy"]
* _Understanding EclipseLink_

[[CHDCCDGC]][[TLJPA391]]

'''''

=== @Customizer

Use `@Customizer` to specify a class that implements
`org.eclipse.persistence.config.DescriptorCustomizer` and is to run
against an entity's class descriptor after all metadata processing has
been completed.

[[sthref99]]

*Annotation Elements*

link:#BABCJCHB[Table 2-18] describes this annotation's elements.

[[TLJPA392]][[sthref100]][[BABCJCHB]]

*_Table 2-18 @Customizer Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`java.lang.Class` |(Required) The name of the descriptor customizer to
apply to the entity's descriptor |
|=======================================================================

[[sthref101]]

*Usage*

Use this annotation to customize or extend the mapping metadata through
the EclipseLink native API. With `@Customizer`, you can access
additional EclipseLink functionality and configurations.

You can specify `@Customizer` on an Entity, MappedSuperclass, or
Embeddable class.

NOTE: A `@Customizer` is not inherited from its parent classes.

[[sthref102]]

*Examples*

link:#BABBFAGB[Example 2-36] show how to use the `@Customizer`
annotation with the following `DescriptorCustomer`:

[source,oac_no_warn]
----
public class MyCustomizer implements DescriptorCustomizer {
  public void customize(ClassDescriptor descriptor) {
    DirectToFieldMapping genderMapping = (DirectToFieldMapping)descriptor.getMappingForAttributeName("gender");
    ObjectTypeConverter converter = new ObjectTypeConverter();
    convert.addConversionValue("M", Gender.MALE);
    convert.addConversionValue("F", Gender.FEMALE);
    genderMapping.setConverter(converter);
  }
}
----

[[BABBFAGB]][[TLJPA393]]

*_Example 2-36 Using @Customizer Annotation_*

[source,oac_no_warn]
----
@Entity
 @Table(name="EMPLOYEE")
 @Customizer(mypackage.MyCustomizer.class)
 public class Employee implements Serializable {
     ...
 }
----

link:#BABDJIFC[Example 2-37] show how to use the `<customizer>` element
in the `eclipselink-orm.xml` file.

[[BABDJIFC]][[TLJPA394]]

*_Example 2-37 Using <customizer> XML_*

[source,oac_no_warn]
----
<entity class="Employee">
  <table name="EMPLOYEE"/>
  <customizer class="mypackage.MyCustomizer"/>
...
</entity>
----

[[sthref103]]

*See Also*

For more information, see:

* xref:{relativedir}/persistenceproperties_ref.adoc#descriptorcustomizer["descriptor.customizer"]
* "Binding JPA Entities to XML" in _Solutions Guide for EclispeLink_
* EclipseLink Examples
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/MappingSelectionCriteria`
* "Customizers"
`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Customizers`

[[BABDDGFG]][[TLJPA395]]

'''''

=== @DeleteAll

Use `@DeleteAll` to indicate that when an relationship is deleted,
EclipseLink should use a delete all query. This typically happens if the
relationship is `PrivateOwned` and its owner is deleted. In that case,
the members of the relationship will be deleted without reading them in.

[[sthref104]]

*Annotation Elements*

There are no elements for this annotation.

[[sthref105]]

*Usage*

|=======================================================================
a|
*WARNING:*

*Use this annotation with caution. EclipseLink will not validate whether
the target entity is mapped in such a way as to allow the delete all to
work.*

|=======================================================================


[[sthref106]]

*Examples*

link:#CBHBIFII[Example 2-38] shows how to use `@DeleteAll` on a
relationship mapping.

[[CBHBIFII]][[TLJPA396]]

*_Example 2-38 Using @DeleteAll Annotation_*

[source,oac_no_warn]
----
@Entity
public class Department {
  ...
  @OneToMany(mappedBy = "department")
  @PrivateOwned
  @DeleteAll
  public List<Equipment> getEquipment() {
    return equipment;
    }
  ...
  }
 
----

link:#CBHBIFII[Example 2-38] shows how to use the `<delete-all>` element
in the `eclipselink-orm.xml` file.

[[TLJPA397]]

*_Example 2-39 Using <delete-all> XML_*

[source,oac_no_warn]
----
<entity class="Department">
  ...
  <attributes>
    <one-to-many name="equipment" target-entity="Equipment" mapped-by="department">
      <private-owned/>
      <delete-all/>
    </one-to-many>
...
</attributes>
</entity>
----

[[sthref108]]

*See Also*

For more information, see:

* link:#CHDDDDAI["@PrivateOwned"]

[[CIHGDDED]][[TLJPA398]]

'''''

=== @DiscriminatorClass

Use `@DiscriminatorClass` with a `@VariableOneToOne` annotation to
determine which entities will be added to the list of types for the
mapping.

[[sthref109]]

*Annotation Elements*

link:#BABGACBF[Table 2-19] describes this annotation's elements.

[[TLJPA399]][[sthref110]][[BABGACBF]]

*_Table 2-19 @DiscriminatorClass Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`discriminator` |(Required) The discriminator to be stored in the
database |

|value |(Required) The class to be instantiated with the `discriminator`
|
|=======================================================================

[[sthref111]]

*Usage*

The `@DiscriminatorClass` annotation can be specified only within a
`@VariableOneToOne` mapping.

[[sthref112]]

*Examples*

See link:#CHDDFDGF["@VariableOneToOne"] for an example of a variable
one-to-one mapping with `@DiscriminatorClass`.

[[sthref113]]

*See Also*

For more information, see:

* link:#CHDDFDGF["@VariableOneToOne"]
* _Understanding EclipseLink_

[[BEICFBDD]][[TLJPA400]]

'''''

=== @ExcludeDefaultMappings

Use `@ExcludeDefaultMappings` to specify that no default mapping should
be added to a specific class. Instead, EclipseLink will use only
mappings that are explicitly defined by annotations or the XML mapping
file.

[[sthref114]]

*Annotation Elements*

There are no elements for this annotation.

[[sthref115]]

*Usage*

You can specify `@ExcludeDefaultMappings` on an Entity,
MappedSuperclass, or Embeddable class.

[[sthref116]]

*Examples*

link:#BACGGFEH[Example 2-40] shows how to use the
`@ExcludeDefaultMapping` annotation.

[[BACGGFEH]][[TLJPA54002]]

*_Example 2-40 Using the @ExcludeDefaultMappings Annotation_*

[source,oac_no_warn]
----
@ExcludeDefaultMappings
@Entity
public class Dealer {
    @Id
    private long id;
    @Basic
    private String name;
    // These would be ignored
    private List<Card> deck;
    private List<Card> hand;
    ...
}
----

[[sthref117]]

*See Also*

For more information, see:

* "Building Blocks for a EclipseLink Project" in _Understanding
EclipseLink_

[[BABICJEJ]][[TLJPA401]]

'''''

=== @ExistenceChecking

Use `@ExistenceChecking` to specify how EclipseLink should check to
determine if an entity is new or exists.

On `merge()` operations, use `@ExistenceChecking` to specify if
EclipseLink uses only the cache to determine if an object exists, or if
the object should be read (from the database or cache). By default the
object will be read from the database.

[[sthref118]]

*Annotation Elements*

link:#CEGHFAIB[Table 2-20] describes this annotation's elements.

[[TLJPA402]][[sthref119]][[CEGHFAIB]]

*_Table 2-20 @ExistenceChecking Annotation Elements_*

|==============================================
|*Annotation Element* |*Description* |*Default*
|`ExistenceType` a|
(Optional) Set the existence checking type:

* `ASSUME_EXISTENCE`
* `ASSUME_NON_EXISTENCE`
* `CHECK_CACHE`
* `CHECK_DATABASE`

 |`CHECK_CACHE`
|==============================================

[[sthref120]]

*Usage*

You can specify `@ExistenceChecking` on an Entity or MappedSuperclass.

EclipseLink supports the following existence checking types:

* `ASSUME_EXISTENCE` – If the object's primary key does not include
`null` then it must exist. You may use this option if the application
guarantees or does not care about the existence check.
* `ASSUME_NON_EXISTENCE` – Assume that the object does not exist. You
may use this option if the application guarantees or does not care about
the existence check. This will always force an `INSERT` operation.
* `CHECK_CACHE` – If the object's primary key does not include `null`
and it is in the cache, then it must exist.
* `CHECK_DATABASE` – Perform a `SELECT` on the database.

[[sthref121]]

*Examples*

link:#CEGDGCHF[Example 2-41] shows how to use this annotation.

[[CEGDGCHF]][[TLJPA54003]]

*_Example 2-41 Using @ExistenceChecking Annotation_*

[source,oac_no_warn]
----
@Entity
@Cache(type=CacheType.HARD_WEAK,  expiryTimeOfDay=@TimeOfDay(hour=1))
@ExistenceChecking(ExistenceType.CHECK_DATABASE)
public  class  Employee  implements  Serializable  { 
...
}
----

[[sthref122]]

*See Also*

For more information, see:

* link:#CHDBBIHE["@Cache"]
* "Enhancing Performance" in _Solutions Guide for EclispeLink_

[[BABCHIGE]][[TLJPA403]]

'''''

=== @FetchAttribute

Use `@FetchAttribute` to improve performance within a fetch group; it
allows on-demand loading of a group of an object's attributes. As a
result, the data for an attribute might not be loaded from the
datasource until an explicit access call occurs.

This avoids loading all the data of an object's attributes if the user
requires only some of the attributes.

[[sthref123]]

*Annotation Elements*

link:#BABDFABA[Table 2-21] describes this annotation's elements.

[[TLJPA404]][[sthref124]][[BABDFABA]]

*_Table 2-21 @FetchAttribute Annotation Elements_*

|==================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) Name of the fetch attribute | +
|==================================================

[[sthref125]]

*Usage*

EclipseLink provides two types of fetch groups:

* Pre-defined fetch groups at the Entity or MappedSuperclass level
* Dynamic (use case) fetch groups at the query level

You should extensively review your use cases when using fetch groups. In
many cases, additional round-trips will offset any gains from deferred
loading.

[[sthref126]]

* +
Examples*

link:#BABFDFHD[Example 2-42] shows how to use `@FetchAttribute` within a
`@FetchGroup` annotation.

[[BABFDFHD]][[TLJPA405]]

*_Example 2-42 Using @FetchAttribute Annotation_*

[source,oac_no_warn]
----
@Entity
@FetchGroup(name="basic-fetch-group", attributes={
        @FetchAttribute(name="id"), 
        @FetchAttribute(name="name"),
        @FetchAttribute(name="address")}) 
public class Person {
 
   @Id
   private int id;
 
   private String name;
 
   @OneToOne(fetch=LAZY)
   private Address address;
 
   @ManyToOne(fetch=EAGER)
   private ContactInfo contactInfo;
----

[[TLJPA54004]]

*_Example 2-43 Using <fetch-group> XML_*

[source,oac_no_warn]
----
<fetch-group name="basic-fetch-group">
    <attribute name="id"/>
    <attribute name="name"/>
    <attribute name="address"/>
</fetch-group>
----

[[sthref128]]

*See Also*

For more information, see:

* _Understanding EclipseLink_
* link:#BABJBDEG["@FetchGroup"]

[[BABJBDEG]][[TLJPA406]]

'''''

=== @FetchGroup

Use `@FetchGroup` to load a group of attributes on demand, as needed.

This avoids wasteful practice of loading all data of the object's
attributes, if the user is interested in only partial of them. However,
it also means that the data for an attribute might not be loaded from
the underlying data source until an explicit access call for the
attribute first occurs.

[[sthref129]]

*Annotation Elements*

link:#BABFGBBD[Table 2-22] describes this annotation's elements.

[[TLJPA407]][[sthref130]][[BABFGBBD]]

*_Table 2-22 @FetchGroup Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`FetchAttribute[] attributes` |(Required) The list of attributes to
fetch |none

|`java.lang.String name` |(Required) The fetch group name |none

|`boolean load` |(Optional) Indicates whether all relationship
attributes specified in the fetch group should be loaded. |`false`
|=======================================================================

[[sthref131]]

*Usage*

You should perform a careful use case analysis when using `@FetchGroup`;
any gains realized from the deferred loading could be offset by the
extra round-trip.

EclipseLink supports fetch groups at two levels:

* Pre-defined fetch groups at the Entity or MappedSuperclass level
* Dynamic (use case) fetch groups at the query level

You can use fetch groups only when using weaving or when individual
classes that define them explicitly implement the
`org.eclipse.persistence.queries.FetchGroupTracker` interface.

When using a fetch group, you can define a subset of an object's
attributes and associate the fetch group with a query. When you execute
the query, EclipseLink retrieves only the attributes in the fetch group.
EclipseLink automatically executes a query to fetch all the attributes
excluded from this subset when and if you call a get method on any one
of the excluded attributes.

You can define more than one fetch group for a class. You can optionally
designate at most one such fetch group as the default fetch group. If
you execute a query without specifying a fetch group, EclipseLink will
use the default fetch group, unless you configure the query otherwise.

Before using fetch groups, it is recommended that you perform a careful
analysis of system use. In many cases, the extra queries required to
load attributes not in the fetch group could well offset the gain from
the partial attribute loading.

[[sthref132]]

*Examples*

link:#BABGHDJB[Example 2-44] shows how to use this annotation.

[[BABGHDJB]][[TLJPA408]]

*_Example 2-44 Using @FetchGroup Annotation_*

[source,oac_no_warn]
----
@FetchGroup(name="names", attributes={
    @FetchAttribute(name="firstName"), 
    @FetchAttribute(name="lastName")})
----

link:#CACEFCDH[Example 2-45] shows how to use this feature in the
`eclipselink-orm.xml` file.

[[CACEFCDH]][[TLJPA409]]

*_Example 2-45 Using <fetch-group> XML_*

[source,oac_no_warn]
----
<entity class="model.Employee">
    <secondary-table name="SALARY" />
    <fetch-group name="names">
        <attribute name="firstName" />
        <attribute name="lastName" />
    </fetch-group>
...
----

You can also use a named fetch group with a query, as shown in
link:#BABGFDJA[Example 2-46].

[[BABGFDJA]][[TLJPA410]]

*_Example 2-46 Using a Named Fetch Group on a Query_*

[source,oac_no_warn]
----
TypedQuery query = em.createQuery("SELECT e FROM Employee e", Employee.class);
 
query.setHint(QueryHints.FETCH_GROUP_NAME, "names");
----

[[sthref133]]

*See Also*

For more information, see:

* _Understanding EclipseLink_
* link:#BABCHIGE["@FetchAttribute"]
* link:#CHDIEBGG["@FetchGroups"]

[[CHDIEBGG]][[TLJPA411]]

'''''

=== @FetchGroups

Use `@FetchGroups` to define a group of `@FetchGroup`.

[[sthref134]]

*Annotation Elements*

link:#BACDEJEJ[Table 2-23] describes this annotation's elements.

[[TLJPA412]][[sthref135]][[BACDEJEJ]]

*_Table 2-23 @FetchGroups Annotation Elements_*

|=====================================================================
|*Annotation Element* |*Description* |*Default*
|`FetchGroup` |(Required) An array of fetch groups (`@FetchGroup`) | +
|=====================================================================

[[sthref136]]

*Usage*

You can specify `@FetchGroups` on an Entity or MappedSuperclass.

You can also enable or disable fetch groups through weaving for the
persistence unit.

[[sthref137]]

* +
Examples*

See link:#BABJBDEG["@FetchGroup"] for an example of using fetch groups.

link:#CHDJCEHI[Example 2-47] shows how to configure fetch groups in the
persistence unit `persistence.xml` file or by importing a `property`
map.

[[CHDJCEHI]][[TLJPA413]]

*_Example 2-47 Specifying Fetch Groups in persistence.xml_*

Using `persistence.xml` file:

[source,oac_no_warn]
----
<property name="eclipselink.weaving.fetchgroups" value="false"/>
----

Using `property` map:

[source,oac_no_warn]
----
import org.eclipse.persistence.config.PersistenceUnitProperties;
propertiesMap.put(PersistenceUnitProperties.WEAVING_FETCHGROUPS, "false");
----

[[sthref138]]

*See Also*

For more information, see:

* link:#BABJBDEG["@FetchGroup"]
* link:#BABCHIGE["@FetchAttribute"]
* xref:{relativedir}/persistenceproperties_ref.adoc#weaving["weaving"]

[[CBHHCHAC]][[TLJPA414]]

'''''

=== @Field

Use `@Field` to define a structured data type's field name for an object
mapped to NoSql data.

[[sthref139]]

*Annotation Elements*

link:#CBHEEEGE[Table 2-24] describes this annotation's elements.

[[TLJPA415]][[sthref140]][[CBHEEEGE]]

*_Table 2-24 @Field Annotation Elements_*

|========================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Optional) The data type's name of the field | +
|========================================================

[[sthref141]]

*Usage*

The `@Field` annotation is a generic form of the `@Column` annotation,
which is not specific to relational databases. You can use `@Field` to
map EIS and NoSQL data.

[[sthref142]]

*Examples*

See link:#BJEIEBHC["@NoSql"] for an example of the `@Field` annotation.

[[sthref143]]

*See Also*

For more information, see:

* link:#BJEIEBHC["@NoSql"]

[[CEGBDBEG]][[TLJPA416]]

'''''

=== @HashPartitioning

Use `@HashPartitioning` to partition access to a database cluster by the
hash of a field value from the object (such as the object's location or
tenant). The hash indexes into the list of connection pools.

[[sthref144]]

*Annotation Elements*

link:#CEGCAGJF[Table 2-25] describes this annotation's elements.

[[TLJPA417]][[sthref145]][[CEGCAGJF]]

*_Table 2-25 @HashPartitioning Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) The name of the partition policy. The name must be
unique within the persistence unit. |

|`partitionColumn` |(Required) The database column or query parameter by
which to partition queries |

|`connectionPools` |(Optional) List of connection pool names across
which to partition |All defined pools in the ServerSession

|`unionUnpartitionableQueries` |(Optional) Specify if queries that _do
not_ contain the partition hash should be sent to every database and
union the result. |False
|=======================================================================

[[sthref146]]

*Usage*

All write or read requests for objects with the hash value are sent to
the server. Queries that do not include the field as a parameter will
be:

* Sent to all servers and unioned
+
or
* Handled based on the session's default behavior.

You can enable partitioning on an Entity, relationship, query, or
session/persistence unit. Partition policies are globally named (to
allow reuse) and must set using the `@Partitioned` annotation.

The persistence unit properties support adding named connection pools in
addition to the existing configuration for read/write/sequence. A named
connection pool must be defined for each node in the database cluster.

If a transaction modifies data from multiple partitions, you should use
JTA to ensure proper two-phase commit of the data. You can also
configure an exclusive connection in the EntityManager to ensure that
only a single node is used for a single transaction.

[[sthref147]]

*Examples*

See link:#CHDDAHEB["@Partitioned"] for an example of partitioning with
EclipseLink.

[[sthref148]]

*See Also*

For more information, see:

* "Data
Partitioning"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning`
* link:#CHDDAHEB["@Partitioned"]

[[BABGIFEC]][[TLJPA418]]

'''''

=== @Index

An index is a database structure defined for a table, to improve query
and look-up performance for a set of columns. Use the `@Index`
annotation in code or the `<index>` element in the `eclipselink-orm.xml`
descriptor to create an index on a table.

An index can be defined on an entity or on an attribute. For the entity
it must define a set of columns to index.

Index creation is database specific. Some databases may not support
indexes. Most databases auto-index primary key and foreign key columns.
Some databases support advanced index DDL options. To create more
advanced index DDL, a DDL script or native query can be used.

[[sthref149]]

*Annotation Elements*

link:#BABCGCDG[Table 2-26] describes this annotation's elements.

[[TLJPA419]][[sthref150]][[BABCGCDG]]

*_Table 2-26 @Index Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`java.lang.String catalog` |(Optional) The catalog of the `INDEX`
|Default catalog

|`java.lang.String[] columnNames` |(Not required when annotated on a
field or method) Specify the set of columns to define the index on. a|
For an Entity, none.

For an attribute, the attribute's column.

|j`ava.lang.String name` |(Optional) The name of the `INDEX`
|`<table>_<column>_INDEX` (but a name should be provided)

|`java.lang.String schema` |(Optional) The schema of the `INDEX`
|Default schema

|`java.lang.String table` |(Optional) The table to define the index on;
defaults to entities primary table. |The entity's primary table.

|`boolean unique` |(Optional) Specify whether the index is unique or
non-unique. |`false`
|=======================================================================

[[sthref151]]

*Usage*

Use `@Index` annotation to index any attributes or columns that will
commonly be used in queries.

[[sthref152]]

*Examples*

This example defines three indexes, one on *first name*, one on *last
name*, and a multiple column index on *first name* _and_ *last name*.

[[TLJPA420]]

*_Example 2-48 Using @Index Annotation_*

[source,oac_no_warn]
----
@Entity
@Index(name="EMP_NAME_INDEX", columns={"F_NAME","L_NAME"})
public class Employee{
    @Id
    private long id;
    @Index
    @Column(name="F_NAME")
    private String firstName;
    @Index
    @Column(name="L_NAME")
    private String lastName;
    ...
}
----

You can also create an index in the `eclipselink-orm.xml` descriptor
using `<index>`, as shown in the following example. Define columns using
the `<column>` subelement. All the attributes supported in the `@Index`
annotation are also supported in the `<index>` element.

[[TLJPA421]]

*_Example 2-49 Using <index> XML_*

[source,oac_no_warn]
----
<index name="EMP_NAME_INDEX" table="EMPLOYEE" unique="true">
    <column>F_NAME</column>
    <column>L_NAME</column>
</index>
----

[[sthref155]]

*See Also*

For more information see:

* link:#CHDHGAIE["@Indexes"]

[[CHDHGAIE]][[TLJPA422]]

'''''

=== @Indexes

Use `@Indexes` to define a set of database indexes for an Entity.

[[sthref156]]

*Annotation Elements*

link:#CHDHCABJ[Table 2-27] describes this annotation's elements.

[[TLJPA423]][[sthref157]][[CHDHCABJ]]

*_Table 2-27 @Indexes Annotation Elements_*

|==============================================
|*Annotation Element* |*Description* |*Default*
|`Index[]` |An array of database indexes | +
|==============================================

[[sthref158]]

*Examples*

See link:#BABGIFEC["@Index"] for an example of using the `@Index`
annotation.

[[sthref159]]

*See Also*

For more information see:

* link:#BGBDGCDJ["@CopyPolicy"]
* link:#CDDJGFHA["@CloneCopyPolicy"]
* link:#BABGIFEC["@Index"]

[[CHDCJEIG]][[TLJPA424]]

'''''

=== @InstantiationCopyPolicy

Use `@InstantiationCopyPolicy` to set an
`org.eclipse.persistence.descriptors.copying.InstantiationCopyPolicy` on
an Entity.

[[sthref160]]

*Annotation Elements*

There are no elements for this annotation.

[[sthref161]]

*Usage*

The copy policy specifies how EclipseLink clones objects to and from the
shared cache. With `@InstantiationCopyPolicy`, in order to clone an
object EclipseLink will create a new instance of the object and copy
each persistent attribute. Alternative methods include
`@CloneCopyPolicy`, which clones the object.

Cloning is more efficient than creating a new instance and maintains
transient or non-persistent attribute values. If you do not need
transient or non-persistent attribute values in the shared cache, then
use `@InstantiationCopyPolicy`.

The default EclipseLink copy policy depends on your configuration:

* When using
xref:{relativedir}/persistenceproperties_ref.adoc#weavinginternal[weaving.internal] (and field
access), EclipseLink generates a specialized clone method to copy
objects.
* Without weaving, EclipseLink uses instantiation to copy objects.

You can specify `@InstantiationCopyPolicy` on an Entity,
MappedSuperclass, or Embeddable entity.

[[sthref162]]

*Examples*

link:#CHDDBCHI[Example 2-50] shows how to use this annotation.

[[CHDDBCHI]][[TLJPA426]]

*_Example 2-50 Using @InstantiationCopyPolicy Annotation_*

[source,oac_no_warn]
----
@Entity
@InstantiationCopyPolicy
public class Employee {
    ...
    transient List events = new ArrayList();
}
----

link:#CHDGCDAI[Example 2-51] shows how to use this extension in the
`eclipselink-orm.xml` file.

[[CHDGCDAI]][[TLJPA427]]

*_Example 2-51 Using <instantiation-copy-policy> XML_*

[source,oac_no_warn]
----
<entity name="Employee" class="org.acme.Employee" access="FIELD">
    <instantiation-copy-policy/>
    ...
</entity>
----

[[sthref163]]

*See Also*

For more information, see:

* link:#BGBDGCDJ["@CopyPolicy"]
* link:#CDDJGFHA["@CloneCopyPolicy"]
* xref:{relativedir}/persistenceproperties_ref.adoc#weavinginternal["weaving.internal"]

[[CEGFFHHA]][[TLJPA428]]

'''''

=== @JoinFetch

Use the `@JoinFetch` annotation to enable the joining and reading of the
related objects in the same query as the source object.

NOTE: You should set join fetching at the query level, as not all queries
require joining.

[[sthref164]]

*Annotation Elements*

link:#CEGFCHJB[Table 2-28] describes this annotation's elements.

[[TLJPA429]][[sthref165]][[CEGFCHJB]]

*_Table 2-28 @JoinFetch Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`value` a|
(Optional) Set this attribute to the
`org.eclipse.persistence.annotations.``JoinFetchType` enumerated type of
the fetch that you will be using.

The following are the valid values for the `JoinFetchType`:

* `INNER`—This option provides the inner join fetching of the related
object.
+
*Note*: Inner joining does not allow for null or empty values.
* `OUTER`—This option provides the outer join fetching of the related
object.
+
*Note*: Outer joining allows for null or empty values.

 |`JoinFetchType.INNER`
|=======================================================================


[[sthref166]]

*Usage*

You can specify the `@JoinFetch` annotation for the following mappings:

* `@OneToOne`
* `@OneToMany`
* `@ManyToOne`
* `@ManyToMany`
* `@ElementCollection`

Alternatively, you can use batch fetching which is more efficient,
especially for collection relationships.

[[sthref167]]

*Examples*

The following example shows how to use the `@JoinFetch` annotation to
specify Employee field `managedEmployees`.

[[TLJPA430]]

*_Example 2-52 Using @JoinFetch Annotation_*

[source,oac_no_warn]
----
@Entity
 public class Employee implements Serializable {
    ...
    @OneToMany(cascade=ALL, mappedBy="owner")
    @JoinFetch(value=OUTER)
    public Collection<Employee> getManagedEmployees() {
        return managedEmployees;
    }
    ...
 }
----

link:#CEGJIBCF[Example 2-53] shows how to use this extension in the
`eclipselink-orm.xml` file.

[[CEGJIBCF]][[TLJPA54005]]

*_Example 2-53 Using <join-fetch> in XML_*

[source,oac_no_warn]
----
<one-to-many name="managedEmployees">
    <join-fetch>OUTER</join-fetch>
</one-to-many>
----

[[sthref169]]

*See Also*

For more information, see:

* _Understanding EclipseLink_
* "Enhancing Performance" in _Solutions Guide for EclispeLink_
* link:#CHDCCIDA["@BatchFetch"]

[[CIHCAFEI]][[TLJPA431]]

'''''

=== @JoinField

Use `@JoinField` to define a structured data type's foreign key field
for an object mapped to NoSql data.

[[sthref170]]

*Annotation Elements*

link:#CIHEHJJH[Table 2-29] describes this annotation's elements.

[[TLJPA432]][[sthref171]][[CIHEHJJH]]

*_Table 2-29 @JoinField Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Optional) The name of the foreign key/ID reference field in
the source record | +

|`referencedFieldName` |(Optional) The name of the ID field in the
target record | +
|=======================================================================

[[sthref172]]

*Usage*

The `@JoinField` annotation is a generic form of the `@JoinColumn`
annotation, which is not specific to relational databases. You can use
`@JoinField` to map EIS and NoSQL data.

[[sthref173]]

*Examples*

These examples show how to use this extension as an annotation and in
XML.

[[CIHCFEJH]][[TLJPA54006]]

*_Example 2-54 Using @JoinField Annotation_*

[source,oac_no_warn]
----
@Entity
@NoSql
public class Order {
    ...
    @ManyToOne
    @JoinField(name="customerId")
    private Customer customer;
}
----

[[TLJPA54007]]

*_Example 2-55 Using <join-field> in XML_*

[source,oac_no_warn]
----
<entity name="Order" class="org.acme.Order">
    <no-sql/>
    ...
    <many-to-one name="customer">
        <join-field name="customerId"/>
    </many-to-one>
</entity>
----

[[sthref175]]

* +
See Also*

For more information, see:

* "Mappings"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/NoSQL/Mappings`
* link:#BEIFHJJE["@JoinFields"]

[[BEIFHJJE]][[TLJPA433]]

'''''

=== @JoinFields

Use `@JoinFields` to define a set of `@JoinField` annotations on a
relationship.

[[sthref176]]

*Annotation Elements*

link:#BEIBIGIJ[Table 2-30] describes this annotation's elements.

[[TLJPA434]][[sthref177]][[BEIBIGIJ]]

*_Table 2-30 @JoinFields Annotation Elements_*

|==============================================
|*Annotation Element* |*Description* |*Default*
|`JoinField[]`J |An array of join fields | +
|==============================================

[[sthref178]]

*Examples*

See link:#CIHCAFEI["@JoinField"] for an example of using the `@Index`
annotation.

[[sthref179]]

*See Also*

For more information, see:

* link:#CIHCAFEI["@JoinField"]

[[BEHBBCDB]][[TLJPA435]]

'''''

=== @MapKeyConvert

Use `@MapKeyConvert` to specify a named converter to be used with the
corresponding mapped attribute key column.

[[sthref180]]

*Annotation Elements*

link:#BEHBBBEH[Table 2-31] describes this annotation's elements.

[[TLJPA436]][[sthref181]][[BEHBBBEH]]

*_Table 2-31 @MapKeyConvert Annotation Elements_*

|==============================================
|*Annotation Element* |*Description* |*Default*
|`value` a|
(Optional) Name of the converter to use:

* `serialized`
* `class-instance`
* `none`
* custom converter

 |none
|==============================================

[[sthref182]]

*Usage*

Use `@MapKeyConvert` to convert the key value used in a `@MapKeyColumn`
to have a different type or value than the database column.

The `@MapKeyConvert` annotation has the following reserved names:

* `serialized`: Will use a `SerializedObjectConverter` on the associated
mapping. When using a `SerializedObjectConverter` the database
representation is a binary field holding a serialized version of the
object and the object-model representation is a the actual object
* `class-instance`: Will use an ClassInstanceConverter on the associated
mapping. When using a ClassInstanceConverter the database representation
is a String representing the Class name and the object-model
representation is an instance of that class built with a no-args
constructor
* `none` - Will place no converter on the associated mapping. This can
be used to override a situation where either another converter is
defaulted or another converter is set.

If you do not use one of these reserved names, you must define a custom
converter, using the `@Converter` annotation.

[[sthref183]]

*Examples*

link:#BEHEHJJC[Example 2-56] shows using a `@MapKeyConvert` annotation
to apply a converter to a map's key.

[[BEHEHJJC]][[TLJPA437]]

*_Example 2-56 Using @MapKeyConvert Annotation_*

[source,oac_no_warn]
----
@Entity
public class Entity
 …
    @ElementCollection
    @MapKeyColumn(name=”BANK”)
    @Column(name=”ACCOUNT”)
    @Convert(”Long2String”)
    @MapKeyConvert(”CreditLine”)
    public Map<String,Long> getCreditLines() {
        return creditLines;
    }
----

link:#BEHCFGDH[Example 2-57] shows how to use the `<map-key-convert>`
element in the `eclipselink-orm.xml` file.

[[BEHCFGDH]][[TLJPA438]]

*_Example 2-57 Using <map-key-convert> XML_*

[source,oac_no_warn]
----
<element-collection name="creditLines">
  <map-key-convert>CreditLine</map-key-convert>
  <map-key-column name="BANK"/>
  <column name="ACCOUNT"/>
  <convert>Long2String</convert>
  <object-type-converter name="CreditLine">
    <conversion-value data-value="RBC" object-value="RoyalBank"/>
    <conversion-value data-value="CIBC" object-value="CanadianImperial"/>
    <conversion-value data-value="SB" object-value="Scotiabank"/>
    <conversion-value data-value="TD" object-value="TorontoDominion"/>
  </object-type-converter>
  <type-converter name="Long2String" data-type="String" object-type="Long"/>
  <collection-table name="EMP_CREDITLINES">
    <join-column name="EMP_ID"/>
  </collection-table>
</element-collection>
----

[[sthref184]]

*See Also*

For more information, see:

* link:#CHDEHJEB["@Converter"]
* link:#BEHGJHCD["@Convert"]

[[BABIEJGD]][[TLJPA707]]

'''''

=== @Multitenant

The `@Multitenant` annotation specifies that a given entity is shared
among multiple tenants of an application. The multitenant type specifies
how the data for these entities are to be stored on the database for
each tenant. Multitenancy can be specified at the entity or mapped
superclass level.

[[sthref185]]

*Annotation Elements*

link:#CHDGJGDC[Table 2-32] describes this annotation's elements.

[[TLJPA708]][[sthref186]][[CHDGJGDC]]

*_Table 2-32 @Multitenant Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`boolean includeCriteria` |Indicates if the database requires the
tenant criteria to be added to the `SELECT`, `UPDATE`, and `DELETE`
queries. |`true`

|`MultitenantType value` |Specifies the multitenant strategy to use:
`SINGLE_TABLE`, `TABLE_PER_TENANT`, or `VPD`. |`SINGLE_TABLE`
|=======================================================================

[[sthref187]]

*Usage*

To use the `@Multitenant` annotation, include the annotation with an
`@Entity` or `@MappedSuperclass` annotation. For example:

[source,oac_no_warn]
----
@Entity
@Multitenant
...
public class Employee() {
  ...
}
 
----

Three types of multitenancy are available:

* link:#BABICDGI[Single-Table Multitenancy]
* link:#BABEGBIJ[Table-Per-Tenanat Multitenancy]
* link:#CHDBFBGI[VPD Multitenancy]

[[sthref188]]

*Example*

link:#BABEHCGI[Example 2-58] shows a simple example of a `@Multitenant`
annotation. In this example, the *Player* entity has rows for multiple
tenants stored in its default `PLAYER` table and that the default
`TENANT_ID` column is used as a discriminator along with the default
context property `eclipselink.tenant-id`.

[[BABEHCGI]][[TLJPA54008]]

*_Example 2-58 Minimal @Multitenant Annotation_*

[source,oac_no_warn]
----
@Entity
@Multitenant
public class Player  {
}
----

To have your application use a shared `EntityManagerFactory` and have
the `EntityManager` be tenant specific, your runtime code might be:

[source,oac_no_warn]
----
Map<String, Object> emProperties = new HashMap<String, Object>();

emProperties.set("eclipselink.tenant-id", "HTHL");

EntityManager em = emf.createEntityManager(emProperties);
----

Review link:#BABICDGI["Single-Table Multitenancy"],
link:#BABEGBIJ["Table-Per-Tenanat Multitenancy"], and
link:#CHDBFBGI["VPD Multitenancy"] for more detailed examples.

[[BABICDGI]][[TLJPA709]]

'''''

==== Single-Table Multitenancy

The `SINGLE_TABLE` multitenant type specifies that any table to which an
entity or mapped superclass maps can include rows for multiple tenants.
Access to tenant-specific rows is restricted to the tenant.

Tenant-specific rows are associated with the tenant by using tenant
discriminator columns. The discriminator columns are used with
application context values to limit what a persistence context can
access.

The results of queries on the mapped tables are limited to the tenant
discriminator value(s) provided as property values. This applies to all
insert, update, and delete operations on the table. When multitenant
metadata is applied at the mapped superclass level, it is applied to all
subentities unless they specify their own multitenant metadata.

NOTE: In the context of single-table multitenancy, ”single-table” means
multiple tenants can share a single table, and each tenant's data is
distinguished from other tenants' data via the discriminator column(s).
It is possible to use multiple tables with single-table multitenancy;
but in that case, an entity's persisted data is stored in multiple
tables (`Table` and `SecondaryTable`), and multiple tenants can share
all the tables.


For more information how to use tenant discriminator columns to
configure single-table multitenancy, see
link:#CHECIDGH["@TenantDiscriminatorColumn"].

[[TLJPA710]][[sthref189]]

*Examples*

The following example uses `@Multitenant`, `@TenantDiscriminatorColumn`,
and a context property to define single-table multitenancy on an entity:

[[TLJPA711]]

*_Example 2-59 Example Using @Multitenant_*

[source,oac_no_warn]
----
@Entity 
@Table(name=”EMP”) 
@Multitenant(SINGLE_TABLE) 
@TenantDiscriminatorColumn(name = ”TENANT_ID”, 
   contextProperty = "employee-tenant.id")
----

The following example uses the `<multitenant>` element to specify a
minimal single-table multitenancy. `SINGLE_TABLE` is the default value
and therefore does not have to be specified.

[[TLJPA712]]

*_Example 2-60 Example Using <multitenant>_*

[source,oac_no_warn]
----
<entity class="model.Employee">
  <multitenant/>
  <table name="EMP"/>
  ...
</entity>
----

[[BABEGBIJ]][[TLJPA713]]

'''''

==== Table-Per-Tenanat Multitenancy

The `TABLE_PER_TENANT` multitenant type specifies that the table(s)
(`Table` and `SecondaryTable`) for an entity are tenant-specific tables
based on the tenant context.. Access to these tables is restricted to
the specified tenant. Relationships within an entity that use a join or
collection table are also assumed to exist within that context.

As with other multitenant types, table-per-tenant multitenancy can be
specified at the entity or mapped superclass level. At the entity level,
a tenant context property must be provided on each entity manager after
a transaction has started.

Table-per-tenant entities can be mixed with other multitenant-type
entities within the same persistence unit.

All read, insert, update, and delete operations for the tenant apply
only to the tenant's table(s).

Tenants share the same server session by default. The table-per-tenant
identifier must be set or updated for each entity manager. ID generation
is assumed to be unique across all the tenants in a table-per-tenant
strategy.

To configure table-per-tenant multitenancy, you must specify:

* A table-per-tenant property to identify the user. This can be set per
entity manager, or it can be set at the entity manager factory to
isolate table-per-tenant per persistence unit.)
* A tenant table discriminator to identify and isolate the tenant's
tables from other tenants' tables. The discriminator types are `SCHEMA`,
`SUFFIX`, and `PREFIX`. For more information about tenant discriminator
types, see link:#CHDFJJEC["@TenantTableDiscriminator"].

[[TLJPA714]][[sthref192]]

*Examples*

The following example shows the `@Multitenant` annotation used to define
table-per-tenant multitenancy on an entity.
`@TenantTableDiscriminator(SCHEMA)` specifies that the discriminator
table is identified by schema.

[[TLJPA715]]

*_Example 2-61 Example Using @Multitenant with
@TenantTableDiscriminator_*

[source,oac_no_warn]
----
@Entity
@Table(name=”EMP”)
@Multitenant(TABLE_PER_TENANT)
@TenantTableDiscriminator(SCHEMA)
public class Employee {
    ...
}
----

The following example shows the `<multitenant>` element and the
`<tenant-table-discriminator>` elements used to define a minimal
table-per-tenant multitenancy.

[[TLJPA716]]

*_Example 2-62 Example Using <multitenant> with
<tenant-table-discriminator>_*

[source,oac_no_warn]
----
<entity class="Employee">
  <multitenant type="TABLE_PER_TENANT">
    <tenant-table-discriminator type="SCHEMA"/>
  </multitenant>
  <table name="EMP">
  ...
</entity>
----

[[CHDBFBGI]][[TLJPA717]]

'''''

==== VPD Multitenancy

The `VPD` (Virtual Private Database) multitanancy type specifies that
the database handles the tenant filtering on all SELECT, UPDATE and
DELETE queries. To use this type, the platform used with the persistence
unit must support VPD.

To use EclipseLink VPD multitenancy, you must first configure VPD in the
database and then specify multitenancy on the entity or mapped
superclass, using `@Multitenant` and `@TenantDiscriminatorColumn`:

[[TLJPA718]][[sthref195]]

*Examples*

link:#CHDIEFCF[Example 2-63] shows VPD multitenancy defined on an
entity. As noted above, VPD in the database must also be configured to
enable VPD multitenancy. In this case, the VPD database was configured
to use the USER_ID column to restrict access to specified rows by
specified clients. Therefore, `USER_ID` is also specified as the tenant
discriminator column for the EclipseLink multitenant operations.

[[CHDIEFCF]][[TLJPA719]]

*_Example 2-63 Example Using @Multitenant(VPD)_*

The following example shows

[source,oac_no_warn]
----
----

[source,oac_no_warn]
----
@Entity
@Multitenant(VPD)
@TenantDiscriminatorColumn(name = "USER_ID", contextProperty = "tenant.id")
@Cacheable(false)
 
public class Task implements Serializable {
...
...
----

The following example shows...

[[TLJPA720]]

*_Example 2-64 Example Using <multitenant>_*

[source,oac_no_warn]
----
<entity class="model.Employee"> 
  <multitenant type="VPD">
    <tenant-discriminator-column name="USER_ID" context-property="tenant.id"/> 
  </multitenant>
  <table name="EMPLOYEE"/>
  ...
</entity>
----

[[sthref197]]

*See Also*

* link:#CHECIDGH["@TenantDiscriminatorColumn"]
* link:#CECBEBEA["@TenantDiscriminatorColumns"]
* "Using Multitenancy" in _Solutions Guide for EclispeLink_
* Multitenant Examples at
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/Multitenant`

[[CHDIFIJF]][[TLJPA454]]

'''''

=== @Mutable

Use `@Mutable` on a `@Basic` mapping to specify if the value of a
complex field type can be _changed_ (or not changed) instead of being
_replaced_. Mutable mappings may affect the performance of change
tracking; attribute change tracking can only be weaved with non-mutable
mappings.

[[sthref198]]

*Annotation Elements*

link:#CHDDHGFD[Table 2-33] describes this annotation's elements.

[[TLJPA455]][[sthref199]][[CHDDHGFD]]

*_Table 2-33 @Mutable Annotation Elements_*

|======================================================================
|*Annotation Element* |*Description* |*Default*
|`boolean value` |(Optional) Specifies if the mapping is mutable. |true
|======================================================================

[[sthref200]]

*Usage*

Most basic types (such as `int`, `long`, `float`, `double`, `String`,
and `BigDecimal`) are not mutable.

By default, `Date` and `Calendar` types are assumed to be not mutable.
To make these types mutable, use the `@Mutable` annotation. You can also
use the global persistence property `eclipselink.temporal.mutable` to
set the mappings as mutable.

By default, serialized types are assumed to be mutable. You can set the
`@Mutable` annotation to `false` to make these types not mutable.

You can also configure mutable mappings for `Date` and `Calendar` fields
in the persistence unit in the `persistence.xml` file.

[[sthref201]]

*Examples*

link:#CHDDJJEE[Example 2-65] shows how to use the `@Mutable` annotation
to specify `Employee` field `hireDate`.

[[CHDDJJEE]][[TLJPA456]]

*_Example 2-65 Using @Mutable Annotation_*

[source,oac_no_warn]
----
@Entity
public class Employee implements Serializable {

    ...

    @Temporal(DATE)
    @Mutable
    public Calendar getHireDate() {
        return hireDate;
    }

..
}
----

link:#CHDCDIBH[Example 2-66] shows how to configure mutable mappings in
the persistence unit `persistence.xml` file or by importing a `property`
map.

[[CHDCDIBH]][[TLJPA457]]

*_Example 2-66 Specifying Mutable Mappings in persistence.xml_*

Using `persistence.xml` file:

[source,oac_no_warn]
----
<property name="eclipselink.temporal.mutable" value="true"/>
----

Using `property` map:

[source,oac_no_warn]
----
import org.eclipse.persistence.config.PersistenceUnitProperties;
propertiesMap.put(PersistenceUnitProperties.TEMPORAL_MUTABLE, "false");
----

[[sthref202]]

*See Also*

For more information, see:

* link:#CACFGAIC["Mapping Annotations"]

[[BGBDHGJE]][[TLJPA458]]

'''''

=== @NamedPLSQLStoredFunctionQueries

Use the `@NamedPLSQLStoredFunctionQueries` annotation to define multiple
`NamedPLSQLStoredFunctionQuery` items.

[[sthref203]]

*Annotation Elements*

link:#CIHJIIDJ2[Table 2-34] describes this annotation's elements.

[[TLJPA459]][[sthref204]][[CIHJIIDJ2]]

*_Table 2-34 @NamedPLSQLStoredFunctionQueries Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`NamedStoredFunctionQuery[]` |(Required) An array of named stored
procedure query |
|=======================================================================

[[sthref205]]

*See Also*

For more information, see:

* link:#BGBDHGJE["@NamedPLSQLStoredFunctionQueries"]

[[CHDIAEFF]][[TLJPA54056]]

'''''

=== @NamedPLSQLStoredFunctionQuery

Use the `@NamedPLSQLStoredFunctionQuery` annotation to define queries
that call Oracle PLSQL stored functions as named queries

[[sthref206]]

*Annotation Elements*

link:#BABCHEIG3[Table 2-36] describes this annotation's elements.

[[TLJPA54057]][[sthref207]][[sthref208]]

*_Table 2-35 @NamedPLSQLStoredFunctionQuery Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`functionName` |(Required) The name of the stored function |

|`name` |(Required) The unique name that references this stored function
query |

|`returnParamter` |(Required) The return value of the stored function
|

|`hints` |(Optional) Query hints |

|`parameters` |(Optional) The parameters for the stored function |

|`resultSetMapping` |(Optional) The name of the `SQLResultMapping` |
|=======================================================================

[[sthref209]]

*Usage*

This annotation adds support for complex PLSQL types such as `RECORD`
and `TABLE`, that are not accessible from JDBC.

You can specify `@NamedPLSQLStoredFunctionQuery` on an Entity or
MappedSuperclass.

[[sthref210]]

*Examples*

link:#CHDICCEF[Example 2-67] shows how to use this annotation.

[[CHDICCEF]][[TLJPA54058]]

*_Example 2-67 Using @NamedPLSQLStoredFunctionQuery Annotation_*

[source,oac_no_warn]
----
@NamedPLSQLStoredFunctionQuery(
    name="getEmployee", 
    functionName="EMP_PKG.GET_EMP",
    returnParameter=@PLSQLParameter(
        name="RESULT", 
        databaseType="EMP_PKG.EMP_TABLE"
    )
)
@Embeddable
@Struct(name="EMP_TYPE", fields={"F_NAME", "L_NAME", "SALARY"})
@PLSQLRecord(
    name="EMP_PKG.EMP_REC", 
    compatibleType="EMP_TYPE",
    javaType=Employee.class,
    fields={
        @PLSQLParameter(name="F_NAME"), 
        @PLSQLParameter(name="L_NAME"),
        @PLSQLParameter(
            name="SALARY", 
            databaseType="NUMERIC_TYPE"
        )
    }
)

public class Employee { ...}
----

[[sthref211]]

*See Also*

For more information, see:

* Oracle PL/SQL +
`http://www.oracle.com/technetwork/database/features/plsql/index.html`

[[BABJCEJH3]][[TLJPA465]]

'''''

=== @NamedPLSQLStoredProcedureQueries

Use the `@NamedPLSQLStoredProcedureQueries` annotation to define
multiple `NamedPLSQLStoredProcedureQuery` items.

[[sthref212]]

*Annotation Elements*

link:#BABCHEIG3[Table 2-36] describes this annotation's elements.

[[TLJPA466]][[sthref213]][[BABCHEIG3]]

*_Table 2-36 @NamedPLSQLStoredProcedureQueries Annotation Elements_*

|================================================================
|*Annotation Element* |*Description* |*Default*
|`value` |(Required) An array of named stored procedure query |
|================================================================

[[sthref214]]

*Examples*

link:#BABFCGCE[Example 2-68] shows how to use this annotation.

[[BABFCGCE]][[TLJPA467]]

*_Example 2-68 Using @NamedPLSQLStoredProcedureQueries Annotation_*

[source,oac_no_warn]
----
@NamedPLSQLStoredProcedureQueries({ 
    @NamedPLSQLStoredProcedureQuery(name="getEmployee", 
    functionName="EMP_PKG.GET_EMP", 
    parameters={ @PLSQLParameter( name="EMP_OUT", direction=:Direction.OUT, databaseType="EMP_PKG.EMP_REC") } )
    })
----

[[sthref215]]

*See Also*

For more information, see:

* link:#BGBDHGJE2["@NamedPLSQLStoredProcedureQuery"]
* "Stored Procedures" in _Understanding EclipseLink_
* Oracle PL/SQL
`http://www.oracle.com/technetwork/database/features/plsql/index.html`
* PLSQL Stored Procedure
Examples`http://wiki.eclipse.org/EclipseLink/Examples/JPA/PLSQLStoredFunction`

[[BGBDHGJE2]][[TLJPA54012]]

'''''

=== @NamedPLSQLStoredProcedureQuery

Use the `@NamedPLSQLStoredProcedureQuery` annotation to define queries
that call Oracle PLSQL stored procedures as named queries.

[[sthref216]]

*Annotation Elements*

link:#BGBEAJEH2[Table 2-37] describes this annotation's elements.

[[TLJPA54013]][[sthref217]][[BGBEAJEH2]]

*_Table 2-37 @NamedPLSQLStoredProcedureQuery Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`procedureName` |(Required) The name of the stored procedure |

|`name` |(Required) The unique name that references this stored
procedure query |

|`resultClass` |(Optional) The class of the result |

|`hints` |(Optional) Query hints |

|`parameters` |(Optional) The parameters for the stored procedure |

|`resultSetMapping` |(Optional) The name of the `SQLResultMapping` |
|=======================================================================

[[sthref218]]

*Usage*

This annotation adds support for complex PLSQL types such as `RECORD`
and `TABLE`, that are not accessible from JDBC.

You can specify `@NamedPLSQLStoredProcedureQuery` on an Entity,
Embeddable, or MappedSuperclass.

[[sthref219]]

*Examples*

link:#BGBICFEB2[Example 2-69] shows how to use this annotation.

[[BGBICFEB2]][[TLJPA54014]]

*_Example 2-69 Using @NamedPLSQLStoredProcedureQuery Annotation_*

[source,oac_no_warn]
----
@NamedPLSQLStoredProcedureQuery(
    name="getEmployee",
    procedureName="MyStoredProcedure",
    functionName="EMP_PKG.GET_EMP", 
    parameters={
        @PLSQLParameter(
            name="EMP_OUT", 
            direction=Direction.OUT,
            databaseType="EMP_PKG.EMP_REC"
        )
    }
)
@Embeddable
@Struct(name="EMP_TYPE", fields={"F_NAME", "L_NAME", "SALARY"})
@OracleObject(
    name="EMP_PKG.EMP_REC",
    compatibleType="EMP_TYPE",
    javaType=Employee.class,
    fields={
        @PLSQLParameter(name="F_NAME"),
        @PLSQLParameter(name="L_NAME"),
        @PLSQLParameter(
            name="SALARY",
            databaseType="NUMERIC_TYPE"
        )
    }
)
 
public class Employee { ...}
----

[[sthref220]]

*See Also*

For more information, see:

* "Stored Procedures" in _Understanding EclipseLink_
* Oracle PL/SQL
`http://www.oracle.com/technetwork/database/features/plsql/index.html`
* PLSQL Stored Procedure
Examples`http://wiki.eclipse.org/EclipseLink/Examples/JPA/PLSQLStoredFunction`

[[CIHJFFDI]][[TLJPA54015]]

'''''

=== @NamedStoredFunctionQueries

Use the `@NamedStoredFunctionQueries` annotation to define multiple
`NamedStoredFunctionQuery` items.

[[sthref221]]

*Annotation Elements*

link:#CIHJIIDJ[Table 2-38] describes this annotation's elements.

[[TLJPA54016]][[sthref222]][[CIHJIIDJ]]

*_Table 2-38 @NamedStoredFunctionQueries Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`NamedStoredFunctionQuery[]` |(Required) An array of named stored
procedure query | +
|=======================================================================

[[sthref223]]

*Examples*

link:#CIHBJIHJ[Example 2-70] shows how to use this annotation.

[[CIHBJIHJ]][[TLJPA54017]]

*_Example 2-70 Using @NamedStoredFunctionQueries Annotation_*

[source,oac_no_warn]
----
@NamedStoredFunctionQueries{(
    @NamedStoredFunctionQuery(
        name="StoredFunction_In",
        functionName="StoredFunction_In",
        parameters={
            @StoredProcedureParameter(direction=IN, name="P_IN", queryParameter="P_IN", type=Long.class)
        },
        returnParameter=@StoredProcedureParameter(queryParameter="RETURN", type=Long.class)
    )
)}
----

To define multiple named stored procedures in the `eclipselink-orm.xml`
file, create a list of multiple `<named-stored-function_query>`
elements.

[[sthref224]]

* +
See Also*

For more information, see:

* link:#BABFBIFE["@NamedStoredFunctionQuery"]

[[BABFBIFE]][[TLJPA461]]

'''''

=== @NamedStoredFunctionQuery

Use `@NamedStoredFunctionQuery` to define queries that call stored
functions as named queries.

[[sthref225]]

*Annotation Elements*

link:#BABFFDDG[Table 2-39] describes this annotation's elements.

[[TLJPA462]][[sthref226]][[BABFFDDG]]

*_Table 2-39 @NamedStoredFunctionQuery Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`functionName` |(Required) The name of the stored function |

|name |(Required) The unique name that references this stored function
query |

|`returnParamter` |(Required) The return value of the stored function
|

|`callByIndex` a|
(Optional) Specifies if the stored function should be called by *index*
or by *name*.

* If by index, the parameters must be defined in the same order as the
procedure on the database.
* If by name, you must use the database platform support naming
procedure parameters.

 |false

|`hints` |(Optional) Query hints |

|`parameters` |(Optional) The parameters for the stored function |

|`resultSetMapping` |(Optional) The name of the SQLResultMapping |
|=======================================================================

[[sthref227]]

*Usage*

You can specify `@NamedStoredFunctionQuery` on an Entity or
MappedSuperclass.

[[sthref228]]

*Examples*

link:#BABHABEG[Example 2-71] shows how to use this annotation.

[[BABHABEG]][[TLJPA463]]

*_Example 2-71 Using @NamedStoredFunctionQuery Annotation_*

[source,oac_no_warn]
----
@Entity
@Table(name="CMP3_ADDRESS")
 
@NamedStoredFunctionQuery(
  name="StoredFunction_In",
  functionName="StoredFunction_In",
  parameters={
    @StoredProcedureParameter(direction=IN, name="P_IN", queryParameter="P_IN", type=Long.class)
    },
  returnParameter=@StoredProcedureParameter(queryParameter="RETURN", type=Long.class)
  )
public class Address implements Serializable {
...
}
----

link:#BABGJGJJ[Example 2-72] shows how to use the
`<named-stored-function-query>` element in the `eclipselink-orm.xml`
file.

[[BABGJGJJ]][[TLJPA464]]

*_Example 2-72 Using <named-stored-function-query> XML_*

[source,oac_no_warn]
----
<named-stored-function-query name="StoredFunction_In" procedure-name="StoredFunction_In">
    <parameter direction="IN" name="P_IN" query-parameter="P_IN" type="Long"/>
</named-stored-function-query>
----

[[sthref229]]

*See Also*

For more information, see:

* link:#CIHJFFDI["@NamedStoredFunctionQueries"]

[[BABJCEJH]][[TLJPA54018]]

'''''

=== @NamedStoredProcedureQueries

Use the `@NamedStoredProcedureQueries` annotation to define multiple
`NamedStoredProcedureQuery` items.

[[sthref230]]

*Annotation Elements*

link:#BABCHEIG[Table 2-40] describes this annotation's elements.

[[TLJPA54019]][[sthref231]][[BABCHEIG]]

*_Table 2-40 @NamedStoredProcedureQueries Annotation Elements_*

|================================================================
|*Annotation Element* |*Description* |*Default*
|`value` |(Required) An array of named stored procedure query | +
|================================================================

[[sthref232]]

*Examples*

link:#BABIFCAJ[Example 2-73] shows how to use this annotation.

[[BABIFCAJ]][[TLJPA54020]]

*_Example 2-73 Using @NamedStoredProcedureQueries Annotation_*

[source,oac_no_warn]
----
@Entity
@Table(name="EMPLOYEE")
@NamedStoredProcedureQueries({
  @NamedStoredProcedureQuery(
    name="ReadEmployeeInOut",
     resultClass=org.eclipse.persistence.testing.models.jpa.customfeatures.Employee.class,
    procedureName="Read_Employee_InOut",
    parameters={
      @StoredProcedureParameter(direction=IN_OUT, name="employee_id_v", queryParameter="ID", type=Integer.class),
      @StoredProcedureParameter(direction=OUT, name="nchar_v", queryParameter="NCHARTYPE", type=Character.class)}
    ),
    @NamedStoredProcedureQuery(
      name="ReadEmployeeCursor",
      resultClass=org.eclipse.persistence.testing.models.jpa.customfeatures.Employee.class,
      procedureName="Read_Employee_Cursor",
      parameters={
        @StoredProcedureParameter(direction=IN, name="employee_id_v", queryParameter="ID", type=Integer.class),
        @StoredProcedureParameter(direction=OUT_CURSOR, queryParameter="RESULT_CURSOR")})
})
public class Employee implements Serializable {
----

To define multiple named stored procedure queries in the
`eclipselink-orm.xml` file, simply create a list of multiple
`<named-stored-procedure_query>` elements.

[[sthref233]]

*
See Also*

For more information, see:

* link:#BGBGAEFF["@NamedStoredProcedureQuery"]
* "Stored Procedures" in _Understanding EclipseLink_

[[BGBGAEFF]][[TLJPA468]]

'''''

=== @NamedStoredProcedureQuery

Use the `@NamedStoredProcedureQuery` annotation to define queries that
call stored procedures as named queries.

[[sthref234]]

*Annotation Elements*

link:#BGBHHIAB[Table 2-41] describes this annotation's elements.

[[TLJPA469]][[sthref235]][[BGBHHIAB]]

*_Table 2-41 @NamedStoredProcedureQuery Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) Unique name that references this stored procedure
query |

|`procedureName` |(Required) Name of the stored procedure |

|`callByIndex` a|
(Optional) Specifies if the stored procedure should be called by name.

* If *true*, the StoredProcedureParameters must be defined in the same
order as the procedure on the database.
* If *false*, the database platform must support naming procedure
parameters.

 |`false`

|`hints` |(Optional) An array of query hints |

|`multipleResultSets` a|
(Optional) Specifies if the stored procedure returns multiple result
sets.

This applies only for databases that support multiple result sets from
stored procedures.

 |`false`

|`parameters` |(Optional) An array of parameters for the stored
procedure |

|`resultClass` |(Optional) The class of the result |`void.class`

|`resultSetMapping` |(Optional) Name of the `SQLResultMapping` |

|`returnsResultSet` a|
(Optional) Specifies if the stored procedure retainers a result set.

This applies only for databases that support result sets from stored
procedures.

 |`false`
|=======================================================================

[[sthref236]]

*Usage*

You can specify `@NamedStoredProcedureQuery` on an Entity or MappedSuper
class.

[[sthref237]]

*Examples*

link:#BGBJBAFD[Example 2-74] shows how to use
`@NamedStoredProcedureQuery` to define a stored procedure.

[[BGBJBAFD]][[TLJPA470]]

*_Example 2-74 Using @NamedStoredProcedureQuery Annotation_*

[source,oac_no_warn]
----
@NamedStoredProcedureQuery(name="findAllEmployees", procedureName="EMP_READ_ALL", resultClass=Employee.class, parameters={
    @StoredProcedureParameter(queryParameter="result", name="RESULT_CURSOR", direction=Direction.OUT_CURSOR})
@Entity
public class Employee {
 ...
}
----

link:#BGBIHIHB[Example 2-75] shows how to use the
`<named-stored-procedure-query>` element in the `eclipselink-orm.xml`
file.

[[BGBIHIHB]][[TLJPA471]]

*_Example 2-75 Using <named-stored-procedure-query> XML_*

[source,oac_no_warn]
----
<named-stored-procedure-query name="SProcXMLInOut" result-class="Address" procedure-name="SProc_Read_XMLInOut">
    <parameter direction="IN_OUT" name="address_id_v" query-parameter="ADDRESS_ID" type="Long"/>
    <parameter direction="OUT" name="street_v" query-parameter="STREET" type="String"/>
</named-stored-procedure-query>
----

[[sthref238]]

*See Also*

For more information, see:

* link:#BABJCEJH["@NamedStoredProcedureQueries"]
* "Stored Procedures" in _Understanding EclipseLink_
* "Stored Procedures Examples"
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/StoredProcedures`

[[CHDGEFGD]][[TLJPA472]]

'''''

=== @Noncacheable

Use `@Noncacheable` to configure caching behavior for relationships. If
used on a relationship, that relationship _will not_ be cached, even
though the parent Entity may be cached.

[[sthref239]]

*Annotation Elements*

There are no elements for this annotation.

[[sthref240]]

*Usage*

Each time EclipseLink retrieves the Entity, the relationship will be
reloaded from the datasource. This may be useful for situations where
caching of relationships is not desired or when using different
EclipseLink cache types and having cached references extends the cache
lifetime of related Entities using a different caching scheme. For
instance Entity A references Entity B, Entity A is Full and Entity B is
Weak. Without removing the caching of the relationsip the Entity B's
cache effectively become Full.

[[sthref241]]

*Examples*

link:#CHDDEGCI[Example 2-76] shows how to use `@Noncacheable` to create
a protected cache.

[[CHDDEGCI]][[TLJPA473]]

*_Example 2-76 Using @Noncacheable Annotation_*

[source,oac_no_warn]
----
@Entity
@Cache(
  isolation=CacheIsolationType.PROTECTED
)
public class Employee {
  @Id
  private long id;
  ...
  @OneToMany(mappedBy="manager")
  @Noncacheable
  private List<Employee> managedEmployees;
  ...
}
----

link:#CHDDFJCH[Example 2-77] shows using the `<noncacheable>` XML
element in the `eclipselink-orm.xml` file.

[[CHDDFJCH]][[TLJPA474]]

*_Example 2-77 Using <noncacheable> XML_*

[source,oac_no_warn]
----
<?xml version="1.0"?>
<entity-mappings
    xmlns="http://www.eclipse.org/eclipselink/xsds/persistence/orm"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.eclipse.org/eclipselink/xsds/persistence/orm http://www.eclipse.org/eclipselink/xsds/eclipselink_orm_2_4.xsd"
    version="2.4">
    <entity name="Employee" class="org.acme.Employee" access="FIELD">
        <cache isolation="PROTECTED"/>
        <attributes>
            <id name= "id"/>
            <one-to-many name="managedEmployees" mapped-by="manager">
                <noncacheable/>
            </one-to-many>
        </attributes>
    </entity>
</entity-mappings
----

[[sthref242]]

*See Also*

For more information, see:

* "Caching"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Basic_JPA_Development/Caching`
* "EclipseLink Caches" in _Understanding EclipseLink_
* "Scaling EclipseLink Applications in Clusters" in _Solutions Guide for
EclispeLink_

[[BJEIEBHC]][[TLJPA475]]

'''''

=== @NoSql

Use `@NoSql` to specify a non-relational (that is, no SQL) data source.
EclipseLink can map non-relational data to objects and access that data
through JPA.

[[sthref243]]

*Annotation Elements*

link:#BJEBBCFE[Table 2-42] describes this annotation's elements.

[[TLJPA476]][[sthref244]][[BJEBBCFE]]

*_Table 2-42 @NoSql Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`dataType` a|
The name of the entities structure. The purpose of the `dataType`
depends on the NoSQL platform used:

* For MongoDB, it is the collection name that the JSON documents are
stored to.
* For Oracle NoSQL, it is the first part of the major key value.
* For XML files, it is the file name. and XML messaging, use `XML`.

 |

|`dataFormat` a|
(Optional) The type structure (data format) in which the data is stored
within the database:

* `INDEXED` – Maps a class to an array of values.
* `MAPPED` – Maps a class to a set of nested key/value pairs, a value
can be an embedded map or list.
+
Use to map to key/value stores, JSON databases, and other structured
data systems.
* `XML` – Maps a class to an XML document.

Use with XML data-stores, XML files, XML messaging systems, and other
XML systems.

 |XML
|=======================================================================

[[sthref245]]

*Usage*

The `dataFormat` depends on the NoSQL platform used:

* For MongoDB, use `MAPPED`.
* For Oracle NoSQL, use `MAPPED` (for key/value data) or `XML` (for a
single XML document).
* For XML files and XML messaging, use `XML`.

[[TLJPA721]]

*Supported Datasources*

EclipseLink supports several NoSQL and EIS platforms, as well as generic
NoSQL and EIS datasources through the JavaEE Connector Architecture CCI
(Common Client Interface) API. You can also define your own
`EISPlatform` subclass and JCA adapter

EclipseLink supports the following datasources:

* MongoDB
* Oracle NoSQL
* XML Files
* JMS
* Oracle AQ

[[sthref246]]

*Examples*

link:#BJECFBJG[Example 2-78] shows using `@NoSql` with an XML data
source.

[[BJECFBJG]][[TLJPA477]]

*_Example 2-78 Using @NoSql Annotation with XML_*

[source,oac_no_warn]
----
@Entity
@NoSql(dataType="order")
public class Order {
  @Id
  @GeneratedValue
  @Field(name="@id")
  private long id;
  @Basic
  @Field(name="@description")
  private String description;
  @Embedded
  @Field(name="delivery-address")
  private Address deliveryAddress
  @ElementCollection
  @Field(name="orderLines/order-line")
  private List<OrderLine> orderLines;
  @ManyToOne
  @JoinField(name="customer-id")
  private Customer customer;
}
 
@Embeddable
@NoSql
public class OrderLine {
    @Field(name="@line-number")
    private int lineNumber;
    @Field(name="@item-name")
    private String itemName;
    @Field(name="@quantity")
    private int quantity;  
}
----

This would produce the following XML data:

[source,oac_no_warn]
----
<order id="4F99702B271B1948027FAF06" description="widget order">
  <deliveryAddress street="1712 Hasting Street" city="Ottawa" province="ON" postalCode="L5J1H5"/>
  <order-lines>
      <order-line lineNumber="1" itemName="widget A" quantity="5"/>
      <order-line lineNumber="2" itemName="widget B" quantity="1"/>
      <order-line lineNumber="3" itemName="widget C" quantity="2"/>
  <order-lines>
  <customer-id>4F99702B271B1948027FAF08</customer-id>
<order>
----

link:#BJECHGJH[Example 2-79] shows using `@NoSql` with a JSON data
source.

[[BJECHGJH]][[TLJPA722]]

*_Example 2-79 Using @NoSql Annotation with JSON_*

[source,oac_no_warn]
----
@Entity
@NoSql(dataType="orders", dataFormat=DataFormatType.MAPPED)
public class Order {
  @Id
  @GeneratedValue
  @Field(name="_id")
  private long id;
  @Basic
  @Field(name="description")
  private String description;
  @Embedded
  @Field(name="deliveryAddress")
  private Address deliveryAddress
  @ElementCollection
  @Field(name="orderLines")
  private List<OrderLine> orderLines;
  @ManyToOne
  @JoinField(name="customerId")
  private Customer customer;
}
 
@Embeddable
@NoSql(dataFormat=DataFormatType.MAPPED)
public class OrderLine {
    @Field(name="lineNumber")
    private int lineNumber;
    @Field(name="itemName")
    private String itemName;
    @Field(name="quantity")
    private int quantity;  
}
----

This would produce the following JSON document:

[source,oac_no_warn]
----
{
  "_id": "4F99702B271B1948027FAF06",
  "description": "widget order",
  "deliveryAddress": {
      "street": "1712 Hasting Street",
      "city": "Ottawa",
      "province": "ON",
      "postalCode": "L5J1H5",
  },
  "orderLines": [
      {"lineNumber": "1", "itemName": "widget A", "quantity": "5"},
      {"lineNumber": "2", "itemName": "widget B", "quantity": "1"},
      {"lineNumber": "3", "itemName": "widget C", "quantity": "2"}
  ],
  "customerId": "4F99702B271B1948027FAF08",
}
----

[[sthref247]]

*See Also*

For more information, see:

* @NoSQL
`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/NoSQL`
* NoSQL Persistence Units
`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/NoSQL/Persistence_Units`
* Examples `http://wiki.eclipse.org/EclipseLink/Examples/JPA/NoSQL`
* _Oracle Coherence Integration Guide for EclipseLink with Coherence
Grid_
* "Using Non-SQL Databases" in _Understanding EclipseLink_
* "Using NoSQL Databases" in _Understanding EclipseLink_
* "Using EclipseLink with Nonrelational Databases" in _Solutions Guide
for EclispeLink_
* xref:{relativedir}/persistenceproperties_ref.adoc#nosqlproperty["nosql.property"]
* EclipseLink Platform Incubator
`http://wiki.eclipse.org/EclipseLink/Development/Incubator/Platform`
* Supported NoSQL and EIS Datasources
`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/NoSQL/Supported_Data-sources`

[[BGBBDGAI]][[TLJPA478]]

'''''

=== @ObjectTypeConverter

The `@ObjectTypeConverter` annotation specifies an
`org.eclipse.persistence.mappings.converters.ObjectTypeConverter` that
converts a fixed number of database data value(s) to Java object
value(s) during the reading and writing of a mapped attribute.

[[sthref248]]

*Annotation Elements*

link:#BGBDHDHC[Table 2-43] describes this annotation's elements.

[[TLJPA479]][[sthref249]][[BGBDHDHC]]

*_Table 2-43 @ObjectTypeConverter Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |Set this attribute to the `String` name for your converter.
Ensure that this name is unique across the persistence unit. |none

|`dataType` |(Optional) Set this attribute to the type stored in the
database. |`void.class` footnote:disclaimer[The default is inferred from the type of the persistence
field or property.]

|`objectType` |(Optional) Set the value of this attribute to the type
stored on the entity. |`void.class` footnote:disclaimer[]

|`conversionValues` |Set the value of this attribute to the array of
conversion values (instances of `ConversionValue: String objectValue`
and `String dataValue`). |none

|`defaultObjectValue` |Set the value of this attribute to the default
object value. Note that this argument is for dealing with legacy data if
the data value is missing. |Empty `String`
|=======================================================================

[[sthref251]]

*Usage*

EclipseLink also includes `@TypeConverter` and `@StructConverter`
converters.

[[sthref252]]

*Examples*

link:#BGBFDFEJ[Example 2-80] shows how to use the `@ObjectTypeConverter`
annotation to specify object converters for the `gender` field.

[[BGBFDFEJ]][[TLJPA480]]

*_Example 2-80 Using the @ObjectTypeConverter Annotation_*

[source,oac_no_warn]
----
public class Employee implements Serializable{
     ...
     @ObjectTypeConverter (
         name="genderConverter",
         dataType=java.lang.String.class,
         objectType=java.lang.String.class,
         conversionValues={
             @ConversionValue(dataValue="F", objectValue="Female"),
             @ConversionValue(dataValue="M", objectValue="Male")}
     )
     @Convert("genderConverter")
     public String getGender() {
         return gender;
     }
     ...
 }
----

You can use the `<object-type-converter>` element in the deployment
descriptor as an alternative to using the `@ObjectTypeConverter`
annotation in the source code, as shown in link:#BGBCECGI[Example 2-81].

[[BGBCECGI]][[TLJPA481]]

*_Example 2-81 Using <object-type-converter> XML_*

[source,oac_no_warn]
----
<object-type-converter name="gender-converter" object-type="model.Gender"     data-type="java.lang.String">
    <conversion-value object-value="Male" data-value="M" />
    <conversion-value object-value="Female" data-value="F" />
</object-type-converter>
----

[[sthref253]]

* +
See Also*

For more information, see:

* `"@TypeConverter"`
* `"@StructConverter"`
* link:#CBBJAJCH["@ConversionValue"]

[[CHDCHJHF]][[TLJPA482]]

'''''

=== @ObjectTypeConverters

Use `@ObjectTypeConverters` to define multiple `ObjectTypeConverter`
items.

[[sthref254]]

*Annotation Elements*

link:#CHDBIIEH[Table 2-44] describes this annotation's elements.

[[TLJPA483]][[sthref255]][[CHDBIIEH]]

*_Table 2-44 @ObjectTypeConverters Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`ObjectTypeConverter` |(Required) An array of `@ObjectTypeConverter`
|
|=======================================================================

[[sthref256]]

*Examples*

link:#CHDBGGJB[Example 2-82] shows how to use this annotation.

[[CHDBGGJB]][[TLJPA484]]

*_Example 2-82 Using @ObjectTypeConverters Annotation_*

[source,oac_no_warn]
----
@Entity(name="Employee")
@Table(name="CMP3_FA_EMPLOYEE")
@ObjectTypeConverters({
  @ObjectTypeConverter(
    name="sex",
    dataType=String.class,
    objectType=org.eclipse.persistence.testing.models.jpa.fieldaccess.advanced.Employee.Gender.class,
    conversionValues={
      @ConversionValue(dataValue="F", objectValue="Female"),
      @ConversionValue(dataValue="M", objectValue="Male")
    }
  )
})
----

To define multiple object type converts in the `eclipselink-orm.xml`
file, simply create a list of multiple `<object-type-converter>`
elements.

[[sthref257]]

*See Also*

For more information, see:

* link:#BGBBDGAI["@ObjectTypeConverter"]

[[BCGIACHD]][[TLJPA485]]

'''''

=== @OptimisticLocking

Use `@OptimisticLocking` to specify the type of optimistic locking
EclipseLink should use when updating or deleting entities.

[[sthref258]]

*Annotation Elements*

link:#BCGEDBBI[Table 2-45] describes this annotation's elements.

[[TLJPA486]][[sthref259]][[BCGEDBBI]]

*_Table 2-45 @OptimisticLocking Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`cascade` a|
(Optional) Specify where the optimistic locking policy should cascade
lock. When changing *private owned* and *delete orphan* object,
EclipseLink will update the version.

This element is currently only supported with `VERSION_COLUMN` locking.

 |`false`

|`selectedColumns` a|
(Optional) Specify a list of columns that will be optimistically locked.

This element is required when `type=SELECTED_COLUMNS`.

 |

|`type` a|
(Optional) The type of optimistic locking policy to use:

* `ALL_COLUMNS` – EclipseLink compares every field in the table with the
`WHERE` clause, when performing and update or delete operation.
* `CHANGED_COLUMNS` – EclipseLink compares only the changed fields in
the `WHERE` clause when performing an update.
* `SELECTED_COLUMNS` – EclipseLink compares the selected field in the
`WHERE` clause when performing and update or delete operation on the
`SelectedColumns`.
* `VERSION_COLUMN` – EclipseLink compares a single version number in the
`WHERE` clause when performing an update.

 |`VERSION_COLUMN`
|=======================================================================

[[sthref260]]

*Usage*

You can specify `@OptimisticLocking` on an Entity or MappedSuperclass.

[[sthref261]]

*Examples*

link:#BCGJBJFJ[Example 2-83] shows how to use the `@OptimisticLocking`
annotation for all columns

[[BCGJBJFJ]][[TLJPA487]]

*_Example 2-83 Using @OptimisticLocking Annotation_*

[source,oac_no_warn]
----
@Table(name = "EMPLOYEES")
  @OptimisticLocking(type=OptimisticLockingType.ALL_COLUMNS)
  public class Employee implements Serializable {
      ...
  }
----

link:#BCGJBJFJ[Example 2-83] shows how to use the `<optimistic-locking>`
element in the `eclipselink-orm.xml` file for a single column.

[[TLJPA488]]

*_Example 2-84 Using <optimistic-locking> XML_*

[source,oac_no_warn]
----
<entity name="Employee" class="my.Employee" access="PROPERTY" change-tracking="DEFERRED">
...
    <optimistic-locking type="SELECTED_COLUMNS" cascade="false">
      <selected-column name="id"/>
      <selected-column name="firstName"/>
    </optimistic-locking>
...
</entity>
----

[[sthref263]]

*See Also*

For more information, see:

* "Scaling EclipseLink Applications in Clusters" in _Solutions Guide for
EclispeLink_

[[CACGHFJB]][[TLJPA54101]]

'''''

=== @OracleArray

Use the `@OracleArray` annotation to define an Oracle database `VARRAY`
type, which you can use within PLSQL procedure calls.

[[sthref264]]

*Annotation Elements*

link:#CACCDHDF[Table 2-46] describes the annotation's elements.

[[TLJPA54102]][[sthref265]][[CACCDHDF]]

*_Table 2-46 @OracleArray Annotation Elements_*

|=======================================================================
|*Element* |*Description* |*Default*
|name |(Required) The name of the `VARRAY` in the database | +

|nestedType |(Required) The name of the database type that the `VARRAY`
holds |`VARCHAR_TYPE`

|javaType |(Optional) The Java `Collection` class to which the `VARRAY`
is mapped |`ArrayList`
|=======================================================================

[[sthref266]]

*Examples*

link:#CACFFDHH[Example 2-85] shows how to use the `@OracleArray`
annotation to define a `VARRAY` type.

[[CACFFDHH]][[TLJPA54109]]

*_Example 2-85 Using the @OracleArray Annoation_*

[source,oac_no_warn]
----
@NamedPLSQLStoredFunctionQuery(
name="getEmployee", 
functionName="EMP_PKG.GET_EMP",
parameters={
   @PLSQLParameter(
     name="EMP_OUT",
     direction=Direction.OUT,
     databaseType="EMP_PKG.EMP_REC"
     )
   }
)
@Embeddable
@Struct(name="EMP_TYPE", fields={"F_NAME",
"L_NAME","SALARY"})
@OracleArray(
   name="EMP_PKG.EMP_REC",
   nestedType=VARCHAR_TYPE
   javaType=Employee.class,
)
public class Employee{...}
----

[[sthref267]]

*See Also*

For more information, see:

* link:#BGBDHGJE2["@NamedPLSQLStoredProcedureQuery"]
* link:#CACCIBAB["@OracleArrays"]

[[CACCIBAB]][[TLJPA54103]]

'''''

=== @OracleArrays
~~~~~~~~~~~~~

Use the `@OracleArrays` annotation to define multiple `VARRAY` types.

[[sthref268]]

*Annotation Elements*

link:#CACBFHJC[Table 2-47] describes the annotation's elements.

[[TLJPA54104]][[sthref269]][[CACBFHJC]]

*_Table 2-47 @OracleArrays Attribute Elements_*

|=======================================================
|*Element* |*Description* |*Default*
|value |(Required) An array of Oracle `VARRAY` types |
|=======================================================

[[sthref270]]

*Examples*

See link:#CACGHFJB["@OracleArray"] for an example of how to use this
annotation.

[[sthref271]]

* +
See Also*

For more information, see:

* link:#CACGHFJB["@OracleArray"]

[[CACEBEGE]][[TLJPA54105]]

'''''

=== @OracleObject

Use the `@OracleObject` annotation to define an Oracle database `OBJECT`
type, which you can use within PLSQL procedure calls.

[[sthref272]]

*Annotation Elements*

link:#CACGCCBA[Table 2-48] describes the annotation's elements.

[[TLJPA54106]][[sthref273]][[CACGCCBA]]

*_Table 2-48 @OracleObject Annotation Elements_*

|=======================================================================
|*Element* |*Description* |*Default*
|name |(Required) The name of the `OBJECT` type in the database |

|javaType |(Optional) The Java type to which you want to map the
`OBJECT` type. This class must be mapped using an `@STRUCT` annotation
|void

|fields |(Required) Defines the parameter fields in the record type |
|=======================================================================

[[sthref274]]

*Examples*

link:#CACBHHBD[Example 2-86] shows how to use the `@OracleObject`
annotation to define an Oracle `OBJECT` type.

[[CACBHHBD]][[TLJPA54110]]

*_Example 2-86 Using the @OracleObject Annotation_*

[source,oac_no_warn]
----
@NamedPLSQLStoredFunctionQuery(
name="getEmployee",
functionName="EMP_PKG.GET_EMP",
parameters={
   @PLSQLParameter(
     name="EMP_OUT",
     direction=Direction.OUT,
     databaseType="EMP_PKG.EMP_REC"
     )
   }
)
@Embeddable
@Struct(name="EMP_TYPE", fields={"F_NAME",
"L_NAME","SALARY"})
@OracleObject(
   name="EMP_PKG.EMP_REC",
   javaType=Employee.class,
   fields={
     @PLSQLParameter(name="F_NAME"),
     @PLSQLParameter(name="L_NAME"),
     @PLSQLParameter(
      name="SALARY",
      databaseType="NUMERIC_TYPE"
     )
   }
)
public class Employee{...}
----

[[sthref275]]

*See Also*

For more information, see:

* link:#BGBDHGJE2["@NamedPLSQLStoredProcedureQuery"]
* link:#CACFFCEE["@OracleObjects"]

[[CACFFCEE]][[TLJPA54107]]

'''''

=== @OracleObjects

Use the `@OracleObjects` annotation to define multiple Oracle `OBJECT`
types.

[[sthref276]]

*Annotation Elements*

link:#CACDICGC[Table 2-49] describes the annotation's elements.

[[TLJPA54108]][[sthref277]][[CACDICGC]]

*_Table 2-49 @OracleObjects Annotation Elements_*

|=======================================================
|*Element* |*Description* |*Default*
|value |(Required) An array of Oracle `OBJECT` types |
|=======================================================

[[sthref278]]

* +
Examples*

See link:#CACEBEGE["@OracleObject"] for an example of how to use this
annotation.

[[sthref279]]

*See Also*

For more information, see:

* link:#CACEBEGE["@OracleObject"]

[[CHDDIBJF]][[TLJPA489]]

'''''

=== @OrderCorrection

Use `@OrderCorrection` to specify a strategy to use if the order list
read from the database is invalid (for example, it has nulls,
duplicates, negative values, or values greater than or equal to the list
size).

To be valid, an order list of _n_ elements must be `{0, 1,..., n-1}`

[[sthref280]]

*Annotation Elements*

link:#CHDIFBBF[Table 2-50] describes this annotation's elements.

[[TLJPA490]][[sthref281]][[CHDIFBBF]]

*_Table 2-50 @OrderCorrection Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|value a|
(Optional) Specify a strategy to use if the order list read from the
database is invalid:

* `EXCEPTION`
* `READ`
* `READ_WRITE`

 |`READ_WRITE`
|=======================================================================

[[sthref282]]

*Usage*

When using `@OrderCorrection`, you can specify how EclipseLink should
handle invalid list orders:

* `EXCEPTION` – When `OrderCorrectionType=EXCEPTION`, EclipseLink will
not correct the list. Instead, EclipseLink will throw a `QueryException`
with error code `QueryException.LIST_ORDER_FIELD_WRONG_VALUE`
+
For example, given the following list of three objects in the database:
+
[source,oac_no_warn]
----
{null, objectA}; {2, objectB}, {5, ObjectC}; 
----
+
When read into the application, EclipseLink will throw an exception.
* `READ` – When `OrderCorrectionType=READ`, EclipseLink corrects the
list read into application, but does not retain any information about
the invalid list order that remains in the database. Although this is
not an issue in read-only uses of the list, if the list is modified and
then saved into the database, the order will most likely differ from the
cache and be invalid.
+
The `READ` mode is used as the default when the mapped attribute is not
a `List`.
+
For example, given the following list of three objects in the database:
+
[source,oac_no_warn]
----
{null, objectA}; {2, objectB}, {5, ObjectC}
----
** When read as a list: `{objectA, objectB, objectC}`
** When adding a new element to the list:
`{objectA, objectB, objectC, objectD}`
** When saving the updated list to the database:
`{null, objectA}, {2, objectB}, {5, objectC}, {3, objectD}`
** When reading the list again: `{objectA, objectB, objectD, objectC}`
* `READ_WRITE` – When `OrderCorrectionType=READ_WRITE`, EclipseLink
corrects the order of the list read into application _and_ remembers the
invalid list order left in the database. If the list is updated and
saved to the database, the order indexes are saved ensuring that the
list order in the data base will be exactly the same as in cache (and
therefore valid).
+
The `READ_WRITE` mode is used as the default when the mapped attribute
is either a `List` or `Vector` (that is, it is assignable from the
EclipseLink internal class `IndirectList`). In JPA, if the mode is not
specified, `READ_WRITE` is used by default.
+
For example, given the following list of three objects in the database:
+
[source,oac_no_warn]
----
{null, objectA}; {2, objectB}, {5, ObjectC}
----
** When read as a list: `{objectA, objectB, objectC}`
** When adding a new element to the list:
`{objectA, objectB, objectC, objectD}`
** When saving the updated list to the database:
`{0, objectA}, {1, objectB}, {2, objectC}, {3, objectD}`
** When reading the list again: `{objectA, objectB, objectC, objectD}`

[[sthref283]]

*Examples*

link:#CHDFIAIE[Example 2-87] shows how to use this annotation.

[[CHDFIAIE]][[TLJPA491]]

*_Example 2-87 Using @OrderCorrection Annotation_*

[source,oac_no_warn]
----
@OrderColumn(name="ORDER_COLUMN")
@OrderCorrection(EXCEPTION)
List<String> designations;
----

link:#CHDHIFFI[Example 2-88] shows how to use this extension in the
`eclipselink-orm.xml` file.

[[CHDHIFFI]][[TLJPA54021]]

*_Example 2-88 Using <element-collection> in XML_*

[source,oac_no_warn]
----
<element-collection name="designations">
    <order-column name="ORDER_COLUMN" correction-type="EXCEPTION"/>
</element-collection>
----

[[sthref284]]

*See Also*

For more information see:

* link:#CACGCEIJ["Entity Annotations"]

[[CHDDAHEB]][[TLJPA492]]

'''''

=== @Partitioned

Use `@Partitioned` to specify a partitioning policy to use for an Entity
or relationship.

[[sthref285]]

* +
Annotation Elements*

link:#CHDCJBCE[Table 2-51] describes this annotation's elements.

[[TLJPA493]][[sthref286]][[CHDCJBCE]]

*_Table 2-51 @Partitioned Annotation Elements_*

|=======================================================
|*Annotation Element* |*Description* |*Default*
|`value` |(Required) Name of the partitioning policy |
|=======================================================

[[sthref287]]

*Usage*

Use partitioning to partition the data for a class across multiple
databases or a database cluster (such as Oracle RAC). Partitioning can
provide improved scalability by allowing multiple database machines to
service requests.

You can specify `@Partitioned` on an Entity, relationship, query, or
session/persistence unit.

[[TLJPA497]]

*Partitioning Policies*

To configure data partitioning, use the `@Partitioned` annotation and
one or more partitioning policy annotations. The annotations for
defining the different kinds of policies are:

* `@HashPartitioning`: Partitions access to a database cluster by the
hash of a field value from the object, such as the object's ID,
location, or tenant. The hash indexes into the list of connection
pools/nodes. All write or read request for objects with that hash value
are sent to the same server. If a query does not include the hash field
as a parameter, it can be sent to all servers and unioned, or it can be
left to the session's default behavior.
* `@PinnedPartitioning`: Pins requests to a single connection pool/node.
This allows for vertical partitioning.
* `@RangePartitioning`: Partitions access to a database cluster by a
field value from the object, such as the object's ID, location, or
tenant. Each server is assigned a range of values. All write or read
requests for objects with that value are sent to the same server. If a
query does not include the field as a parameter, then it can either be
sent to all server's and unioned, or left to the session's default
behavior.
* `@ReplicationPartitioning`: Sends requests to a set of connection
pools/nodes. This policy is for replicating data across a cluster of
database machines. Only modification queries are replicated.
* `@RoundRobinPartitioning`: Sends requests in a round-robin fashion to
the set of connection pools/nodes. It is for load balancing read queries
across a cluster of database machines. It requires that the full
database be replicated on each machine, so it does not support
partitioning. The data should either be read-only, or writes should be
replicated.
* `@UnionPartitioning`: Sends queries to all connection pools and unions
the results. This is for queries or relationships that span partitions
when partitioning is used, such as on a `ManyToMany` cross partition
relationship.
* `@ValuePartitioning`: Partitions access to a database cluster by a
field value from the object, such as the object's location or tenant.
Each value is assigned a specific server. All write or read requests for
objects with that value are sent to the same server. If a query does not
include the field as a parameter, then it can be sent to all servers and
unioned, or it can be left to the session's default behavior.
* `@Partitioning`: Partitions access to a database cluster by a custom
partitioning policy. A PartitioningPolicy class must be provided and
implemented.

Partitioning policies are globally-named objects in a persistence unit
and are reusable across multiple descriptors or queries. This improves
the usability of the configuration, specifically with JPA annotations
and XML.

The persistence unit properties support adding named connection pools in
addition to the existing configuration for read/write/sequence. A named
connection pool must be defined for each node in the database cluster.

If a transaction modifies data from multiple partitions, JTA should be
used to ensure 2-phase commit of the data. An exclusive connection can
also be configured in the EntityManager to ensure only a single node is
used for a single transaction.

[[TLJPA498]]

*Clustered Databases and Oracle RAC*

Some databases support clustering the database across multiple machines.
Oracle RAC allows for a single database to span multiple different
server nodes. Oracle RAC also supports table and node partitioning of
data. A database cluster allows for any of the data to be accessed from
any node in the cluster. However, it is generally it is more efficient
to partition the data access to specific nodes, to reduce cross node
communication.

EclipseLink partitioning can be used in conjunction with a clustered
database to reduce cross node communication, and improve scalability.

To use partitioning with a database cluster to following is required:

* Partition policy should not enable replication, as database cluster
makes data available to all nodes.
* Partition policy should not use unions, as database cluster returns
the complete query result from any node.
* A data source and EclipseLink connection pool should be defined for
each node in the cluster.
* The application's data access and data partitioning should be designed
to have each transaction only require access to a single node.
* Usage of an exclusive connection for an EntityManager is recommended
to avoid having multiple nodes in a single transaction and avoid 2-phase
commit.

[[sthref288]]

*Examples*

link:#CEGHAIDJ[Example 2-89] shows how to partition Employee data by
location. The two primary sites, *Ottawa* and *Toronto* are each stored
on a separate database. All other locations are stored on the default
database. Project is range partitioned by its ID, as shown in
link:#CEGJCEIH[Example 2-90]. Each range of ID values are stored on a
different database. The employee/project relationship is an example of a
cross partition relationship. To allow the employees and projects to be
stored on different databases a union policy is used and the join table
is replicated to each database.

[[CEGHAIDJ]][[TLJPA499]]

*_Example 2-89 Using Partitioning_*

[source,oac_no_warn]
----
@Entity
@IdClass(EmployeePK.class)
@UnionPartitioning(
        name="UnionPartitioningAllNodes",
        replicateWrites=true)
@ValuePartitioning(
        name="ValuePartitioningByLOCATION",
        partitionColumn=@Column(name="LOCATION"),
        unionUnpartitionableQueries=true,
        defaultConnectionPool="default",
        partitions={
            @ValuePartition(connectionPool="node2", value="Ottawa"),
            @ValuePartition(connectionPool="node3", value="Toronto")
        })
@Partitioned("ValuePartitioningByLOCATION")
public class Employee {
    @Id
    @Column(name = "EMP_ID")
    private Integer id;
 
    @Id
    private String location;
    ...
 
    @ManyToMany(cascade = { PERSIST, MERGE })
    @Partitioned("UnionPartitioningAllNodes")
    private Collection<Project> projects;
    ...
}
----

[[CEGJCEIH]][[TLJPA500]]

*_Example 2-90 Using @RangePartitioning_*

[source,oac_no_warn]
----
@Entity
@RangePartitioning(
        name="RangePartitioningByPROJ_ID",
        partitionColumn=@Column(name="PROJ_ID"),
        partitionValueType=Integer.class,
        unionUnpartitionableQueries=true,
        partitions={
            @RangePartition(connectionPool="default", startValue="0", endValue="1000"),
            @RangePartition(connectionPool="node2", startValue="1000", endValue="2000"),
            @RangePartition(connectionPool="node3", startValue="2000")
        })
@Partitioned("RangePartitioningByPROJ_ID")
public class Project {
    @Id
    @Column(name="PROJ_ID")
    private Integer id;
    ...
}
----

[[sthref289]]

*See Also*

For more information, see:

* link:#CEGDCFDA["@Partitioning"]
* link:#CEGBDBEG["@HashPartitioning"]
* link:#BCGIIAFB["@PinnedPartitioning"]
* link:#BABCFDAJ["@RangePartition"]
* link:#BABJEFJH["@ReplicationPartitioning"]
* link:#BCGBJGFF["@RoundRobinPartitioning"]
* link:#BCGEJFAH["@UnionPartitioning"]
* link:#CEGHFJDJ["@ValuePartitioning"]
* "Data
Partitioning"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning`
* Partitioning
Examples`http://wiki.eclipse.org/EclipseLink/Examples/JPA/Partitioning`

[[CEGDCFDA]][[TLJPA495]]

'''''

=== @Partitioning

Use `@Partitioning` to configure a custom `PartitioningPolicy`.

[[sthref290]]

*Annotation Elements*

link:#CEGGJJDE[Table 2-52] describes this annotation's elements.

[[TLJPA496]][[sthref291]][[CEGGJJDE]]

*_Table 2-52 @Partitioning Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |Name of the partition policy. Names must be unique for the
persistence unit. |

|`partitioningClass` |(Required) Full `package.class` name of a subclass
of `PartitioningPolicy` |
|=======================================================================

[[sthref292]]

*Usage*

Data partitioning allows for an application to scale its data across
more than a single database machine. EclipseLink supports data
partitioning at the Entity level to allow a different set of entity
instances for the same class to be stored in a different physical
database or different node within a database cluster. Both regular
databases and clustered databases are supported. Data can be partitioned
both horizontally and vertically.

Partitioning can be enabled on an entity, a relationship, a query, or a
persistence unit.

[[sthref293]]

*Examples*

link:#CEGCEIBF[Example 2-91] shows a custom partitioning policy.

[[CEGCEIBF]][[TLJPA54022]]

*_Example 2-91 Using @Partitioning Annotation_*

[source,oac_no_warn]
----
@Entity
@Partitioning(name="order", partitioningClass=OrderPartitioningPolicy.class)
@public class Order {
    ...
}
 
public class OrderPartitioningPolicy extends PartitioningPolicy {
 
    public List<Accessor> getConnectionsForQuery(AbstractSession session, DatabaseQuery query, AbstractRecord arguments) {
        
        List<Accessor> accessors = new ArrayList<Accessor>(1);
        accessors.add(getAccessor(ACMEPool.leastBusy(), session, query, false));
        return accessors;
    }
}
----

[[sthref294]]

*See Also*

For more information, see:

* link:#CHDDAHEB["@Partitioned"]
* link:#CEGBDBEG["@HashPartitioning"]
* link:#BCGIIAFB["@PinnedPartitioning"]
* link:#BCGCGEIH["@RangePartitioning"]
* link:#BABJEFJH["@ReplicationPartitioning"]
* link:#BCGBJGFF["@RoundRobinPartitioning"]
* link:#BCGEJFAH["@UnionPartitioning"]
* link:#CEGHFJDJ["@ValuePartitioning"]
* xref:{relativedir}/persistenceproperties_ref.adoc#partitioning["partitioning"]
* "Data Partitioning"
`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning`
* EclipseLink Examples
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/Partitioning`

[[BCGIIAFB]][[TLJPA501]]

'''''

=== @PinnedPartitioning

Use `@PinnedPartitionPolicy` to pin requests to a single connection
pool, allowing for vertical partitioning (that is, having an entity,
query, or session always access a single database).

[[sthref295]]

*Annotation Elements*

link:#BCGFGBAF[Table 2-53] describes this annotation's elements.

[[TLJPA502]][[sthref296]][[BCGFGBAF]]

*_Table 2-53 @PinnedPartitioning Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`connectionPool` |Connection pool name to which to pin queries |

|`name` |Name of the partition policy. Names must be unique for the
persistence unit. |
|=======================================================================

[[sthref297]]

*Usage*

Partition policies are globally named, to allow reuse. You must also set
the partitioning policy with the `@Partitioned` annotation.

You can specify `@PinnedPartitioning` on an Entity, relationship, query,
or session/persistence unit.

The persistence unit properties support adding named connection pools in
addition to the existing configuration for read/write/sequence. A named
connection pool must be defined for each node in the database cluster.

If a transaction modifies data from multiple partitions, you should use
JTA ensure proper two-phase commit of the data. You can also configure
an exclusive connection in the EntityManager to ensure that only a
single node is used for a single transaction.

[[sthref298]]

*Examples*

See link:#CEGHAIDJ["Using Partitioning"] for an example of partitioning
with EclipseLink.

[[sthref299]]

*See Also*

For more information, see:

* "Data
Partitioning"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning`
* link:#CHDDAHEB["@Partitioned"]

[[CHDDEBEC]][[TLJPA539]]

'''''

=== @PLSQLParameter

Use `@PLSQLParameter` within a `NamedPLSQLStoredProcedureQuery` or
`PLSQLRecord` annotation.

[[sthref300]]

*Annotation Elements*

link:#CHDDEJEC[Table 2-54] describes this annotation's elements.

[[TLJPA540]][[sthref301]][[CHDDEJEC]]

*_Table 2-54 @PLSQLParameter Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) The query parameter name |

|`direction` a|
(Optional) The direction of the stored procedure parameter:

* `IN` – Input parameter
* `IN_OUT` – Input and output parameters
* `OUT` – Output parameter
* `OUT_CURSOR` – Output cursor

 |`IN`

|`databaseType` |(Optional) Database data type for the parameter. This
either one of the type constants defined in `OraclePLSQLTypes`, or
`JDBCTypes`, or a custom record or table type name. |

|`length` |(Optional) Maximum length of the field value |

|`name` |(Optional) Stored procedure parameter name |

|`optional` |(Optional) Specify if the parameter is required, or
optional and defaulted by the procedure. |`false`

|`scale` |(Optional) Maximum precision value |

|`precision` |(Optional) Maximum precision value |
|=======================================================================

[[sthref302]]

*Usage*

Use the `@PLSQLParameter` annotation to configure the parameter and type
for Oracle PLSQL stored procedures and record types that use extended
PLSQL types instead of regular SQL types. They support `PLSQL RECORD`,
`TABLE`, `BOOLEAN` and other extend PLSQL types.

[[sthref303]]

*Examples*

See link:#BGBDHGJE2["@NamedPLSQLStoredProcedureQuery"] for an example
using the `@PLSQLParameter` annotation.

[[sthref304]]

*See Also*

For more information:

* link:#BGBDHGJE2["@NamedPLSQLStoredProcedureQuery"]
* link:#CHDBGAED["@PLSQLRecord"]
* PLSQL Stored Procedure
Examples`http://wiki.eclipse.org/EclipseLink/Examples/JPA/PLSQLStoredFunction`

[[CHDBGAED]][[TLJPA54023]]

'''''

=== @PLSQLRecord

Use `@PLSQLRecord` to define a database PLSQL `RECORD` type for use
within PLSQL procedures.

[[sthref305]]

*Annotation Elements*

link:#CHDDABDB[Table 2-55] describes this annotation's elements.

[[TLJPA54024]][[sthref306]][[CHDDABDB]]

*_Table 2-55 @PLSQLRecord Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) The name of the table in the database |

|`compatibileType` |(Required) Name of the database `OBJECTYPE` that
mirror's the record's structure |

|`fields` |(Required) The fields in the record type |

|`javaType` |(Optional) The class of the object type. You must map this
class with the `@Struct` annotation. |
|=======================================================================

[[sthref307]]

*Usage*

Oracle PLSQL `RECORD` types are _structured_ database types. Although
JDBC does not provide a mechanism for returning these types, EclipseLink
provides support to translate these types into `OBJECT` types. You must
create an `OBJECT` type on the database to mirror the `RECORD` type and
provide it as the `compatibileType` in the `@PLSQLRecord`.

You can then map the `RECORD` to a Java class, map the Java class as an
`@Embeddable`, use the `@Struct` annotations to map the Java class to
the `OBJECT` type that mirrors the `RECORD` type.

You can then call and return the Java class as parameters to the PLSQL
stored procedure query.

[[sthref308]]

*Examples*

link:#CHDJJCGF[Example 2-92] shows how to use this annotation.

[[CHDJJCGF]][[TLJPA54025]]

*_Example 2-92 Using @PLSQLRecord Annotation_*

[source,oac_no_warn]
----
@NamedPLSQLStoredFunctionQuery(name="getEmployee", functionName="EMP_PKG.GET_EMP",
    returnParameter=@PLSQLParameter(name="RESULT", databaseType="EMP_PKG.EMP_REC"))
@Embeddable
@Struct(name="EMP_TYPE", fields={"F_NAME", "L_NAME", "SALARY"})
@PLSQLRecord(name="EMP_PKG.EMP_REC", compatibleType="EMP_TYPE", javaType=Employee.class,
    fields={@PLSQLParameter(name="F_NAME"), @PLSQLParameter(name="L_NAME"), @PLSQLParameter(name="SALARY", databaseType="NUMERIC_TYPE")})
public class Employee {
 ...
}
----

[[sthref309]]

*See Also*

For more information, see:

* "Stored Procedures" in _Understanding EclipseLink_
* link:#BGBDHGJE2["@NamedPLSQLStoredProcedureQuery"]
* link:#CHDBGAED4["@PLSQLRecords"]
* Oracle PL/SQL
`http://www.oracle.com/technetwork/database/features/plsql/index.html`
* PLSQL Stored Procedure
Examples`http://wiki.eclipse.org/EclipseLink/Examples/JPA/PLSQLStoredFunction`

[[CHDBGAED4]][[TLJPA54026]]

'''''

=== @PLSQLRecords

Use `@PLSQLRecords` to define multiple `PLSQLRecord`.

[[sthref310]]

*Annotation Elements*

link:#CHDDABDB4[Table 2-56] describes this annotation's elements.

[[TLJPA54027]][[sthref311]][[CHDDABDB4]]

*_Table 2-56 @PLSQLRecords Annotation Elements_*

|=======================================================
|*Annotation Element* |*Description* |*Default*
|`value` |(Required) An array of named PLSQL records |
|=======================================================

[[sthref312]]

*Examples*

See link:#CHDBGAED["@PLSQLRecord"] for an example of how to use this
annotation.

[[sthref313]]

*See Also*

For more information, see:

* "Stored Procedures" in _Understanding EclipseLink_
* link:#BGBDHGJE2["@NamedPLSQLStoredProcedureQuery"]
* link:#CHDBGAED["@PLSQLRecord"]
* Oracle PL/SQL
`http://www.oracle.com/technetwork/database/features/plsql/index.html`
* PLSQL Stored Procedure
Examples`http://wiki.eclipse.org/EclipseLink/Examples/JPA/PLSQLStoredFunction`

[[CACJBHHF]][[TLJPA54111]]

'''''

=== @PLSQLTable

Use the `@PLSQLTable` annotation to define a database PLSQL `TABLE`
type, which you can use within PLSQL procedure calls.

[[sthref314]]

*Annotation Elements*

link:#CACBGCAJ[Table 2-57] describes this annotation's elements.

[[TLJPA54112]][[sthref315]][[CACBGCAJ]]

*_Table 2-57 @PLSQLTable Annotation Elements_*

|=======================================================================
|*Element* |*Description* |*Default*
|name |(Required) The name of the table type in the database |

|compatibilityType |(Required) The name of the database `VARRAY` type
that mirrors the structure of the table. The table is converted to and
from this type so that it can be passed through JDBC. |

|nestedType |(Required) The type of table, e.g. `TABLE` of `EMP_REC`
|`VARCHAR_TYPE`

|javaType |(Optional) The Java `Collection` class to which the `VARRAY`
is mapped. This class can be any valid `Collection` implementation.
|`ArrayList`

|isNestedTable |(Optional) Indicates a non-associative (nested) table.
Typically, you use this method when generating a constructor for the
collection in PL/SQL; the constructors for associative (`VARRAY`) arrays
and non-associative (nested) tables differ. |`false`
|=======================================================================

[[sthref316]]

*Examples*

[[TLJPA54113]]

*_Example 2-93 Using the @PLSQLTable Annotation_*

[source,oac_no_warn]
----
@Named PLSQLStoredProcedureQuery(
name="getEmployee",
functionName="EMP_PKG.GET_EMP",
parameters={
   @PLSQLParamter(
     name="EMP_OUT",
     direction=Direction.OUT,
     databaseType="EMP_TABLE"
     )
   }
)
@Embeddable
@Struct(name="EMP_TYPE", fields={"F_NAME",
"L_NAME", "SALARY"})
@PLSQLTable(
   name="EMP_PKG.EMP_TABLE",
   compatibilityType="EMP_VARRAY",
   nestedType="EMP_REC"
)
public class Employee{...}
----

[[sthref318]]

*See Also*

For more information, see:

* link:#BGBDHGJE2["@NamedPLSQLStoredProcedureQuery"]

[[CACCBFBC]][[TLJPA54114]]

'''''

=== @PLSQLTables

Use the `@PLSQLTables` annotation to define mutiple PLSQL tables.

[[sthref319]]

*Annotation Elements*

link:#CACCJCAH[Table 2-58] describes this annotation's elements.

[[TLJPA54115]][[sthref320]][[CACCJCAH]]

*_Table 2-58 @PLSQLTables Annotation Elements_*

|====================================================
|*Annotation* |*Description* |*Default*
|value |(Required) An array of named PLSQL tables | +
|====================================================

[[sthref321]]

*Examples*

See link:#CACJBHHF["@PLSQLTable"] for examples of how to use this
annotation.

[[sthref322]]

*See Also*

For more information, see:

* link:#CACJBHHF["@PLSQLTable"]

[[BGEBBFJE]][[TLJPA503]]

'''''

=== @PrimaryKey

Use `@PrimaryKey` to allow advanced configuration of the ID.

A validation policy can be given that allows specifying if zero is a
valid ID value. The set of primary key columns can also be specified
precisely.

[[sthref323]]

*Annotation Elements*

link:#BGEBGEAB[Table 2-59] describes this annotation's elements.

[[TLJPA504]][[sthref324]][[BGEBGEAB]]

*_Table 2-59 @PrimaryKey Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`cacheKeyType` a|
(Optional) Configures the cache key type to store the object in the
cache. This type can be the basic ID value for simple singleton IDs or
an optimized CachedId type. This element can take the following values:

* `ID_VALUE` – This value can only be used for simple singleton Ids,
suchas long/int/String. This is the default for simple singleton IDs.
* `CACHE_ID` – Optimized cache key type that allows composite and
complex values. This is the default for composite or complex IDs.
* `AUTO` – The cache key type is automatically configured depending on
what is optimial for the class.

 |`AUTO`

|`columns` |(Optional) Directly specifies the primary key columns. This
can be used instead of `@Id` if the primary key includes a non basic
field, such as a foreign key, or a inheritance discriminator, embedded,
or transformation mapped field. |

|`validation` a|
(Optional) Configures what ID validation is done:

* `NULL` – EclipseLink interprets zero values as zero. This permits
primary keys to use a value of zero.
* `ZERO` (default) – EclipseLink interprets zero as null.
* `NEGATIVE` – EclipseLink interprets negative values as null.
* `NONE` – EclipseLink does not validate the ID value.

By default `0` is not a valid ID value, this can be used to allow 0 ID
values.

 |`ZERO`
|=======================================================================

[[sthref325]]

*Usage*

By default, EclipseLink interprets zero as `null` for primitive types
that cannot be null (such as `int` and `long`), causing zero to be an
invalid value for primary keys. You can modify this setting by using the
`@PrimaryKey` annotation to configure an `IdValidation` for an entity
class. Use the `eclipselink.id-validation` property to configure an
`IdValidation` for the entire persistence unit.

Setting the `validation` element also affects how EclipseLink generates
IDs: new IDs are generated only for IDs that are not valid (`null` or
`0`, by default); setting to `NONE` disables ID generation.

[[sthref326]]

*Examples*

link:#BGEJFGAG[Example 2-94] shows how to use this annotation.

[[BGEJFGAG]][[TLJPA505]]

*_Example 2-94 Using @PrimaryKey Annotation_*

[source,oac_no_warn]
----
@PrimaryKey(validation=IdValidation.ZERO)
public class Employee implements Serializable, Cloneable {
...
}
----

link:#BGEGDFHI[Example 2-95] shows how to use the `<primary-key>`
element in your `eclipselink-orm.xml` file.

[[BGEGDFHI]][[TLJPA506]]

*_Example 2-95 Using @<primary-key> XML_*

[source,oac_no_warn]
----
<entity name="Employee" class="foo.Employee" access="PROPERTY">
   <primary-key validation="ZERO"/>
...
</entity>
----

[[sthref327]]

*See Also*

For more information, see:

* "@Id"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Basic_JPA_Development/Entities/Ids/Id`
* xref:{relativedir}/persistenceproperties_ref.adoc#idvalidation["id-validation"]
* link:#CACGCEIJ["Entity Annotations"]

[[CHDDDDAI]][[TLJPA507]]

'''''

=== @PrivateOwned

Use `@PrivateOwned` to specify that a relationship is privately owned;
target object is a dependent part of the source object and is not
referenced by any other object and cannot exist on its own.

[[sthref328]]

*Annotation Elements*

The `@PrivateOwned` annotation does not have attributes.

[[sthref329]]

* +
Usage*

Using `@PrivateOwned` causes many operations to be cascaded across the
relationship including delete, insert, refresh, and lock (when
cascaded). It also ensures that private objects removed from collections
are deleted and that objects added are inserted.

You can specify `@PrivateOwned` on with `@OneToOne`, `@OneToMany` and
`@VariableOneToOne` annotations. Private ownership is implied with the
`@BasicCollection` and `@BasicMap` annotations.

When the referenced object is privately owned, the referenced child
object cannot exist without the parent object.

[[TLJPA508]]

*Additional Information*

When indicating that a relationship is privately owned, you are
specifying the following:

* If the source of a privately owned relationship is deleted, then
EclipseLink will delete the target. This is equivalent of setting
link:#CIABIIEB[@CascadeOnDelete].
* If you remove the reference to a target from a source, then
EclipseLink will delete the target.

Normally, do not configure privately owned relationships on objects that
might be shared. An object should not be the target in more than one
relationship if it is the target in a privately owned relationship.

[NOTE]
====
Referencing a privately owned object may produce undesired effects, as
it is the application's responsibility to "clean up" references to the
privately owned object.

If the object becomes de-referenced and is deleted, other objects in the
cache that continue to reference the deleted object may cause constraint
violations, they may resurrect the object (if using cascade persist), or
they may simply not reflect what is in the database.
====

[[sthref330]]

*Examples*

link:#CHDIAFFA[Example 2-96] shows using `@PrivateOwned` to specify
`Employee` field `phoneNumbers.` .

[[CHDIAFFA]][[TLJPA509]]

*_Example 2-96 Using @PrivateOwned Annotation_*

[source,oac_no_warn]
----
@Entity
 public class Employee implements Serializable {
   ...
   @OneToMany(cascade=ALL, mappedBy="employee")
   @PrivateOwned
   public Collection<PhoneNumber> getPhoneNumbers() {
      return phoneNumbers;
   }
   ...
 }
----

[[sthref331]]

*See Also*

For more information, see:

* link:#CIABIIEB["@CascadeOnDelete"]

[[BABJHAFD]][[TLJPA510]]

'''''

=== @Properties

Use `@Property` to specify a single user-defined property on a mapped
attribute or its `get`/`set` method. Use the `@Properties` annotation to
wrap multiple properties.

Although not used by EclipseLink, you can specify mapping properties if
an application or extension needs to extend EclipseLink metadata.

[[sthref332]]

*Annotation Elements*

link:#BABIHDFH[Table 2-60] describes this annotation's elements.

[[TLJPA511]][[sthref333]][[BABIHDFH]]

*_Table 2-60 @Properties Annotation Elements_*

|==============================================
|*Annotation Element* |*Description* |*Default*
|Property |Array of `Property` elements | +
|==============================================

[[sthref334]]

*Usage*

You can specify `@Property` on a mapped attribute (or its `get`/`set`
method) within an Entity, MappedSuperclass, or Embeddable class. You can
also specify this annotation on an Entity, MappedSuperclass, or
Embeddable class.

Properties defined in MappedSuperclass are passed to all inheriting
Entities and MappedSuperclasses. In case of a conflict, property values
defined directly on a class always override values inherited from a
class's parent.

When using an `orm.xml` mapping file, EclipseLink ignores `@Property`
and `@Properties` specified in annotations on mapped attributes;
annotations on classes are merged with those specified i the `orm.xml`
file, with the latter taking precedence in case of conflicts.

[[sthref335]]

* +
Examples*

link:#BABHECGF[Example 2-120] shows how to use the `@Properties`
annotation within a `@Transformation` mapping. link:#BABHCBAG[Example
2-121] shows how to use the `<properties>` XML element within the
`orm.xml` file.

[[sthref336]]

*See Also*

For more information, see:

* link:#BGBCHEDG["@Property"]

[[BGBCHEDG]][[TLJPA512]]

'''''

=== @Property

Use `@Property` to specify a single user-defined property on a mapped
attribute or its `get`/`set` method. Use the `@Properties` annotation to
wrap multiple properties.

[[sthref337]]

*Annotation Elements*

link:#BGBIGFCA[Table 2-61] describes this annotation's elements.

[[TLJPA513]][[sthref338]][[BGBIGFCA]]

*_Table 2-61 @Property Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) Name of the property |

|`value` |(Required) String representation of the property `value`,
converted to an instance of `valueType` |

|`valueType` |(Optional) Property value type, converted to valueType by
`ConversionManager`. This must be a simple type that can be handled by
the `ConversionManager`. |`String`
|=======================================================================

[[sthref339]]

*Usage*

You can specify `@Property` on a mapped attribute (or its `get`/`set`
method) within an Entity, MappedSuperclass, or Embeddable class. You can
also specify this annotation on an Entity, MappedSuperclass, or
Embeddable class.

Properties defined in MappedSuperclass are passed to all inheriting
Entities and MappedSuperclasses. In case of a conflict, property values
defined directly on a class always override values inherited from a
class's parent.

When using an `orm.xml` mapping file, EclipseLink ignores `@Property`
and `@Properties` annotations on mapped attributes; annotations on
classes are merged with those specified i the `orm.xml` file, with the
latter taking precedence in case of conflicts.

[[sthref340]]

*Examples*

link:#BABHECGF[Example 2-120] shows how to use the `@Property`
annotation within a `@Transformation` mapping. link:#BABHCBAG[Example
2-121] shows how to use the `<property>` XML element within the
`orm.xml` file.

[[sthref341]]

*See Also*

For more information, see:

* link:#BABJHAFD["@Properties"]

[[CIHCGHGA]][[TLJPA514]]

'''''

=== @QueryRedirectors

Use @`QueryRedirectors` to intercept EclipseLink queries for pre- and
post-processing, redirection, or performing some side effect such as
auditing.

[[sthref342]]

*Annotation Elements*

link:#CIHEBJBG[Table 2-62] describes this annotation's elements.

[[TLJPA515]][[sthref343]][[CIHEBJBG]]

*_Table 2-62 @QueryRedirectors Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`allQueries` |This `AllQueries` Query Redirector will be applied to any
executing object query that does not have a more precise redirector
(like the `ReadObjectQuery` Redirector) or a redirector set directly on
the query. |`void.class`

|`delete` |A Default `Delete` Object Query Redirector will be applied to
any executing `DeleteObjectQuery` or `DeleteAllQuery` that does not have
a redirector set directly on the query. |`void.class`

|insert |A Default `Insert` Query Redirector will be applied to any
executing `InsertObjectQuery` that does not have a redirector set
directly on the query. |`void.class`

|readAll a|
A Default `ReadAll` Query Redirector will be applied to any executing
`ReadAllQuery` that does not have a redirector set directly on the
query.

For users executing a JPA Query through the `getResultList()`, API this
is the redirector that will be invoked

 |`void.class`

|`readObject` a|
A Default `ReadObject` Query Redirector will be applied to any executing
`ReadObjectQuery` that does not have a redirector set directly on the
query.

For users executing a JPA Query through the `getSingleResult()` API or
`EntityManager.find()`, this is the redirector that will be invoked

 |`void.class`

|`report` a|
A Default `ReportQuery` Redirector will be applied to any executing
`ReportQuery` that does not have a redirector set directly on the query.

For users executing a JPA Query that contains aggregate functions or
selects multiple entities this is the redirector that will be invoked

 |`void.class`

|`update` |A Default `Update` Query Redirector will be applied to any
executing UpdateObjectQuery or `UpdateAllQuery` that does not have a
redirector set directly on the query. In EclipseLink an
`UpdateObjectQuery` is executed whenever flushing changes to the
datasource. |`void.class`
|=======================================================================

[[sthref344]]

*Usage*

Use `@QueryRedirectors` to extend the standard EclipseLink query
functionality.

You can set a `QueryRedirector` through the Query Hint
`eclipselink.query.redirector` or set as a default Redirector on an
Entity.

`QueryRedirectors` are used when integrating EclipseLink Grid to
redirect queries to the Coherence grid.

[[sthref345]]

*Examples*

link:#CIHDHIIH[Example 2-97] shows how to use this annotation.

[[CIHDHIIH]][[TLJPA516]]

*_Example 2-97 Using @QueryRedirectors Annotation_*

[source,oac_no_warn]
----
@QueryRedirectors(
    allQueries=org.queryredirectors.AllQueriesForEntity.class)
@Entity
public class
...
----

[[sthref346]]

*See Also*

For more information, see:

* "Database Queries" in the _Understanding EclipseLink_

[[BABCFDAJ]][[TLJPA517]]

'''''

=== @RangePartition

Use `@RangePartition` to create a specific range partition for a
connection pool. Values within the range will be routed to the specified
connection pool.

[[sthref347]]

*Annotation Elements*

link:#BABCAEJH[Table 2-63] describes this annotation's elements.

[[TLJPA518]][[sthref348]][[BABCAEJH]]

*_Table 2-63 @RangePartition Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`connectionPool` |The connection pool to which to route queries for the
specified range |

|`startValue` |The `String` representation of the range start value |

|`endValue` |The `String` representation of the range end value |
|=======================================================================

[[sthref349]]

*Examples*

See link:#CEGJCEIH["Using @RangePartitioning"] for an example of
partitioning with EclipseLink.

[[sthref350]]

*See Also*

For more information, see:

* "Data
Partitioning"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning`
* link:#CHDDAHEB["@Partitioned"]

[[BCGCGEIH]][[TLJPA519]]

'''''

=== @RangePartitioning

Use `@RangePartitioning` to partitions access to a database cluster by a
field value from the object (such as the object's ID, location, or
tenant).

EclipseLink assigns each server a range of values. All write or read
request for objects with a server's value are sent to that specific
server. If a query does not include the field as a parameter, then it
can either be sent to all server's and unioned, or left to the session's
default behavior.

[[sthref351]]

*Annotation Elements*

link:#BCGHJEBE[Table 2-64] describes this annotation's elements.

[[TLJPA520]][[sthref352]][[BCGHJEBE]]

*_Table 2-64 @RangePartitioning Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) The name of the partition policy; must be unique for
the persistence unit. |

|`partitionColumn` a|
(Required) The database column or query parameter to partition queries
by. This is the _table column name_, not the class attribute name. The
column value must be included in the query and should normally be part
of the object's ID.

This can also be the name of a query parameter. If a query does not
contain the field the query will not be partitioned.

 |

|`partitions` |(Required) List of connection pool names to partition
across |

|`partitionValueType` |The type of the start and end values |`String`

|`unionunpartionableQueries` |Defines if queries that do not contain the
partition field should be sent to every database and have the result
unioned. |`false`
|=======================================================================


[[sthref353]]

*Usage*

Partitioning can be enabled on an Entity, relationship, query, or
session/persistence unit.

Partition policies are globally named to allow reuse, the partitioning
policy must also be set using the `@Partitioned` annotation to be used.

The persistence unit properties support adding named connection pools in
addition to the existing configuration for read/write/sequence. A named
connection pool must be defined for each node in the database cluster.

If a transaction modifies data from multiple partitions, you should use
JTA ensure proper two-phase commit of the data. You can also configure
an exclusive connection in the EntityManager to ensure that only a
single node is used for a single transaction.

[[sthref354]]

*
Examples*

link:#BCGIJGHH[Example 2-98] shows how to use the `@RangePartitioning`
annotation

[[BCGIJGHH]][[TLJPA521]]

*_Example 2-98 Using @RangePartitioning Annotation_*

[source,oac_no_warn]
----
@Entity
@Table(name="PART_PROJECT")
@RangePartitioning(
  name="RangePartitioningByPROJ_ID",
  partitionColumn=@Column(name="PROJ_ID"),
  partitionValueType=Integer.class,
  unionUnpartitionableQueries=true,
  partitions={
    @RangePartition(connectionPool="default", startValue="0", endValue="1000"),
    @RangePartition(connectionPool="node2", startValue="1000", endValue="2000"),
    @RangePartition(connectionPool="node3", startValue="2000")
  })
@Partitioned("RangePartitioningByPROJ_ID")
public class Project implements Serializable {
...
}
----

link:#BCGIJGHH[Example 2-98] shows how to use the `<range-partitioning>`
element in the `eclipselink-orm.xml` file.

[[TLJPA522]]

*_Example 2-99 Using <range-partitioning> XML_*

[source,oac_no_warn]
----
<entity name="Project" class="Project" access="FIELD">
  <table name="PART_PROJECT"/>
  <range-partitioning name="RangePartitioningByPROJ_ID" partition-value-type="java.lang.Integer" union-unpartitionable-queries="true">
    <partition-column name="PROJ_ID"/>
    <partition connection-pool="default" start-value="0" end-value="1000"/>
    <partition connection-pool="node2" start-value="1000" end-value="2000"/>
    <partition connection-pool="node3" start-value="2000"/>
  </range-partitioning>
  <partitioned>RangePartitioningByPROJ_ID</partitioned>
</entity>
----

[[sthref356]]

*See Also*

For more information, see:

* link:#BABCFDAJ["@RangePartition"]
* link:#CHDDAHEB["@Partitioned"]

[[BGBGEFBD]][[TLJPA523]]

'''''

=== @ReadOnly

Use `@ReadOnly` to specify that a class is read-only.

[[sthref357]]

*Annotation Elements*

This annotation contains no elements.

[[sthref358]]

*Usage*

It may be defined on an Entity or MappedSuperclass.

In the case of inheritance, a `@ReadOnly` annotation can only be defined
on the root of the inheritance hierarchy .

You can also use `@ReadOnly` to bypass EclipseLink's persistence context
to save heap space (such as if you need to load a large dataset).

NOTE: You should not modify read-only entities. Doing so can corrupt the
EclipseLink cache. To modify a read-only entity, it must cloned or
serialized.


[[sthref359]]

*Examples*

link:#BGBCIIDB[Example 2-100] shows how to use this annotation.

[[BGBCIIDB]][[TLJPA524]]

*_Example 2-100 Using @ReadOnly Annotation_*

[source,oac_no_warn]
----
@ReadOnly
@Entity
@Table(name = "TMP_READONLY")
public class ReadOnlyEntity {
...
}
----

link:#BGBCBHEE[Example 2-101] shows how to use the `<read-only>` element
in the `eclipselink-orm.xml` file.

[[BGBCBHEE]][[TLJPA525]]

*_Example 2-101 Using <read-only> XML_*

[source,oac_no_warn]
----
<entity name="XMLReadOnlyClass" class="ReadOnlyClass" access="PROPERTY" read-only="true">
----

[[sthref360]]

*See Also*

For more information, see:

* link:#CACGCEIJ["Entity Annotations"]

[[CHDGHHBA]][[TLJPA526]]

'''''

=== @ReadTransformer

Use `@ReadTransformer` with Transformation mappings to define the
transformation of the database column values into attribute values
(unless the mapping is write-only).

[[sthref361]]

*Annotation Elements*

link:#CHDGCGID[Table 2-65] describes this annotation's elements.

[[TLJPA527]][[sthref362]][[CHDGCGID]]

*_Table 2-65 @ReadTransformer Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`method` |The mapped class must have a method with this name which
returns a value to be assigned to the attribute (not assigns the value
to the attribute). |

|transformerClass a|
User-defined class that implements the
`org.eclipse.persistence.mappings.transformers.AttributeTransformer`
interface

The class will be instantiated, its `buildAttributeValue` will be used
to create the value to be assigned to the attribute.

 |`void.class`
|=======================================================================

NOTE: You must specify *either* a `method` or `transformerClass`, but not
both.


[[sthref363]]

*Usage*

Also unless it's a read-only mapping, either `@WriteTransformer`
annotation or `@WriteTransformers` annotation should be specified. Each
`WriteTransformer` defines transformation of the attribute value to a
single database column value (column is specified in the
`WriteTransformer`).

[[sthref364]]

*Examples*

See link:#BABHECGF["Using @Transformation Annotation"] for an example of
how to use the `@WriteTransformer annotation` with a Transformation
mapping.

[[sthref365]]

*See Also*

For more information, see:

* link:#BABCJGIG["@Transformation"].
* link:#BGBGGAEA["@WriteTransformer"]

[[BABJEFJH]][[TLJPA528]]

'''''

=== @ReplicationPartitioning

Use `@ReplicationPartitioning` to send requests to a set of connection
pools. It is for replicating data across a cluster of database machines.
Only modification queries are replicated.

[[sthref366]]

*Annotation Elements*

link:#BABJICDB[Table 2-66] describes this annotation's elements.

[[TLJPA529]][[sthref367]][[BABJICDB]]

*_Table 2-66 @ReplicationPartitioning Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |The name of the partition policy; must be unique for the
persistence unit |

|`connectionPools` |List of connection pool names to replicate across
|All defined pools in the `ServerSession`
|=======================================================================

[[sthref368]]

*Usage*

Partitioning can be enabled on an Entity, relationship, query, or
session/persistence unit.

Partition policies are globally named to allow reuse, the partitioning
policy must also be set using the `@Partitioned` annotation to be used.

The persistence unit properties support adding named connection pools in
addition to the existing configuration for read/write/sequence. A named
connection pool must be defined for each node in the database cluster.

If a transaction modifies data from multiple partitions, you should use
JTA ensure proper two-phase commit of the data. You can also configure
an exclusive connection in the EntityManager to ensure that only a
single node is used for a single transaction.

[[sthref369]]

*Examples*

See link:#CEGHAIDJ["Using Partitioning"] for an example of partitioning
with EclipseLink.

[[sthref370]]

*See Also*

For more information, see:

* "Data
Partitioning"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning`
* link:#CHDDAHEB["@Partitioned"]

[[CIHHEGJE]][[TLJPA530]]

'''''

=== @ReturnInsert

Use `@ReturnInsert` to cause `INSERT` operations to return values back
into the object being written. This allows for table default values,
trigger or stored procedures computed values to be set back into the
object.

[NOTE]
====
Returning is only supported with an Oracle Database and requires an
`INSERT RETURNING` clause.

To use returning with other databases, a stored procedure with output
parameters is used for the insert query.
====

[[sthref371]]

*Annotation Elements*

link:#CIHIAFFB[Table 2-67] describes this annotation's elements.

[[TLJPA531]][[sthref372]][[CIHIAFFB]]

*_Table 2-67 @ReturnInsert Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`returnOnly` |(Optional) If specified (true), the mapping field will be
excluded from the `INSERT` clause during SQL generation. |false
|=======================================================================

[[sthref373]]

*Usage*

A `@ReturnInsert` annotation can only be specified on a `Basic` mapping.

[[sthref374]]

*Examples*

link:#CIHDFAFD[Example 2-102] shows how to use the `@ReturnInsert`
annotation. If you do not use an argument, EclipseLink accepts the
default value, `false`.

[[CIHDFAFD]][[TLJPA532]]

*_Example 2-102 Using @ReturnInsert Annotation_*

[source,oac_no_warn]
----
@ReturnInsert(returnOnly=true)
 public String getFirstName() {
     return firstName;
 }
----

link:#CIHEJAJG[Example 2-103] shows how to use the `<return-insert>`
element in the `eclipselink-orm.xml` file.

[[CIHEJAJG]][[TLJPA533]]

*_Example 2-103 Using <return-insert> XML_*

[source,oac_no_warn]
----
<basic name="firstName">
    <column name="FIRST_NAME"/>
    <return-insert read-only="true"/>
</basic>
----

[[sthref375]]

*See Also*

For more information, see:

* link:#CACHDFCF["@ReturnUpdate"]
* _Understanding EclipseLink_

[[CACHDFCF]][[TLJPA534]]

'''''

=== @ReturnUpdate

Use `@ReturnUpdate` to cause `UPDATE` operations to return values back
into the object being written. This allows for table default values,
trigger or stored procedures computed values to be set back into the
object.

[NOTE]
====
Returning is only supported with an Oracle Database and requires an
`INSERT RETURNING` clause.

To use returning with other databases, a stored procedure with output
parameters is used for the insert query.
====

[[sthref376]]

*Annotation Elements*

This annotation contains no elements.

[[sthref377]]

*Usage*

A `@ReturnUpdate` annotation can only be specified on a `Basic` mapping.

[[sthref378]]

*Examples*

link:#CACBJIIH[Example 2-104] shows how to use the `@ReturnUpdate`
annotation. The annotation does not accept any arguments.

[[CACBJIIH]][[TLJPA535]]

*_Example 2-104 Using @ReturnUpdate Annotation_*

[source,oac_no_warn]
----
@ReturnUpdate
public String getFirstName() {
    return firstName;
}
----

link:#CACJIJGE[Example 2-105] illustrates the same example as before,
but uses the `<return-update>` element in the `eclipselink-orm.xml`
mapping file.

[[CACJIJGE]][[TLJPA536]]

*_Example 2-105 Using <return-update> XML_*

[source,oac_no_warn]
----
<basic name="firstName">
    <column name="F_NAME"/>
    <return-update/>
</basic>
----

[[sthref379]]

*See Also*

For more information, see:

* link:#CIHHEGJE["@ReturnInsert"]
* Understanding EclipseLink

[[BCGBJGFF]][[TLJPA537]]

'''''

=== @RoundRobinPartitioning

Use `@RoundRobinPartitioning` to send requests in a "round robin"
fashion to the set of connection pools.

[[sthref380]]

*Annotation Elements*

link:#BCGIBFHJ[Table 2-68] describes this annotation's elements.

[[TLJPA538]][[sthref381]][[BCGIBFHJ]]

*_Table 2-68 @RoundRobinPartitioning Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) Name of the partition policy. Names must be unique
for the persistence unit. |

|`connectionPools` |(Optional) List of connection pool names to load
balance across |All defined pools in the `ServerSession`

|`replicateWrite` |(Optional) This allows for a set of database to be
written to and kept in sync, and have reads load-balanced across the
databases. |`false`
|=======================================================================

[[sthref382]]

*Usage*

Use the `@RoundRobinPartitioning` annotation for load-balancing read
queries across a cluster of database machines. Using
`@RoundRobinPartitioning` requires that the full database be replicated
on each machine.

The data should either be read-only, or writes should be replicated on
the database.

The persistence unit properties support adding named connection pools in
addition to the existing configuration for read/write/sequence. A named
connection pool must be defined for each node in the database cluster.

If a transaction modifies data from multiple partitions, you should use
JTA ensure proper two-phase commit of the data. You can also configure
an exclusive connection in the EntityManager to ensure that only a
single node is used for a single transaction.

[[sthref383]]

*Examples*

See link:#CHDDAHEB["@Partitioned"] for an example of partitioning with
EclipseLink.

[[sthref384]]

*See Also*

For more information, see:

* "Data
Partitioning"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning`
* link:#CHDDAHEB["@Partitioned"]



[[ANNOTATION_SERIALIZEDCONVERTER]]

'''''

=== @SerializedConverter

A `@SerializedConverter` is used to serialize an object's value into a database binary, character, or XML field.
 annotation allows a named converter that can be used in mappings.

A converter must be be uniquely identified by name and can be defined at
the class level and can be specified within an Entity,
`@MappedSuperclass` and `@Embeddable` class.

The usage of a `@SerializedConverter` is always specified via the `@Converter` annotation and
is supported on a Basic, or ElementCollection mapping.

*Annotation Elements*

link:#CACBBJAE[Table 2-69] describes this annotation's elements.

[[TLJPA54060]][[sthref386]][[CACBBJAE]]

*_Table 2-69 @SerializedConverter Attribute Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) Name this converter. The name should be unique across the
whole persistence unit. |

|`serializerClass` |(Required) The serializer class to be used. This class must implement the
`org.eclipse.persistence.sessions.serializers.Serializer` interface.
|`JavaSerializer.class`

|`serializerPackage` |(Optional) Allows a package name to be passed to the serializer.
This is used by some serializers such as XML, JSON to initialize the
JAXB context from the classes in the package or a jaxb.index file.
|
|=======================================================================

*Usage*

The usage of a `@SerializedConverter` is always specified via the `@Converter` annotation and
is supported on a Basic, or ElementCollection mapping.

*Examples*

link:#CACFCAFFA[Example 2-106.1] demonstrates how to use the
`@SerializedConverter` and apply it with `@Converter` annotation to the Entity field.

[[CACFCAFFA]]

*_Example 2-106.1 Specifying a Serialized Object Policy_*

[source,oac_no_warn]
----
@Entity
@SerializedConverter(name="json2", serializerClass=JSONSerializer.class, serializerPackage="org.eclipse.persistence.testing.models.jpa.lob")
public class Image implements Serializable {
...
    @org.eclipse.persistence.annotations.Convert("json2")
    public SerializableNonEntity getJson2() {
        return json2;
    }
...
}
----

*See Also*

For more information:

* link:#CHDEHJEB[@Converter]

[[ANNOTATION_SERIALIZEDCONVERTERS]]

'''''

=== @SerializedConverters

A TypeConverters annotation allows the definition of multiple SerializedConverter.

[[sthref385]]

*Annotation Elements*

link:#CACBBJAE[Table 2-69.1] describes this annotation's elements.

*_Table 2-69.1 @SerializedConverters Attribute Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`SerializedConverters` `value` |(Optional) One or more
`SerializedConverters` annotations |none
|=======================================================================

*Examples*

link:#CACFCAFFB[Example 2-106.2] demonstrates how to use the
@SerializedConverters annotation with field.

[[CACFCAFFB]]

*_Example 2-106.2 Using @SerializedConverters annotation with field._*

[source,oac_no_warn]
----
@SerializedConverters({
    @SerializedConverter(name="xml2", serializerClass=XMLSerializer.class, serializerPackage="org.eclipse.persistence.testing.models.jpa.lob")
})
public SerializableNonEntity getXml2() {
    return xml2;
}
----

*See Also*

* `@SerializedConverter`

[[CACDCCIA]][[TLJPA54059]]

'''''

=== @SerializedObject

Use an `@SerializedObject` annotation to set an
`org.eclipse.persistence.descriptors.SerializedObjectPolicy` instance on
an `Entity` object or `MappedSuperClass` object. If a serialized object
policy is specified, a whole entity object is written with its
privately-owned (and nested, privately-owned) entities and element
collections into an additional field in the database.

*Annotation Elements*

link:#CACBBJAEA[Table 2-69.1] describes this annotation's elements.

*_Table 2-69.1 @SerializedObject Attribute Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`column` |(Optional) The column that holds the serialized object |BLOB
column named SOP in the entity's main table.

|`value` |(Required) The Class that implements the
` SerializedObjectPolicy` interface |
|=======================================================================

[[sthref387]]

*Usage*

Use an `@SerializedObject` annotation to read data from the database
faster. The drawback to this usage is that writing to the database is
slower. Use a serialized object policy for read-only and read-mostly
applications for entities and element collections.

If the serialized object column contains `null` or an obsolete version
of the object, then a query using a serialized object policy would
either throw an exception or, if all other fields have been read as
well, build the object using these fields (exactly as in the case where
a serialized object policy is not used).

NOTE: Currently, no default implementation of the `SerializedObjectPolicy`
interface is available. You must provide this class.

[[sthref388]]

*Examples*

link:#CACFCAFF[Example 2-106] demonstrates how to use the
@SerializedObject annotation to specify a serialized object policy and
how to override the default column name.

[[CACFCAFF]][[TLJPA54098]]

*_Example 2-106 Specifying a Serialized Object Policy_*

[source,oac_no_warn]
----
@Entity
@SerializedObject(MySerializedPolicy.class);
public class Employee {...

@Entity
@SerializedObject(value = MySerializedObjectPolicy.class, column = @Column(name = "SERIALIZED"));
public class Address (...
----

If an @SerializedObject annotation is set on an entity object, then read
queries (in addition to find and refresh) that return the object use the
serialized object policy by default.

link:#CACGIGIH[Example 2-107] demonstrates how to prevent using the
serialized object policy in a query.

[[CACGIGIH]][[TLJPA54099]]

*_Example 2-107 Preventing the Use of a Serialized Object Policy in a
Query_*

[source,oac_no_warn]
----
Query query = em.createQuery("SELECT e FROM Employee e")
.setHint(QueryHints.SERIALIZED_OBJECT, "false");
----

link:#CACGFBHH[Example 2-108] demonstrates how to use a serialized
object policy property to prevent searching for a serialized object. .

[[CACGFBHH]][[TLJPA54100]]

*_Example 2-108 Preventing Search Using a Serialized Object Policy
Property_*

[source,oac_no_warn]
----
Map hints = new HashMap();
hints.put("eclipselink.serialized-object", "false");
Address address = em.find(Address.class, id, hints);
----

[[sthref389]]

*See Also*

For more information:

* `SerializedObjectPolicy`

[[CHDDEBEC6]][[TLJPA5399]]

'''''

=== @StoredProcedureParameter

Use `@StoredProcedureParameter` within a `NamedStoredProcedureQuery`
annotation.

[[sthref390]]

*Annotation Elements*

link:#CHDDEJEC6[Table 2-70] describes this annotation's elements.

[[TLJPA54000]][[sthref391]][[CHDDEJEC6]]

*_Table 2-70 @StoredProcedureParameter Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`queryParameter` |(Required) The query parameter name |

|`direction` a|
(Optional) The direction of the stored procedure parameter:

* `IN` – Input parameter
* `IN_OUT` – Input and output parameters
* `OUT` – Output parameter
* `OUT_CURSOR` – Output cursor

 |`IN`

|`jdbcType` |(Optional) JDBC type code. This depends on the type
returned from the procedure. |`-1`

|`jdbcTypeName` |(Optional) JDBC type name. This may be required for
`ARRAY` or `STRUCT` types. |

|`name` |(Optional) Stored procedure parameter name |

|`optional` |(Optional) Specify if the parameter is required, or
optional and defaulted by the procedure. |`false`

|`type` |(Optional) Type of Java class desired back from the procedure.
This depends on the `type` returned from the procedure. |`void.class`
|=======================================================================

[[sthref392]]

*Examples*

See link:#BGBGAEFF["@NamedStoredProcedureQuery"] for an example using
the `@StoredProcedureParameter` annotation.

[[sthref393]]

*See Also*

For more information:

* link:#BGBGAEFF["@NamedStoredProcedureQuery"]
* Stored Procedure
Examples`http://wiki.eclipse.org/EclipseLink/Examples/JPA/StoredProcedures`

[[CBBDCAHG]][[TLJPA541]]

'''''

=== @Struct

Use @Struct to define a class to map to a database `Struct` type. The
class should normally be an Embeddable, but could also be an Entity if
stored in a object table.

[[sthref394]]

*Annotation Elements*

link:#CBBCGIHG[Table 2-71] describes this annotation's elements.

[[TLJPA542]][[sthref395]][[CBBCGIHG]]

*_Table 2-71 @Struct Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) The database name of the database structure type |

|`fields` |(Optional) Defines the order of the fields contained in the
database structure type. |
|=======================================================================

[[sthref396]]

*Usage*

`Struct` types are extended object-relational data-types supported by
some databases. Struct types are user define types in the database such
as `OBJECT` types on Oracle. Structs normally contain Arrays (`VARRAY`)
or other Struct types, and can be stored in a column or a table.

You can also use `Struct` types to call PL/SQL stored procedures that
use `RECORD` types in an Oracle Database.

[[sthref397]]

*Examples*

link:#CACCGJAJ[Example 2-109] shows using the `@Struct` annotation to
define a Java class to map to an `OBJECT` type.

[[CACCGJAJ]][[TLJPA543]]

*_Example 2-109 Using @Struct Annotation_*

[source,oac_no_warn]
----
@Embeddable
@Struct(name="EMP_TYPE", fields={"F_NAME", "L_NAME", "SALARY"})
public class Employee {
 @Column(name="F_NAME")
 private String firstName;
 @Column(name="L_NAME")
 private String lastName;
 @Column(name="SALARY")
 private BigDecimal salary;
 ...
}
----

link:#CBBIEDGD[Example 2-110] shows how to use the `<struct>` element in
the `eclipselink-orm.xml` file.

[[CBBIEDGD]][[TLJPA544]]

*_Example 2-110 Using <struct> XML_*

[source,oac_no_warn]
----
<embeddable class="Address" access="FIELD">
  <struct name="PLSQL_P_PLSQL_ADDRESS_REC">
    <field>ADDRESS_ID</field>
    <field>STREET_NUM</field>
    <field>STREET</field>
    <field>CITY</field>
    <field>STATE</field>
  </struct>
  <attributes>
    <basic name="id">
      <column name="ADDRESS_ID"/>
    </basic>
    <basic name="number">
      <column name="STREET_NUM"/>
    </basic>
  </attributes>
</embeddable>
----

[[sthref398]]

*See Also*

For more information, see:

* link:#CACIJAFA["@Structure"]

[[BGBJEBBB]][[TLJPA545]]

'''''

=== @StructConverter

Use `@StructConverter` to enable custom processing of `java.sql.Struct`
types to process complex database types, such as spatial datatypes.

EclipseLink includes the `JGeometryConverter` class to convert the
Oracle `JGeometry` spatial datatype.

NOTE: Unlike other converters, `@StructConverter` has its own interface.

[[sthref399]]

*Annotation Elements*

link:#BABJIBGI[Table 2-72] describes this annotation's elements.

[[TLJPA546]][[sthref400]][[BABJIBGI]]

*_Table 2-72 @StructConverter Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |The `String` name for your converter. Ensure that this name is
unique across the persistence unit. |none

|`converter` |The converter class as a `String`. This class must
implement the
`org.eclipse.persistence.platform.database.converters.StructConverter`
interface. |none
|=======================================================================

[[sthref401]]

*Usage*

You can use the existing `@Convert` annotation with its value attribute
set to the `StructConverter` name – in this case, the appropriate
settings are applied to the mapping. This setting is required on all
mappings that use a type for which a `StructConverter` has been defined.
Failing to configure the mapping with the `@Convert` will cause an
error.

EclipseLink also includes additional converters, such as
`@ObjectTypeConverter` and `@TypeConverter`.

[[sthref402]]

*Examples*

link:#BGBJCJCC[Example 2-111] shows how to define the `@StructConverter`
annotation.

[[BGBJCJCC]][[TLJPA547]]

*_Example 2-111 Using @StructConverter Annotation_*

[source,oac_no_warn]
----
@StructConverter(
     name="JGeometryConverter"
     converter=JGeometryConverter.class.getName())
----

You can specify the `@StructConverter` annotation anywhere in an Entity
with the scope being the whole session. An exception is thrown if you
add more than one `StructConverter` annotation that affects the same
Java type. An `@StructConverter` annotation exists in the same
namespaces as `@Converter`. A validation exception is thrown if you add
an `@Converter` and an `@StructConverter` of the same name.

[[sthref403]]

*See Also*

For more information, see:

* link:#CHDCJCDE["@StructConverters"]
* "Default Conversions and Converters"
`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Basic_JPA_Development/Mapping/Basic_Mappings/Default_Conversions_and_Converters/StructConverter`

[[CHDCJCDE]][[TLJPA548]]

'''''

=== @StructConverters

Use `@StructConverters` to define multiple `@StructConverter`
annotations.

[[sthref404]]

*Annotation Elements*

link:#CHDJDFBJ[Table 2-73] describes this annotation's elements.

[[TLJPA549]][[sthref405]][[CHDJDFBJ]]

*_Table 2-73 @StructConverters Annotation Elements_*

|================================================================
|*Annotation Element* |*Description* |*Default*
|`StructConverter[]` |(Required) An array of struct converter |
|================================================================

[[sthref406]]

*Examples*

link:#CHDHGDGH[Example 2-112] shows how to use the `@StructConverters`
annotation to define multiple `@StructConverter` elements.

[[CHDHGDGH]][[TLJPA550]]

*_Example 2-112 Using @StructConverters Annotation_*

[source,oac_no_warn]
----
@StructConverters{{
  @StructConverter(name="StructConverter1", converter="foo.StructConverter1"),
  @StructConverter(name="StructConverter2", converter="foo.StructConverter2")
  })
----

link:#CHDHGABD[Example 2-113] shows how to use the `<struct-converters>`
element in the `eclipselink-orm.xml` file.

[[CHDHGABD]][[TLJPA551]]

*_Example 2-113 Using <struct-converters> XML_*

[source,oac_no_warn]
----
<struct-converters>
  <struct-converter name="StructConverter1" converter="foo.StructConverter1"/>
  <struct-converter name="StructConverter2" converter="foo.StructConverter2"/>
</struct-converters>
----

[[sthref407]]

*See Also*

For more information, see:

* link:#BGBJEBBB["@StructConverter"]

[[CACIJAFA]][[TLJPA552]]

'''''

=== @Structure

Use `@Structure` on a field/method to define a `StructureMapping` to an
embedded `Struct` type. The target Embeddable must be mapped using the
Struct annotation.

[[sthref408]]

*Annotation Elements*

This annotation contains no elements.

[[sthref409]]

*Usage*

Struct types are extended object-relational data-types supported by some
databases. Struct types are user define types in the database such as
`OBJECT` types on Oracle. Structs can normally contains Arrays
(`VARRAY`) or other Struct types, and can be stored in a column or a
table.

[[sthref410]]

*Examples*

link:#CACDBBII[Example 2-114] shows how to use the `@Structure`
annotation. See link:#CACCGJAJ[Example 2-109] to an example of using
`@Struct` to map the target.

[[CACDBBII]][[TLJPA553]]

*_Example 2-114 Using @Structure Annotation_*

[source,oac_no_warn]
----
@Structure
protected Address address;
 
----

You can also define structure mappings in the `eclipselink-orm.xml` file
by using the `<structure>` element.

[[TLJPA554]]

*_Example 2-115 Using <structure> XML_*

[source,oac_no_warn]
----
<structure name="address"/>
 
----

[[sthref412]]

*See Also*

For more information, see:

* link:#CBBDCAHG["@Struct"]

[[CHECIDGH]][[TLJPA555]]

'''''

=== @TenantDiscriminatorColumn

The `@TenantDiscriminator` annotation is used with the `@Multitenant`
annotation and the `SINGLE-TABLE` mulitenant type to limit what a
persistence context can access in single-table mulitenancy.

[[sthref413]]

*Annotation Elements*

link:#CHEIBAFI[Table 2-74] describes this annotation's elements.

[[TLJPA556]][[sthref414]][[CHEIBAFI]]

*_Table 2-74 @TenantDiscriminatorColumn Properties_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`java.lang.String` `columnDefinition` |(Optional) The SQL fragment that
is used when generating the DDL for the discriminator column |The
provider-generated SQL to create a column of the specified discriminator
type.

|`java.lang.String` `contextProperty` |(Optional) The name of the
context property to apply to the tenant discriminator column
|`eclipselink.tenant-id`

|`DiscriminatorType` `discriminatorType` |(Optional) The type of
object/column to use as a class discriminator
|`jakarta.persistence.DiscriminatorType.STRING`

|`int` `length` |(Optional) The column length for String-based
discriminator types |The column length for String-based discriminator
types. Ignored for other discriminator types.

|`java.lang.String` `name` |(Optional) The name of column to be used for
the tenant discriminator |`TENANT_ID`

|`boolean` `primaryKey` |Specifies that the tenant discriminator column
is part of the primary key of the tables. |`false`

|`java.lang.String` `table` |(Optional) The name of the table that
contains the column |The name of the table that contains the column. If
absent the column is assumed to be in the primary table. This attribute
must be specified if the column is on a secondary table.
|=======================================================================

[[sthref415]]

*Usage*

To configure single-table multi-tenancy, you must specify both of the
following:

* Annotate the entity or mapped superclass to use single-table
multi-tenancy, using the `@Multitenant` annotation, for example:
+
[source,oac_no_warn]
----
@Entity
@Table(name=”EMP”)
@Multitenant(SINGLE_TABLE)
----
+
`SINGLE_TABLE` states that the table or tables (`Table` and
`SecondaryTable`) associated with the given entity can be shared among
tenants.
+

NOTE: The `@Table` annotation is not required, because the discriminator
column is assumed to be on the primary table. However, if the
discriminator column is defined on a secondary table, you must identify
that table using `@SecondaryTable`.

* Specify the column or columns to be used as the discriminator column,
using the `@TenantDiscriminatorColumn` annotation, for example:
+
[source,oac_no_warn]
----
@Entity 
@Table(name=”EMP”) 
@Multitenant(SINGLE_TABLE) 
@TenantDiscriminatorColumn(name = ”TENANT_ID”)
----
+
You can specify multiple discriminator columns by using the
`@TenantDiscriminatorColumns` annotation, for example:
+
[source,oac_no_warn]
----
@Entity 
@Table(name = "EMPLOYEE") 
@Multitenant(SINGLE_TABLE) 
@TenantDiscriminatorColumns({ 
    @TenantDiscriminatorColumn(name = "TENANT_ID")
    @TenantDiscriminatorColumn(name = "TENANT_CODE" contextProperty="eclipselink.tenant-code")})
----

[[sthref416]]

*Using Discriminator Columns*

The following characteristics apply to discriminator columns:

* On persist, the values of tenant discriminator columns are populated
from their associated context properties.
* Tenant discriminator columns are application definable. That is, the
discriminator column is not tied to a specific column for each shared
entity table. You can use `TENANT_ID`, `T_ID`, etc.
* There is no limit on how many tenant discriminator columns an
application can define.
* Any name can be used for a discriminator column.
* Tenant discriminator column(s) must always be used with
@Multitenant(`SINGLE_TABLE`). You cannot specify the tenant
discriminator column(s) only.
* Generated schemas can include specified tenant discriminator columns.
* Tenant discriminator columns can be mapped or unmapped:
** When a tenant discriminator column is mapped, its associated mapping
attribute must be marked as read only. With this restriction in place, a
tenant discriminator column cannot be part of the entity identifier; it
can only be part of the primary key specification on the database.
* Both mapped and unmapped properties are used to form the additional
criteria when issuing a `SELECT` query.

[[sthref417]]

*Using Single-Table Multi-Tenancy in an Inheritance Hierarchy*

Inheritance strategies are configured by specifying the inheritance type
(see @jakarta.persistence.Inheritance). Single-table multi-tenancy can
be used in an inheritance hierarchy, as follows:

* Multi-tenant metadata can be applied only at the root level of the
inheritance hierarchy when using a `SINGLE_TABLE` or `JOINED`
inheritance strategy.
* You can also specify multi-tenant metadata within a `TABLE_PER_CLASS`
inheritance hierarchy. In this case, every entity has its own table,
with all its mapping data (which is not the case with `SINGLE_TABLE` or
`JOINED` strategies). Consequently, in the `TABLE_PER_CLASS` strategy,
some entities of the hierarchy may be multi-tenant, while others may not
be. The other inheritance strategies can only specify multi-tenancy at
the root level, because you cannot isolate an entity to a single table
to build only its type.

[[sthref418]]

* +
Examples*

link:#CHEJICEF[Table 2-74] shows a number of uses of tenant
discriminator columns.

[[CHEJICEF]][[TLJPA557]]

*_Example 2-116 Using @TenantDiscriminatorColumn Annotation_*

[source,oac_no_warn]
----
/** Single tenant discriminator column **/
 
@Entity
@Table(name = "CUSTOMER")
@Multitenant
@TenantDiscriminatorColumn(name = "TENANT", contextProperty = "multi-tenant.id")
public Customer() {
  ...
}
 
 
/** Multiple tenant discriminator columns using multiple tables **/
 
@Entity
@Table(name = "EMPLOYEE")
@SecondaryTable(name = "RESPONSIBILITIES")
@Multitenant(SINGLE_TABLE)
@TenantDiscriminatorColumns({
    @TenantDiscriminatorColumn(name = "TENANT_ID", contextProperty = "employee-tenant.id", length = 20)
    @TenantDiscriminatorColumn(name = "TENANT_CODE", contextProperty = "employee-tenant.code", discriminatorType = STRING, table = "RESPONSIBILITIES")
  }
)
public Employee() {
  ...
}
 
 
/** Tenant discriminator column mapped as part of the primary key on the database **/
 
@Entity
@Table(name = "ADDRESS")
@Multitenant
@TenantDiscriminatorColumn(name = "TENANT", contextProperty = "tenant.id", primaryKey = true)
public Address() {
  ...
}
 
 
/** Mapped tenant discriminator column **/
 
@Entity
@Table(name = "Player")
@Multitenant
@TenantDiscriminatorColumn(name = "AGE", contextProperty = "tenant.age")
public Player() {
  ...
 
  @Basic
  @Column(name="AGE", insertable="false", updatable="false")
  public int age;
}
----

link:#CHEDCDDF[Example 2-117] shows the same mappings, using the
`<tenant-disciminator-column>` XML element in the `eclipselink-orm.xml`
file.

[[CHEDCDDF]][[TLJPA558]]

*_Example 2-117 Using <tenant-discriminator-column> XML_*

[source,oac_no_warn]
----
<!-- Single tenant discriminator column -->
 
<entity class="model.Customer">
  <multitenant>
    <tenant-discriminator-column name="TENANT context-property="multi-tenant.id""/>
  </multitenant>
  <table name="CUSTOMER"/>
  ...
</entity>
 
----

[source,oac_no_warn]
----
<!-- Multiple tenant discriminator columns using multiple tables -->
 
<entity class="model.Employee">
  <multitenant type="SINGLE_TABLE">
    <tenant-discriminator-column name="TENANT_ID" context-property="employee-tenant.id" length="20"/>
    <tenant-discriminator-column name="TENANT_CODE" context-property="employee-tenant.id" discriminator-type="STRING" table="RESPONSIBILITIES"/>
  </multitenant>
  <table name="EMPLOYEE"/>
  <secondary-table name="RESPONSIBILITIES"/>
  ...
</entity>
 
----

[source,oac_no_warn]
----
<!-- Tenant discriminator column mapped as part of the primary key on the database -->
 
<entity class="model.Address">
  <multitenant>
    <tenant-discriminator-column name="TENANT" context-property="multi-tenant.id" primary-key="true"/>
  </multitenant>
  <table name="ADDRESS"/>
  ...
</entity>
----

[source,oac_no_warn]
----
 
<!-- Mapped tenant discriminator column -->
 
<entity class="model.Player">
  <multi-tenant>
    <tenant-discriminator-column name="AGE" context-property="tenant.age"/>
  </multi-tenant>
  <table name="PLAYER"/>
  ...
  <attributes>
    <basic name="age" insertable="false" updatable="false">
      <column name="AGE"/>
    </basic>
    ...
  </attributes>
  ...
</entity>
----

[[sthref419]]

*See Also*

* link:#BABIEJGD["@Multitenant"]
* link:#CECBEBEA["@TenantDiscriminatorColumns"]
* link:#CHDFJJEC["@TenantTableDiscriminator"]
* "Using Multitenancy" in _Solutions Guide for EclispeLink_
* Multitenant Examples at
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/Multitenant`

[[CECBEBEA]][[TLJPA559]]

'''''

=== @TenantDiscriminatorColumns

Specify multiple discriminator columns for single-table multitenancy by
using the `@TenantDiscriminatorColumns` annotation to contain multiple
`@TenantDiscriminatorColumn` annotations.

[[sthref420]]

*Annotation Elements*

link:#CECFFDCB[Table 2-75] describes this annotation's elements.

[[TLJPA560]][[sthref421]][[CECFFDCB]]

*_Table 2-75 @TenantDiscriminatorColumns Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`TenantDiscriminatorColumn` `value` |(Optional) One or more
`TenantDiscriminatorColumn` annotations |none
|=======================================================================

[[sthref422]]

*Usage*

You must use the `@TenantDiscriminatorColumns` annotation to contain
multiple `@TenantDiscriminatorColumn` annotations. The
`@TenantDiscriminatorColumns` annotation cannot be used alone, and
multiple the `@TenantDiscriminatorColumn` annotations cannot be used
alone, without `@TenantDiscriminatorColumns`.

[[sthref423]]

*Examples*

[source,oac_no_warn]
----
@Entity 
@Table(name = "EMPLOYEE") 
@Multitenant(SINGLE_TABLE) 
@TenantDiscriminatorColumns({ 
    @TenantDiscriminatorColumn(name = "TENANT_ID", contextProperty = ”tenant-id)
    @TenantDiscriminatorColumn(name = "TENANT_CODE", contextProperty = ”tenant-code)})
----

See link:#CHECIDGH["@TenantDiscriminatorColumn"] for more examples of
`@TenantDiscriminatorColumns`.

[[sthref424]]

*See Also*

* link:#BABIEJGD["@Multitenant"]
* link:#CHECIDGH["@TenantDiscriminatorColumn"]
* link:#CHDFJJEC["@TenantTableDiscriminator"]

[[CHDFJJEC]][[TLJPA561]]

'''''

=== @TenantTableDiscriminator

Table-per-tenant multitenancy allows multiple tenants of an application
to isolate their data in one or more tenant-specific tables. The tenant
table discriminator specifies how to discriminate the tenant's tables
from the other tenants' tables in a table-per-tenant multitenancy
strategy.

[[sthref425]]

*Annotation Elements*

link:#CHDGDIIC[Table 2-76] describes this annotation's elements.

[[TLJPA562]][[sthref426]][[CHDGDIIC]]

*_Table 2-76 @TenantTableDiscriminator Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`java.lang.String` `ContextProperty` |(Optional) Name of the context
property to apply to as tenant table discriminator
|`eclipselink.tenant-id`

|`TenantTableDiscriminator type` a|
(Optional) Type of tenant table discriminator to use with the tables of
the persistence unit:

* `SCHEMA`
* `SUFFIX`
* `PREFIX`

 |`SUFFIX`
|=======================================================================

[[sthref427]]

*Usage*

In table-per-tenant multitenancy, tenants' tables can be in the same
schema, using a prefix or suffix naming pattern to distinguish them; or
they can be in separate schemas. The tenant table discriminator
identifies whether to use the prefix or suffix naming pattern or to use
a separate schema to identify and isolate the tenant's tables from other
tenants' tables. The types are:

* *Schema*: Applies the tenant table discriminator as a schema to all
multitenant tables. This strategy requires appropriate database
provisioning.
* *Suffix*: Applies the tenant table discriminator as a suffix to all
multitenant tables. This is the default strategy.
* *Prefix*: Applies the tenant table discriminator as a prefix to all
multitenant tables.

Tenant table discriminator can be specified at the entity or mapped
superclass level and must always be used with
`Multitenant(TABLE_PER_TENANT)`. It is not sufficient to specify only a
tenant table discriminator.

For more information about using `@TenantTableDiscriminator` and
table-per-tenant multitenancy, see link:#BABIEJGD["@Multitenant"].

[[sthref428]]

*Examples*

The following example shows a `SCHEMA`-type table discriminator.

[[TLJPA563]]

*_Example 2-118 Using @TenantTableDiscriminator Annotation_*

[source,oac_no_warn]
----
@Entity
@Table(name=”EMP”)
@Multitenant(TABLE_PER_TENANT)
@TenantTableDiscriminator(type=SCHEMA, contextProperty="eclipselink.tenant-id")
public class Employee {
    ...
}
 
----

[[TLJPA564]]

*_Example 2-119 Using **<tenant-table-discriminator**> XML_*

[source,oac_no_warn]
----
<entity class="Employee">
  <multitenant type="TABLE_PER_TENANT">
    <tenant-table-discriminator type="SCHEMA" context-property="eclipselink.tenant-id"/>
  </multitenant>
  <table name="EMP">
  ...
</entity>
----

[[sthref431]]

*See Also*

* link:#BABIEJGD["@Multitenant"]
* link:#CHECIDGH["@TenantDiscriminatorColumn"]
* link:#CECBEBEA["@TenantDiscriminatorColumns"]
* "Using Multitenancy" in _Solutions Guide for EclispeLink_
* Multitenant Examples at
`http://wiki.eclipse.org/EclipseLink/Examples/JPA/Multitenant`

[[BGBGACHC]][[TLJPA565]]

'''''

=== @TimeOfDay

Use `@TimeOfDay` to specify a specific time of day using a `Calendar`
instance which is to be used within an `@Cache` annotation.

[[sthref432]]

*Annotation Elements*

link:#BGBFEGGF[Table 2-77] describes this annotation's elements.

[[TLJPA566]][[sthref433]][[BGBFEGGF]]

*_Table 2-77 @TimeOfDay Annotation Elements_*

|=====================================================
|*Annotation Element* |*Description* |*Default*
|`hour` |(Optional) Hour of the day |`0`
|`millisecond` |(Optional) Millisecond of the day |`0`
|`minute` |(Optional) Minute of the day |`0`
|`second` |(Optional) Second of the day |`0`
|`specified` |For internal use – do not modify |`true`
|=====================================================

[[sthref434]]

*Examples*

See link:#CHDBBIHE["@Cache"] for examples of using `@TimeOfDay`.

[[sthref435]]

*See Also*

For more information, see:

* link:#CHDBBIHE["@Cache"]

[[BABCJGIG]][[TLJPA567]]

'''''

=== @Transformation

Use `@Transformation` with a Transformation mapping to define the
transformation of database columns into attribute values (unless the
Transformation mapping is write-only, in which case it should have a
`@ReadTransformer` annotation).

[[sthref436]]

*Annotation Elements*

link:#BABFBEDA[Table 2-78] describes this annotation's elements.

[[TLJPA568]][[sthref437]][[BABFBEDA]]

*_Table 2-78 @Transformation Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`fetch` a|
(Optional) Defines whether the value of the field or property should be
lazily loaded or must be eagerly fetched.

* The `EAGER` strategy is a requirement on the persistence provider
runtime that the value must be eagerly fetched.
* The `LAZY` strategy is a hint to the persistence provider runtime.

 |`EAGER`

|`optional` |(Optional) A hint as to whether the value of the field or
property may be `null`. It is disregarded for primitive types, which are
considered non-optional. |`true`
|=======================================================================

[[sthref438]]

*Usage*

Unless it's a read-only mapping, either `WriteTransformer` annotation or
`WriteTransformers` annotation should be specified. Each
`WriteTransformer` defines transformation of the attribute value to a
single database column value (column is specified in the
`WriteTransformer`).

[[sthref439]]

*Examples*

link:#BABHECGF[Example 2-120] shows how to use the `@Transformation`
annotation.

[[BABHECGF]][[TLJPA569]]

*_Example 2-120 Using @Transformation Annotation_*

[source,oac_no_warn]
----
@Transformation(fetch=FecthType.LAZY, optional="true")
@ReadTransformer(class=package.MyNormalHoursTransformer.class)
@WriteTranformers({
   @WriteTranformer(column=@Column(name="START_TIME"), 
      method="getStartDate"),
   @WriteTranformer(column=@Column(name="END_TIME"), 
      class=package.MyTimeTransformer.class)
})
@Mutable
@ReturnUpdate
@Access(AccessType.PROPERTY)
@AccessMethods(get="getNormalHours", set="setNormalHours")
@Properties({
   @Property(name="x", value="y")
})
----

link:#BABHCBAG[Example 2-121] shows the same mapping, using the
`<transformation>` XML element in the `eclipselink-orm.xml` file.

[[BABHCBAG]][[TLJPA570]]

*_Example 2-121 Using <transformation> XML_*

[source,oac_no_warn]
----
<transformation name="normalHours" fetch="LAZY" optional="true">
     <read-transformer method="buildNormalHours"/>
     <write-transformer method="getStartTime">
             <column name="START_TIME"/>
     </write-transformer>
     <write-transformer class="package.MyTimeTransformer">
             <column name="END_TIME"/>
     </write-transformer>
     <mutable/>
     <return-update/>
     <access type="PROPERTY"/>
     <access-methods get="getNormalHours" set="setNormalHours"/>
     <properties>
        <property name="x" value="y"/>
     </properties>
</transformation>
----

[[sthref440]]

* +
See Also*

For more information, see:

* link:#BGBGGAEA["@WriteTransformer"]
* link:#CHDGHHBA["@ReadTransformer"]

[[CHDHCCJF]][[TLJPA571]]

'''''

=== @TypeConverter

Use `@TypeConverter` to modify data values during the reading and
writing of a mapped attribute.

[[sthref441]]

*Annotation Elements*

link:#CHDIIHBI[Table 2-79] describes this annotation's elements.

[[TLJPA572]][[sthref442]][[CHDIIHBI]]

*_Table 2-79 @TypeConverter Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) The `String` name for your converter. This name must
be unique across the persistence unit. |none

|`dataType` |(Optional) The `type` stored in the database
|`void.class` footnote:disclaimer[]

|`objectType` |(Optional) The `type` stored on the entity
|`void.class` footnote:disclaimer[]
|=======================================================================

[[sthref444]]

*Usage*

Each `TypeConverter` must be uniquely named and can be defined at the
class, field and property level and can be specified within an Entity,
MappedSuperclass and Embeddable class. A `TypeConverter` is always
specified by using an `@Convert` annotation

You can place a `@TypeConverter` on a `Basic`, `BasicMap` or
`BasicCollection` mapping.

EclipseLink also includes `@ObjectTypeConverter` and `@StructConverter`
converters.

[[sthref445]]

*Examples*

link:#CHDEHGEF[Example 2-122] shows how to use the `@TypeConverter`
annotation to convert the `Double` value stored in the database to a
`Float` value stored in the entity.

[[CHDEHGEF]][[TLJPA573]]

*_Example 2-122 Using the @TypeConverter Annotation_*

[source,oac_no_warn]
----
@Entity
public class Employee implements Serializable{

...

  @TypeConverter (
    name="doubleToFloat",
    dataType=Double.class,
    objectType=Float.class,
  )
  @Convert("doubleToFloat")
  public Number getGradePointAverage() {
    return gradePointAverage;
  }

...
}
----

[[sthref446]]

*See Also*

For more information, see:

* link:#BEHGJHCD["@Convert"]
* link:#BCFBEIAE["@TypeConverters"]
* link:#CBBJAJCH["@ConversionValue"]

[[BCFBEIAE]][[TLJPA574]]

'''''

=== @TypeConverters

Use `@TypeConverters` to define multiple `TypeConverter` elements.

[[sthref447]]

*Annotation Elements*

link:#CIHJAIHB[Table 2-80] describes this annotation's elements.

[[TLJPA575]][[sthref448]][[CIHJAIHB]]

*_Table 2-80 @TypeConverters Annotation Elements_*

|============================================================
|*Annotation Element* |*Description* |*Default*
|`TypeConverter[]` |(Required) An array of type converter | +
|============================================================

 +

[[sthref449]]

*Examples*

link:#BCFEHCDH[Example 2-123] shows how to use this annotation.

[[BCFEHCDH]][[TLJPA576]]

*_Example 2-123 Using @TypeConverters Annotation_*

[source,oac_no_warn]
----
@Entity
@TypeConverters({
    @TypeConverter(name="BigIntegerToString",dataType=String.class,objectType=BigInteger.class)
    })
public class Parameters implements Serializable {
    private static final long serialVersionUID = -1979843739878183696L;
    @Column(name="maxValue", nullable=false, length=512)
    @Convert("BigIntegerToString")
    private BigInteger maxValue;
...
}
----

link:#BCFEHCDH[Example 2-123] shows how to use the `<type-converters>`
element in the `eclipselink-orm.xml` file.

[[TLJPA577]]

*_Example 2-124 Using <type-converters> XML_*

[source,oac_no_warn]
----
<type-converters>
    <type-converter name="Long2String" data-type="String" object-type="Long"/>
    <type-converter name="String2String" data-type="String" object-type="String"/>
</type-converters>
<entity class="Employee">
...
</entity>
----

[[sthref451]]

*See Also*

For more information, see:

* link:#CHDHCCJF["@TypeConverter"]
* link:#BEHGJHCD["@Convert"]

[[BCGEJFAH]][[TLJPA583]]

'''''

=== @UnionPartitioning

Use `@UnionPartitioning` to send queries to all connection pools and
then union the results. This can be used for queries or relationships
that span partitions when partitioning is used, such as on a ManyToMany
cross partition relationship.

[[sthref452]]

*Annotation Elements*

link:#BCGFGGCI[Table 2-81] describes this annotation's elements.

[[TLJPA584]][[sthref453]][[BCGFGGCI]]

*_Table 2-81 @UnionPartitioning Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |Name of the partition policy. Names must be unique for the
persistence unit. |

|`connectionPools` |List of connection pool names to load balance across
|Defaults to all defined pools in the `ServerSession`

|`replicateWrite` a|
Defines if write queries should be replicated.

Writes are normally not replicated when unioning, but can be for
ManyToMany relationships, when the join table needs to be replicated.

 |`false`
|=======================================================================

[[sthref454]]

*Usage*

Partitioning can be enabled on an Entity, relationship, query, or
session/persistence unit. Partition policies are globally named to allow
reuse, the partitioning policy must also be set using the `@Partitioned`
annotation to be used.

The persistence unit properties support adding named connection pools in
addition to the existing configuration for read/write/sequence. A named
connection pool must be defined for each node in the database cluster.

If a transaction modifies data from multiple partitions, you should use
JTA ensure proper two-phase commit of the data. You can also configure
an exclusive connection in the EntityManager to ensure that only a
single node is used for a single transaction.

[[sthref455]]

*Examples*

See link:#CEGHAIDJ["Using Partitioning"] for an example of partitioning
with EclipseLink.

[[sthref456]]

*See Also*

For more information, see:

* "Data
Partitioning"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning`
* link:#CHDDAHEB["@Partitioned"]

[[CFAFIIFC]][[TLJPA578]]

'''''

=== @UuidGenerator

Use `@UuidGenerator` to defines a primary key generator that may be
referenced by name when a generator element is specified for the
`@GeneratedValue` annotation. A UUID (universally unique identifier)
generator may be specified on the entity class or on the primary key
field or property.

The generator name is global to the persistence unit (that is, across
all generator types).

[[sthref457]]

*Annotation Elements*

link:#CFAIAHJG[Table 2-82] describes this annotation's elements.

[[TLJPA579]][[sthref458]][[CFAIAHJG]]

*_Table 2-82 @UuidGenerator Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |Name of the UUID generator, which must be unique for the
persistence unit |
|=======================================================================


[[sthref459]]

*Examples*

link:#CFADJAIF[Example 2-125] shows how to use this annotation.

[[CFADJAIF]][[TLJPA580]]

*_Example 2-125 Using @UuidGenerator Annotation_*

[source,oac_no_warn]
----
@Entity
@UuidGenerator(name="EMP_ID_GEN")
public class Employee {
    @Id
    @GeneratedValue(generator="EMP_ID_GEN")
    private String id;
}
----

You can also specify the `SessionCustomizer` and configure the named
sequence in your `eclipselink-orm.xml` file, as shown in
link:#CFAGEJHJ[Example 2-126].

[[CFAGEJHJ]][[TLJPA581]]

*_Example 2-126 Using <generated-value> XML_*

[source,oac_no_warn]
----
<id name="id">
    <column name="PROJ_ID" />
    <generated-value generator="system-uuid"/>
</id>
----

You can also specify the named sequence at the persistence unit level
(in the `persistence.xml` file) as shown in link:#CFAJEEEJ[Example
2-127].

[[CFAJEEEJ]][[TLJPA582]]

*_Example 2-127 Specifying Generator in persistence.xml_*

[source,oac_no_warn]
----
<property name="eclipselink.session.customizer" value="eclipselink.example.UUIDSequence"/>
----

[[sthref460]]

*See Also*

For more information, see:

* @Generated
Value`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Basic_JPA_Development/Entities/Ids/GeneratedValue`
* link:#CACGCEIJ["Entity Annotations"]

[[ANNOTATION_UUIDGENERATORS]]

'''''

=== @UuidGenerators

Use `@UuidGenerators` to define multiple `@UuidGenerator`.
It's container annotation for `@UuidGenerator`


*Annotation Elements*

link:#CFAIAHJGA[Table 2-82.1] describes this annotation's elements.

*_Table 2-82.1 @UuidGenerators Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`UuidGenerator` `value` |(Optional) One or more
`UuidGenerator` annotations |none
|=======================================================================

*Examples*

link:#CFADJAIFB[Example 2-125.1] shows how to use this annotation.

[[CFADJAIFB]]
*_Example 2-125.1 Using @UuidGenerator Annotation_*

[source,oac_no_warn]
----
@Entity
@UuidGenerator({
    @UuidGenerator(name="EMP_ID_GEN")
    @UuidGenerator(name="EMP_CODE_GEN")})
public class Employee {
    @Id
    @GeneratedValue(generator="EMP_ID_GEN")
    private String id;
    @GeneratedValue(generator="EMP_CODE_GEN")
    private String code;
}
----

[[TLJPA54063]]

'''''

=== @ValuePartition

Use `@ValuePartition` to represent a specific value partition that will
be routed to a specific connection pool.

[[sthref468]]

*Annotation Elements*

link:#CACBHEHI[Table 2-84] describes this annotation's elements.

[[TLJPA586]][[sthref469]][[CACBHEHI]]

*_Table 2-84 @ValuePartition Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`connectionPool` |The connection pool to which to route queries to for
the `value` |

|`value` |The `String` representation of the value |
|=======================================================================

[[sthref470]]

*Examples*

link:#CJHFDJAC[Example 2-128] shows how to use the `@ValuePartition` and
`@ValuePartitioning` annotations.

[[CJHFDJAC]][[TLJPA587]]

*_Example 2-128 Using @ValuePartition Annotation_*

[source,oac_no_warn]
----
@Entity
@Table(name = "PART_EMPLOYEE")
@IdClass(EmployeePK.class)
@ValuePartitioning(
  name="ValuePartitioningByLOCATION",
  partitionColumn=@Column(name="LOCATION"),
  unionUnpartitionableQueries=true,
  defaultConnectionPool="default",
  partitions={
    @ValuePartition(connectionPool="node2", value="Ottawa"),
    @ValuePartition(connectionPool="node3", value="Toronto")
  })
@Partitioned("ValuePartitioningByLOCATION")
public class Employee implements Serializable, Cloneable {
...
}
----

link:#CJHBEIGD[Example 2-129] shows how to use the `<partition>` element
in the `eclipselink-orm.xml` file.

[[CJHBEIGD]][[TLJPA588]]

*_Example 2-129 Using <partition> XML_*

[source,oac_no_warn]
----
<entity name="Employee" class="Employee" access="FIELD">
  <table name="PART_EMPLOYEE"/>
  <id-class class="EmployeePK"/>
  <value-partitioning name="ValuePartitioningByLOCATION" union-unpartitionable-queries="true" default-connection-pool="default">
    <partition-column name="LOCATION"/>
    <partition connection-pool="node2" value="Ottawa"/>
    <partition connection-pool="node3" value="Toronto"/>
  </value-partitioning>
<partitioned>ValuePartitioningByLOCATION</partitioned>
----

[[sthref471]]

*See Also*

For more information, see:

* link:#CHDDAHEB["@Partitioned"]
* link:#CEGHFJDJ["@ValuePartitioning"]

[[CEGHFJDJ]][[TLJPA589]]

'''''

=== @ValuePartitioning

Use `@ValuePartitioning` to partition access to a database cluster by a
field value from the object (such as the object's location or tenant).
Each value is assigned a specific server. All write or read request for
object's with that value are sent to the server. If a query does not
include the field as a parameter, then it can either be sent to all
server's and unioned, or left to the session's default behavior.

[[sthref472]]

*Annotation Elements*

link:#CEGEGCEA[Table 2-85] describes this annotation's elements.

[[TLJPA590]][[sthref473]][[CEGEGCEA]]

*_Table 2-85 @ValuePartitioning Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`name` |(Required) Name of the partition policy. Names must be unique
for the persistence unit. |

|`partitionColumn` a|
(Required) The database column or query parameter to partition queries
by

This is the table column name, not the class attribute name. The column
value must be included in the query and should normally be part of the
object's ID. This can also be the name of a query parameter.

If a query does not contain the field the query will not be partitioned.

 |

|`partitions` |(Required) Store the value partitions. Each partition
maps a value to a `connectionPool`. |

|`defaultConnectionPool` |(Optional) The default connection pool is used
for any unmapped values |

|`partitionValueType` |(Optional) The `type` of the start and end values
|`String`

|`unionUnpartitionableQueries` |(Optional) Defines if queries that do
not contain the partition field should be sent to every database and
have the result unioned. |`false`
|=======================================================================

[[sthref474]]

*Usage*

Partitioning can be enabled on an Entity, relationship, query, or
session/persistence unit. Partition policies are globally named to allow
reuse, the partitioning policy must also be set using the `@Partitioned`
annotation to be used.

The persistence unit properties support adding named connection pools in
addition to the existing configuration for read/write/sequence. A named
connection pool must be defined for each node in the database cluster.

If a transaction modifies data from multiple partitions, you should use
JTA ensure proper two-phase commit of the data. You can also configure
an exclusive connection in the EntityManager to ensure that only a
single node is used for a single transaction.

[[sthref475]]

*Examples*

See link:#CEGHAIDJ["Using Partitioning"] for an example of partitioning
with EclipseLink.

[[sthref476]]

*See Also*

For more information, see:

* "Data
Partitioning"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning`
* link:#CHDDAHEB["@Partitioned"]

[[CHDDFDGF]][[TLJPA591]]

'''''

=== @VariableOneToOne

Use `@VariableOneToOne` to represent a pointer references between a java
object and an implementer of an interface. This mapping is usually
represented by a single pointer (stored in an instance variable) between
the source and target objects. In the relational database tables, these
mappings are normally implemented using a foreign key and a type code.

[[sthref477]]

*Annotation Elements*

link:#CHDGHCBF[Table 2-86] describes this annotation's elements.

[[TLJPA592]][[sthref478]][[CHDGHCBF]]

*_Table 2-86 @VariableOneToOne Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`CascadeType` |(Optional) Array of operations that must be cascaded to
the target of the association |

|`DiscriminatorClasses` |(Optional) Array of discriminator types that
can be used with this mapping a|
If none are specified, EclipseLink adds entities within the persistence
unit that implement the target interface.

If `DiscriminatorColumn` is `STRING`, EclipseLink uses `Entity.name()`.

If `DiscriminatorColumn` is `CHAR`, EclipseLink uses the first letter of
the entity class.

If `DiscriminatorColumn` is `INTEGER`, EclipseLink uses the next integer
after the highest integer explicitly stated.

|`DiscriminatorColumn` |(Optional) The discriminator column that
contains the type identifiers |`DTYPE`

|`FetchType` a|
(Optional) Specify how the value of the field or property should be
loaded:

* *Eager*: Requires that the persistence provider runtime must eagerly
fetch the value
* *Lazy*: Hints that the persistence provider should lazily load the
value

 |`Eager`

|`Optional` |(Optional) Specify if the association is optional. |

|`OrphanRemoval` |(Optional) Specify if interface class that is the
target of this mapping. |

|`TargetInterface` |(Optional) The interface class that is the target of
this mapping |If none is specified, EclipseLink will infer the interface
class based on the type of object being referenced.
|=======================================================================

[[sthref479]]

*Usage*

You can specify `@VariableOneToOne` on an Entity, MappedSuperclass, or
Embeddable class.

[[sthref480]]

*Examples*

link:#CHDJDIJD[Example 2-130] shows how to use the `@VariableOneToOne`
annotation.

[[CHDJDIJD]][[TLJPA593]]

*_Example 2-130 Using @VariableOneToOne Annotation_*

[source,oac_no_warn]
----
@VariableOneToOne(
    cascade={ALL},
    fetch=LAZY,
    discriminatorColumn=@DiscriminatorColumn(name="CONTACT_TYPE"),
    discriminatorClasses={
        @DiscriminatorClass(discriminator="E", value="Email.class"), 
        @DiscriminatorClass(discriminator="P", value="Phone.class")
    }
}
@JoinColumn(name="CONTACT_ID", referencedColumnName="C_ID")
@PrivateOwned
@JoinFetch(INNER)
public Contact getContact() {
    return contact;
}
----

link:#CHDCBGAF[Example 2-131] shows the same mapping using the
`<variable-one-to-one>` XML element in the `eclipselink-orm.xml` file.

[[CHDCBGAF]][[TLJPA594]]

*_Example 2-131 Using <variable-one-to-one> XML_*

[source,oac_no_warn]
----
<variable-one-to-one name="contact" fetch="LAZY">
    <cascade>
        <cascade-all/>
    </cascade>
    <discriminator-column name="CONTACT_TYPE"/>
    <discriminator-class discriminator="E" value="Email.class"/>
    <discriminator-class discriminator="P" value="Phone.class"/>
    <join-column name="CONTACT_ID" referenced-column-name="C_ID"/>
    <private-owned/>
    <join-fetch>INNER</join-fetch>
</variable-one-to-one>
----

[[sthref481]]

*See Also*

For more information, see:

* link:#CIHGDDED["@DiscriminatorClass"]
* link:#CHDDDDAI["@PrivateOwned"]

[[CIHFBCFI]][[TLJPA595]]

'''''

=== @VirtualAccessMethods

Use `@VirtualAccessMethods` to specify that a specific class contains
virtual methods.

[[sthref482]]

*Annotation Elements*

link:#CIHCCFIH[Table 2-87] describes this annotation's elements.

[[TLJPA596]][[sthref483]][[CIHCCFIH]]

*_Table 2-87 @VirtualAccessMethods Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`get` a|
(Optional) Name of the `getter` method to use for the virtual property.
This method must take a single `java.lang.String` parameter and return a
`java.lang.Object`.

If `get` is specified, you must also specify `set`.

 |`get`

|set a|
(Optional) Name of the `setter` method to use for the virtual property.
This method must take a `java.lang.String` parameter and a
`java.lang.Object` parameter.

If `set` is specified, you must also specify `get`.

 |`set`
|=======================================================================

[[sthref484]]

*Usage*

Use the `@VirtualAccessMethods` annotation to define access methods for
mappings with in which `accessType`=VIRTUAL.

[[sthref485]]

*Examples*

link:#CIHCCFIH[Table 2-87] shows an entity using property access.

[[TLJPA597]]

*_Example 2-132 Using @VirtualAccessMethods Annotation_*

[source,oac_no_warn]
----
@Entity
  @VirtualAccessMethods
  public class Customer{
 
    @Id
    private int id;
...
 
    @Transient
    private Map<String, Object> extensions;
 
    public <T> T get(String name) {
        return (T) extensions.get(name);
    }
 
    public Object set(String name, Object value) {
        return extensions.put(name, value);
    }
----

In addition to using the `@VirtualAccessMethods` annotation, you can use
the `<access>` and `<access-method>` elements in your
`eclipselink-orm.xml` file, as shown in link:#CIHCJCJE[Example 2-133].

[[CIHCJCJE]][[TLJPA598]]

*_Example 2-133 Using <access> and <access-methods> XML_*

[source,oac_no_warn]
----
<access>VIRTUAL</access><access-methods get-method="get" set-method="set"/>@Entity
----

[[sthref487]]

*See Also*

For more information, see:

* "Extensible
Entities"`http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Extensible_Entities`
* "Making JPA Entities and JAXB Beans Extensible" in _Solutions Guide
for EclispeLink_

[[BGBGGAEA]][[TLJPA599]]

'''''

=== @WriteTransformer

Use `@WriteTransformer` on a `TranformationMapping` to transform a
single attribute value to a single database column value. Use the
`@WriteTransformers` annotation to wrap multiple transformations.

[[sthref488]]

*Annotation Elements*

link:#BGBEGIEE[Table 2-88] describes this annotation's elements.

[[TLJPA600]][[sthref489]][[BGBEGIEE]]

*_Table 2-88 @WriteTransformer Annotation Elements_*

|=======================================================================
|*Annotation Element* |*Description* |*Default*
|`column` a|
(Optional) The column into which the value should be written

If a single `WriteTransfomer` annotates an attribute, the attribute's
name will be used as the column name.

 |`@jakarta.persistence.Column`

|`method` a|
(Optional) The `String` method name that the mapped class must have.
This method returns the value to be written into the database column.

*Note*: To support DDL generation and returning policy, the method
should be defined to return a particular type, not just an `Object`. For
example:`public Time getStartTime()`

The method may require `@Transient` to avoid being mapped as a `Basic`
by default.

 |

|`transformerClass` a|
(Optional) User-defined class that implements the `FieldTransformer`
interface. This will instantiate the class and use its `buildFieldValue`
method to create the value to be written into the database column.

*Note*: To support DDL generation and returningpolicy, the method
`buildFieldValue` in the class should be defined to return the relevant
Java type, not just `Object` as defined in the interface. For
example:`public Time buildFieldValue(Object instance, String fieldName, Session session).`

 |`void.class`
|=======================================================================

NOTE: You must specify either `transformerClass` _or_ `method` , but not both.

[[sthref490]]

*Usage*

You cannot define a `@WriteTransforme`r for a read-only mapping.

Unless the `TransformationMapping` is write-only, it should include a
`ReadTransformer` that defines the transformation of the database column
values into attribute values.

[[sthref491]]

*Configuring Field Transformer Associations*

Using a `FieldTransformer` is non-intrusive; your domain object does not
need to implement an EclipseLink interface or provide a special
transformation method.

You can configure a method-based field transformer using
`AbstractTransformationMapping` method `addFieldTransformation`, passing
in the name of the database field and the name of the domain object
method to use.

You can configure a class-based field transformer using
`AbstractTransformationMapping` method `addFieldTransformer`, passing in
the name of the database field and an instance of
`org.eclipse.persistence.mappings.Transfomers.FieldTransformer`.

A convenient way to create a `FieldTransformer` is to extend
`FieldTransformerAdapter`.

[[sthref492]]

*Examples*

See link:#BABHECGF["Using @Transformation Annotation"] for an example of
how to use the `@WriteTransformer annotation` with a Transformation
mapping.

[[sthref493]]

*See Also*

For more information, see:

* link:#BCFCCEJF["@WriteTransformers"]
* link:#BABCJGIG["@Transformation"].
* http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Print_Version#How_to_Use_the_.40Transformation_Annotation

[[BCFCCEJF]][[TLJPA601]]

'''''

=== @WriteTransformers

Use `@WriteTransformer` on a `TranformationMapping` to transform a
single attribute value to a single database column value. Use the
`@WriteTransformers` annotation to wrap multiple transformations.

[[sthref494]]

*Annotation Elements*

link:#BCFBFAIF[Table 2-89] describes this annotation's elements.

[[TLJPA602]][[sthref495]][[BCFBFAIF]]

*_Table 2-89 @WriteTransformers Annotation Elements_*

|======================================================
|*Annotation Element* |*Description* |*Default*
|`WriteTransformer` |An array of `WriteTransformer` |
|======================================================

[[sthref496]]

*Usage*

You cannot use `@WriteTransforme`rs for a read-only mapping.

[[sthref497]]

*Examples*

See link:#BABHECGF["Using @Transformation Annotation"] for an example of
how to use the `@WriteTransformer annotation` with a Transformation
mapping.

[[sthref498]]

*See Also*

For more information, see:

* link:#BGBGGAEA["@WriteTransformer"].
* link:#BABCJGIG["@Transformation"].
* http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Print_Version#How_to_Use_the_.40Transformation_Annotation
